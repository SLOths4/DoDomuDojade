{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"DoDomuDojad\u0119 - Dokumentacja Architektura i API Witaj w dokumentacji projektu DoDomuDojad\u0119 ! Ta strona stanowi punkt wyj\u015bcia do zrozumienia struktury i architektury aplikacji. \ud83d\udcda Struktura Dokumentacji API Documentation - REST API layers Architecture - DDD architecture patterns Examples - Practical usage examples Dokumentacja jest podzielona na kilka kluczowych sekcji: Architektura DDD Szczeg\u00f3\u0142owy opis Domain-Driven Design architektura projektu, warstwy aplikacji, oraz przep\u0142yw danych mi\u0119dzy komponentami. Domain Layer Opisuje warstw\u0119 domenow\u0105 zawieraj\u0105c\u0105: - Entities - G\u0142\u00f3wne obiekty biznesowe (Announcement, User, Word, Quote, Module, Countdown) - Value Objects - Niezmienne obiekty warto\u015bci - Enums - Wyliczenia dla typ\u00f3w i status\u00f3w - Exceptions - Wyj\u0105tki domenowe Application Layer Dokumentacja warstwy aplikacji obejmuj\u0105ca: - Use Cases - G\u0142\u00f3wne scenariusze u\u017cytkownika - Data Transfer Objects (DTOs) - Obiekty transferu danych - Services - Orkiestracja logiki biznesowej Infrastructure Layer Szczeg\u00f3\u0142y implementacji infrastruktury: - Repositories - Dost\u0119p do danych - External Services - Integracje z zewn\u0119trznymi API - Factories - Tworzenie obiekt\u00f3w - Security - Zabezpieczenia i autoryzacja - Helpers - Funkcje wspieraj\u0105ce \ud83c\udfaf Cechy Projektu Stos Technologiczny Backend : PHP 8.3+ z czyst\u0105 architektur\u0105 DDD Framework : W\u0142asna implementacja bez du\u017cych framework\u00f3w Baza Danych : PostgreSQL, SQLite Frontend : HTML, CSS, JavaScript Tools : Composer, NPM, PHPStorm Kluczowe Modu\u0142y Announcements - System og\u0142osze\u0144 z workflow akceptacji Words - S\u0142ownik dziennych s\u0142\u00f3w Quotes - Baza cytat\u00f3w inspiruj\u0105cych Countdown - Odliczanie do wa\u017cnych dat User Management - Zarz\u0105dzanie u\u017cytkownikami \ud83c\udfd7\ufe0f Architektura na Wysokim Poziomie \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Presentation Layer (Http, Console) \u2502 \u2502 Controllers & CLI Commands \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Application Layer (Use Cases, DTOs) \u2502 \u2502 Business Logic Orchestration \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Domain Layer (Entities, Value Objects) \u2502 \u2502 Core Business Rules & Invariants \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Infrastructure Layer (Repositories, Services) \u2502 \u2502 External Services & Data Persistence \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \ud83d\ude80 Szybki Start dla Developer\u00f3w Zrozumienie Struktury Zacznij od Architecture Guide aby zrozumie\u0107 DDD koncepty Przejrzyj Domain Layer aby pozna\u0107 core entities Zbadaj Application Layer aby zobaczy\u0107 use cases Sprawd\u017a Infrastructure Layer dla detali implementacji Dodawanie Nowej Funkcjonalno\u015bci Zdefiniuj Entity w src/Domain/Entity/ Stw\u00f3rz UseCase w src/Application/UseCase/ Implementuj Repository w src/Infrastructure/Repository/ Dodaj Controller w src/Http/ Napisz dokumentacj\u0119 zmian \ud83d\udcdd Konwencje Kodowania Namespace'y App\\Domain\\Entity // Entity App\\Domain\\ValueObject // Value Objects App\\Domain\\Enum // Enumerations App\\Domain\\Exception // Exceptions App\\Application\\UseCase // Use Cases App\\Application\\DataTransferObject // DTOs App\\Infrastructure\\Repository // Repositories App\\Infrastructure\\Service // External Services App\\Infrastructure\\Factory // Factories App\\Infrastructure\\Security // Security Components App\\Http\\Controller // HTTP Controllers App\\Http\\Response // HTTP Responses App\\Console\\Command // CLI Commands Struktura Klas Entities : Mutable, z ID, reprezentuj\u0105 obiekty biznesowe Value Objects : Immutable, brak ID, reprezentuj\u0105 warto\u015bci DTOs : Transfer danych mi\u0119dzy warstwami Services : Operacje na danych, integracje zewn\u0119trzne Repositories : Abstrakcja dost\u0119pu do danych \ud83d\udd17 Powi\u0105zane Zasoby Repository : https://github.com/SLOths4/DoDomuDojade Issues : https://github.com/SLOths4/DoDomuDojade/issues Kontakt : sloths4@spolecznaczworka.pl","title":"Home"},{"location":"#dodomudojade-dokumentacja-architektura-i-api","text":"Witaj w dokumentacji projektu DoDomuDojad\u0119 ! Ta strona stanowi punkt wyj\u015bcia do zrozumienia struktury i architektury aplikacji.","title":"DoDomuDojad\u0119 - Dokumentacja Architektura i API"},{"location":"#struktura-dokumentacji","text":"API Documentation - REST API layers Architecture - DDD architecture patterns Examples - Practical usage examples Dokumentacja jest podzielona na kilka kluczowych sekcji:","title":"\ud83d\udcda Struktura Dokumentacji"},{"location":"#architektura-ddd","text":"Szczeg\u00f3\u0142owy opis Domain-Driven Design architektura projektu, warstwy aplikacji, oraz przep\u0142yw danych mi\u0119dzy komponentami.","title":"Architektura DDD"},{"location":"#domain-layer","text":"Opisuje warstw\u0119 domenow\u0105 zawieraj\u0105c\u0105: - Entities - G\u0142\u00f3wne obiekty biznesowe (Announcement, User, Word, Quote, Module, Countdown) - Value Objects - Niezmienne obiekty warto\u015bci - Enums - Wyliczenia dla typ\u00f3w i status\u00f3w - Exceptions - Wyj\u0105tki domenowe","title":"Domain Layer"},{"location":"#application-layer","text":"Dokumentacja warstwy aplikacji obejmuj\u0105ca: - Use Cases - G\u0142\u00f3wne scenariusze u\u017cytkownika - Data Transfer Objects (DTOs) - Obiekty transferu danych - Services - Orkiestracja logiki biznesowej","title":"Application Layer"},{"location":"#infrastructure-layer","text":"Szczeg\u00f3\u0142y implementacji infrastruktury: - Repositories - Dost\u0119p do danych - External Services - Integracje z zewn\u0119trznymi API - Factories - Tworzenie obiekt\u00f3w - Security - Zabezpieczenia i autoryzacja - Helpers - Funkcje wspieraj\u0105ce","title":"Infrastructure Layer"},{"location":"#cechy-projektu","text":"","title":"\ud83c\udfaf Cechy Projektu"},{"location":"#stos-technologiczny","text":"Backend : PHP 8.3+ z czyst\u0105 architektur\u0105 DDD Framework : W\u0142asna implementacja bez du\u017cych framework\u00f3w Baza Danych : PostgreSQL, SQLite Frontend : HTML, CSS, JavaScript Tools : Composer, NPM, PHPStorm","title":"Stos Technologiczny"},{"location":"#kluczowe-moduy","text":"Announcements - System og\u0142osze\u0144 z workflow akceptacji Words - S\u0142ownik dziennych s\u0142\u00f3w Quotes - Baza cytat\u00f3w inspiruj\u0105cych Countdown - Odliczanie do wa\u017cnych dat User Management - Zarz\u0105dzanie u\u017cytkownikami","title":"Kluczowe Modu\u0142y"},{"location":"#architektura-na-wysokim-poziomie","text":"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Presentation Layer (Http, Console) \u2502 \u2502 Controllers & CLI Commands \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Application Layer (Use Cases, DTOs) \u2502 \u2502 Business Logic Orchestration \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Domain Layer (Entities, Value Objects) \u2502 \u2502 Core Business Rules & Invariants \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Infrastructure Layer (Repositories, Services) \u2502 \u2502 External Services & Data Persistence \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518","title":"\ud83c\udfd7\ufe0f Architektura na Wysokim Poziomie"},{"location":"#szybki-start-dla-developerow","text":"","title":"\ud83d\ude80 Szybki Start dla Developer\u00f3w"},{"location":"#zrozumienie-struktury","text":"Zacznij od Architecture Guide aby zrozumie\u0107 DDD koncepty Przejrzyj Domain Layer aby pozna\u0107 core entities Zbadaj Application Layer aby zobaczy\u0107 use cases Sprawd\u017a Infrastructure Layer dla detali implementacji","title":"Zrozumienie Struktury"},{"location":"#dodawanie-nowej-funkcjonalnosci","text":"Zdefiniuj Entity w src/Domain/Entity/ Stw\u00f3rz UseCase w src/Application/UseCase/ Implementuj Repository w src/Infrastructure/Repository/ Dodaj Controller w src/Http/ Napisz dokumentacj\u0119 zmian","title":"Dodawanie Nowej Funkcjonalno\u015bci"},{"location":"#konwencje-kodowania","text":"","title":"\ud83d\udcdd Konwencje Kodowania"},{"location":"#namespacey","text":"App\\Domain\\Entity // Entity App\\Domain\\ValueObject // Value Objects App\\Domain\\Enum // Enumerations App\\Domain\\Exception // Exceptions App\\Application\\UseCase // Use Cases App\\Application\\DataTransferObject // DTOs App\\Infrastructure\\Repository // Repositories App\\Infrastructure\\Service // External Services App\\Infrastructure\\Factory // Factories App\\Infrastructure\\Security // Security Components App\\Http\\Controller // HTTP Controllers App\\Http\\Response // HTTP Responses App\\Console\\Command // CLI Commands","title":"Namespace'y"},{"location":"#struktura-klas","text":"Entities : Mutable, z ID, reprezentuj\u0105 obiekty biznesowe Value Objects : Immutable, brak ID, reprezentuj\u0105 warto\u015bci DTOs : Transfer danych mi\u0119dzy warstwami Services : Operacje na danych, integracje zewn\u0119trzne Repositories : Abstrakcja dost\u0119pu do danych","title":"Struktura Klas"},{"location":"#powiazane-zasoby","text":"Repository : https://github.com/SLOths4/DoDomuDojade Issues : https://github.com/SLOths4/DoDomuDojade/issues Kontakt : sloths4@spolecznaczworka.pl","title":"\ud83d\udd17 Powi\u0105zane Zasoby"},{"location":"architecture/ddd/","text":"Architektura Domain-Driven Design Wst\u0119p do DDD Domain-Driven Design (DDD) to metodologia projektowania software'u, kt\u00f3ra k\u0142adzie nacisk na g\u0142\u0119bokie zrozumienie domeny biznesowej i odzwierciedlenie tej wiedzy w kodzie. Projekt DoDomuDojad\u0119 implementuje czysty DDD z wyra\u017anym podzia\u0142em na warstwy architektoniczne. \ud83c\udfaf G\u0142\u00f3wne Zasady DDD w Projekcie 1. Ubiquity of Language (Wszechobecno\u015b\u0107 J\u0119zyka) Kod i dokumentacja u\u017cywaj\u0105 jednolitego s\u0142ownika biznesowego: - Announcement - Og\u0142oszenie - Countdown - Odliczanie - Quote - Cytat - Word - S\u0142owo - Status - Stan (PENDING, APPROVED, REJECTED) 2. Bounded Contexts (Ograniczone Konteksty) Ka\u017cdy modu\u0142 funkcjonalny operuje w swoim kontek\u015bcie: - Announcement Context - Zarz\u0105dzanie og\u0142oszeniami - Word Context - S\u0142ownik s\u0142\u00f3w - Quote Context - Baza cytat\u00f3w - User Context - Zarz\u0105dzanie u\u017cytkownikami 3. Aggregate Roots (Pierwotne Agregaty) Kluczowe jednostki, kt\u00f3re koordynuj\u0105 zmiany: - Announcement - G\u0142\u00f3wny agregat dla og\u0142osze\u0144 - User - G\u0142\u00f3wny agregat dla u\u017cytkownik\u00f3w - Word - G\u0142\u00f3wny agregat dla s\u0142\u00f3w - Quote - G\u0142\u00f3wny agregat dla cytat\u00f3w \ud83c\udfd7\ufe0f Warstwy Architektoniczne Warstwa Domain (src/Domain) Odpowiedzialno\u015b\u0107 : Zawiera czyst\u0105 logik\u0119 biznesow\u0105 niezale\u017cn\u0105 od technologii src/Domain/ \u251c\u2500\u2500 Entity/ # Agregaty i Entity \u2502 \u251c\u2500\u2500 Announcement.php \u2502 \u251c\u2500\u2500 User.php \u2502 \u251c\u2500\u2500 Word.php \u2502 \u251c\u2500\u2500 Quote.php \u2502 \u251c\u2500\u2500 Module.php \u2502 \u2514\u2500\u2500 Countdown.php \u251c\u2500\u2500 ValueObject/ # Niezmienne obiekty warto\u015bci \u251c\u2500\u2500 Enum/ # Enumeracje dla typ\u00f3w i status\u00f3w \u2502 \u251c\u2500\u2500 AnnouncementStatus.php \u2502 \u2514\u2500\u2500 ... \u2514\u2500\u2500 Exception/ # Wyj\u0105tki domenowe \u251c\u2500\u2500 AnnouncementException.php \u2514\u2500\u2500 ... Entities Entity reprezentuje obiekt z unikaln\u0105 to\u017csamo\u015bci\u0105 (ID), kt\u00f3ry zmienia si\u0119 w czasie. // Przyk\u0142ad: Announcement Entity final class Announcement { public function __construct( public ?int $id, public string $title, public string $text, public DateTimeImmutable $createdAt, public DateTimeImmutable $validUntil, public ?int $userId, public AnnouncementStatus $status = AnnouncementStatus::PENDING, public ?DateTimeImmutable $decidedAt = null, public ?int $decidedBy = null, ){} // Factory methods public static function createNew(...): self { } public static function proposeNew(...): self { } // Business methods public function approve(int $decidedBy): void { } public function reject(int $decidedBy): void { } public function isValid(): bool { } } Cechy Entity: - Ma identyfikator (ID) - Mo\u017ce by\u0107 modyfikowana - Zawiera zachowanie biznesowe (metody) - Definiuje regu\u0142y biznesowe (invariants) Value Objects Value Objects reprezentuj\u0105 warto\u015bci, kt\u00f3re nie zmieniaj\u0105 si\u0119 i nie maj\u0105 to\u017csamo\u015bci. // B\u0119d\u0105 w src/Domain/ValueObject/ gdy zostan\u0105 wprowadzone // Przyk\u0142ady: // - Email // - PhoneNumber // - DateRange // - Status Cechy Value Object: - Niezmienno\u015b\u0107 (immutable) - Brak ID - Por\u00f3wnanie po warto\u015bci, nie po referencji - Samodzielna walidacja Enums Wyliczenia dla typ\u00f3w i status\u00f3w domeny. enum AnnouncementStatus { case PENDING; case APPROVED; case REJECTED; } Exceptions Wyj\u0105tki domenowe reprezentuj\u0105ce b\u0142\u0119dy biznesowe. // W src/Domain/Exception/ class AnnouncementException extends DomainException { } class InvalidAnnouncementStatusException extends AnnouncementException { } Warstwa Application (src/Application) Odpowiedzialno\u015b\u0107 : Orkiestracja logiki biznesowej, przypadki u\u017cycia src/Application/ \u251c\u2500\u2500 UseCase/ # G\u0142\u00f3wne scenariusze u\u017cytkownika \u2502 \u251c\u2500\u2500 Announcement/ \u2502 \u2502 \u251c\u2500\u2500 CreateAnnouncementUseCase.php \u2502 \u2502 \u251c\u2500\u2500 ApproveAnnouncementUseCase.php \u2502 \u2502 \u2514\u2500\u2500 RejectAnnouncementUseCase.php \u2502 \u2514\u2500\u2500 ... \u2514\u2500\u2500 DataTransferObject/ # Obiekty transferu danych \u251c\u2500\u2500 AnnouncementDTO.php \u2514\u2500\u2500 ... Use Cases Use Case opisuje pojedynczy, znacz\u0105cy scenariusz u\u017cytkownika. // Struktura Use Case class CreateAnnouncementUseCase { public function __construct( private AnnouncementRepository $repository, // inne zale\u017cno\u015bci ) {} public function execute(CreateAnnouncementRequest $request): void { // 1. Validate request // 2. Create domain entity // 3. Call repository to save // 4. Trigger domain events (future) } } Charakterystyka Use Case: - Jedna odpowiedzialno\u015b\u0107 - Orkiestracja mi\u0119dzy Domain a Infrastructure - Brak logiki biznesowej (deleguje do Domain) - Obs\u0142uguje zdarzenia i b\u0142\u0119dy Data Transfer Objects (DTOs) DTOs transportuj\u0105 dane mi\u0119dzy warstwami bez logiki biznesowej. class AnnouncementDTO { public function __construct( public int $id, public string $title, public string $text, public string $status, // ... inne pola ) {} } Kiedy u\u017cywa\u0107 DTOs: - Transfer danych z HTTP Request/Response - Komunikacja mi\u0119dzy Use Cases - Serializacja/deserializacja Warstwa Infrastructure (src/Infrastructure) Odpowiedzialno\u015b\u0107 : Implementacja technicznych szczeg\u00f3\u0142\u00f3w src/Infrastructure/ \u251c\u2500\u2500 Repository/ # Implementacja repozytori\u00f3w \u2502 \u251c\u2500\u2500 AnnouncementRepository.php \u2502 \u2514\u2500\u2500 UserRepository.php \u251c\u2500\u2500 Service/ # Serwisy zewn\u0119trzne \u2502 \u251c\u2500\u2500 ExternalApiService.php \u2502 \u2514\u2500\u2500 EmailService.php \u251c\u2500\u2500 Factory/ # Fabryki do tworzenia obiekt\u00f3w \u251c\u2500\u2500 Security/ # Komponenty bezpiecze\u0144stwa \u2502 \u251c\u2500\u2500 AuthenticationService.php \u2502 \u2514\u2500\u2500 PasswordHasher.php \u251c\u2500\u2500 Helper/ # Funkcje pomocnicze \u251c\u2500\u2500 Translation/ # T\u0142umaczenia \u251c\u2500\u2500 Trait/ # Traity wsp\u00f3lne \u251c\u2500\u2500 View/ # View helpers \u2514\u2500\u2500 Container.php # DI Container Repositories Repository abstrahuje dost\u0119p do danych (patrz: Repository Pattern). // Interface w Domain (nie istnieje tu, ale powinien) interface AnnouncementRepository { public function save(Announcement $announcement): void; public function findById(int $id): ?Announcement; public function findAll(): array; public function delete(Announcement $announcement): void; } // Implementacja w Infrastructure class DatabaseAnnouncementRepository implements AnnouncementRepository { public function save(Announcement $announcement): void { // SQL INSERT/UPDATE } public function findById(int $id): ?Announcement { // SQL SELECT } } Rola Repository: - Abstrakcja dost\u0119pu do danych - Brak SQL w Domain Layer - \u0141atwa zamiana implementacji (np. mock w testach) - Zgodno\u015b\u0107 z DIP (Dependency Inversion Principle) External Services Serwisy integruj\u0105ce si\u0119 z zewn\u0119trznymi API. class ExternalWordService { public function fetchDailyWord(): Word { // HTTP call do external API // Transformacja do Domain Entity } } class EmailService { public function send(string $email, string $message): void { // Sending email via SMTP/external service } } Factories Fabryki tworz\u0105 kompleksowe obiekty. class AnnouncementFactory { public static function createFromRequest( CreateAnnouncementRequest $request ): Announcement { return Announcement::createNew( title: $request->title, text: $request->text, validUntil: $request->validUntil, userId: $request->userId, ); } } Warstwa Presentation (src/Http, src/Console) Odpowiedzialno\u015b\u0107 : Interfejsy u\u017cytkownika (HTTP, CLI) src/Http/ \u251c\u2500\u2500 Controller/ # HTTP Controllers \u2502 \u251c\u2500\u2500 AnnouncementController.php \u2502 \u251c\u2500\u2500 UserController.php \u2502 \u2514\u2500\u2500 ... \u2514\u2500\u2500 Response/ # Response helpers src/Console/ \u2514\u2500\u2500 Command/ # CLI Commands \u251c\u2500\u2500 FetchDailyWordCommand.php \u251c\u2500\u2500 FetchDailyQuoteCommand.php \u2514\u2500\u2500 ... Charakterystyka Controllers: - Parsowanie HTTP Request - Delegowanie do Use Case - Formatowanie Response - Obs\u0142uga HTTP specific logic (routing, auth, validation) \ud83d\udd04 Przep\u0142yw Danych Typowy Scenariusz: Tworzenie Og\u0142oszenia 1. HTTP Request (POST /announcements) \u2193 2. Controller (AnnouncementController) - Parsuje request - Waliduje wej\u015bcie \u2193 3. Use Case (CreateAnnouncementUseCase) - Tworzy DTO - Wywo\u0142a Domain Entity \u2193 4. Domain Entity (Announcement) - Aplikuje regu\u0142y biznesowe - Tworzy nowy agregat \u2193 5. Repository Interface \u2193 6. Repository Implementation (DatabaseAnnouncementRepository) - Wykonuje SQL INSERT - Zwraca entity z ID \u2193 7. Use Case - Zwraca success \u2193 8. Controller - Formatuje response (JSON) \u2193 9. HTTP Response (201 Created) graph TB A[\"HTTP Request<br/>(POST /announcements)\"] -->|Parse & Validate| B[\"Controller\"] B -->|Execute| C[\"Use Case\"] C -->|Create| D[\"Domain Entity\"] D -->|Follow Business Rules| E[\"Entity Created\"] C -->|Save| F[\"Repository Interface\"] F -->|Implement| G[\"Database<br/>Implementation\"] G -->|SQL INSERT| H[\"Database\"] H -->|Return Entity| G G -->|Return to UseCase| F F -->|Return to UseCase| C C -->|Return to Controller| B B -->|Format Response| I[\"HTTP Response<br/>(201 Created)\"] \ud83d\udee1\ufe0f Invariants (Niezminiki Biznesowe) Invariants to regu\u0142y biznesowe, kt\u00f3re musz\u0105 by\u0107 spe\u0142nione. Announcement Invariants Announcement musi mie\u0107 unikalny tytu\u0142 (w kontek\u015bcie) Announcement musi mie\u0107 validUntil >= createdAt Zatwierdzenie zmienia status z PENDING na APPROVED Odrzucenie zmienia status z PENDING na REJECTED Og\u0142oszenie jest wa\u017cne tylko je\u015bli status=APPROVED i teraz < validUntil public function isValid(): bool { return $this->status === AnnouncementStatus::APPROVED && new DateTimeImmutable() <= $this->validUntil; } \ud83d\udce6 Dependency Injection Projekt u\u017cywa DIY DI Container ( src/Infrastructure/Container.php ). // Container Registration $container->register( AnnouncementRepository::class, new DatabaseAnnouncementRepository($pdo) ); // Usage in Controller $container->get(AnnouncementRepository::class); Zasady: - Domain nie zale\u017cy od Infrastructure - Application zale\u017cy od Domain interfaces - Infrastructure implementuje Domain interfaces - Presentation zale\u017cy od Application i Domain \ud83c\udf93 Best Practices Domain Layer \u2705 DO: - Implementuj regu\u0142y biznesowe - U\u017cywaj Value Objects - Zwracaj Entity z metodami - Definiuj wyj\u0105tki domenowe \u274c DON'T: - Nie importuj Infrastructure - Nie r\u00f3b SQL queries - Nie parsuj JSON/XML - Nie loguj (przynajmniej nie w core) Application Layer \u2705 DO: - Orkiestruj przypadki u\u017cycia - Waliduj DTOs - Transformuj mi\u0119dzy Domain a Presentation - Obs\u0142uguj transakcje \u274c DON'T: - Nie implementuj regu\u0142 biznesowych - Nie bezpo\u015brednio korzystaj z bazy - Nie mieszaj logiki r\u00f3\u017cnych Use Cases Infrastructure Layer \u2705 DO: - Implementuj Repository interfaces - Integruj z zewn\u0119trznymi serwisami - Zarz\u0105dzaj baza danych - Konfiguruj zale\u017cno\u015bci \u274c DON'T: - Nie implementuj regu\u0142 biznesowych - Nie u\u017cywaj Domain bezpo\u015brednio w SQL - Nie tw\u00f3rz Service Locator (u\u017cywaj DI) Presentation Layer \u2705 DO: - Parsuj HTTP requests - Waliduj input - Deleguj do Use Cases - Formatuj responses \u274c DON'T: - Nie implementuj logiki biznesowej - Nie dost\u0119puj bezpo\u015brednio do bazy - Nie r\u00f3b \u017cadnych transformacji Entity \ud83d\udd17 Relacje Mi\u0119dzy Warstwami Domain Layer \u2191 \u2502 depends on (implements interface) \u2502 Application Layer \u2191 \u2502 depends on (calls) \u2502 Presentation Layer (Http, Console) Infrastructure Layer \u2502 implements \u2193 Domain Layer (interfaces only) Kluczowa Regu\u0142a : Infrastructure NIGDY nie importuje Application, Application importuje Domain interfaces kt\u00f3re s\u0105 implementowane w Infrastructure. \ud83d\udcda Namespace Mapping Warstwa Namespace Przyk\u0142ad Domain App\\Domain\\ App\\Domain\\Entity\\Announcement Application App\\Application\\ App\\Application\\UseCase\\CreateAnnouncementUseCase Infrastructure App\\Infrastructure\\ App\\Infrastructure\\Repository\\DatabaseAnnouncementRepository Presentation App\\Http\\ / App\\Console\\ App\\Http\\Controller\\AnnouncementController \ud83d\ude80 Rozszerzanie Projektu Aby doda\u0107 now\u0105 funkcjonalno\u015b\u0107 (np. nowy modu\u0142): Stw\u00f3rz Entity w Domain php // src/Domain/Entity/NewEntity.php final class NewEntity { } Zdefiniuj Enums je\u015bli potrzebne php // src/Domain/Enum/NewEntityStatus.php enum NewEntityStatus { } Stw\u00f3rz Use Cases w Application php // src/Application/UseCase/CreateNewEntityUseCase.php class CreateNewEntityUseCase { } Implementuj Repository w Infrastructure php // src/Infrastructure/Repository/DatabaseNewEntityRepository.php class DatabaseNewEntityRepository { } Stw\u00f3rz Controller w Presentation php // src/Http/Controller/NewEntityController.php class NewEntityController { } Zarejestruj w DI Container php // src/Infrastructure/Container.php $container->register(NewEntityRepository::class, $implementation);","title":"Architecture"},{"location":"architecture/ddd/#architektura-domain-driven-design","text":"","title":"Architektura Domain-Driven Design"},{"location":"architecture/ddd/#wstep-do-ddd","text":"Domain-Driven Design (DDD) to metodologia projektowania software'u, kt\u00f3ra k\u0142adzie nacisk na g\u0142\u0119bokie zrozumienie domeny biznesowej i odzwierciedlenie tej wiedzy w kodzie. Projekt DoDomuDojad\u0119 implementuje czysty DDD z wyra\u017anym podzia\u0142em na warstwy architektoniczne.","title":"Wst\u0119p do DDD"},{"location":"architecture/ddd/#gowne-zasady-ddd-w-projekcie","text":"","title":"\ud83c\udfaf G\u0142\u00f3wne Zasady DDD w Projekcie"},{"location":"architecture/ddd/#1-ubiquity-of-language-wszechobecnosc-jezyka","text":"Kod i dokumentacja u\u017cywaj\u0105 jednolitego s\u0142ownika biznesowego: - Announcement - Og\u0142oszenie - Countdown - Odliczanie - Quote - Cytat - Word - S\u0142owo - Status - Stan (PENDING, APPROVED, REJECTED)","title":"1. Ubiquity of Language (Wszechobecno\u015b\u0107 J\u0119zyka)"},{"location":"architecture/ddd/#2-bounded-contexts-ograniczone-konteksty","text":"Ka\u017cdy modu\u0142 funkcjonalny operuje w swoim kontek\u015bcie: - Announcement Context - Zarz\u0105dzanie og\u0142oszeniami - Word Context - S\u0142ownik s\u0142\u00f3w - Quote Context - Baza cytat\u00f3w - User Context - Zarz\u0105dzanie u\u017cytkownikami","title":"2. Bounded Contexts (Ograniczone Konteksty)"},{"location":"architecture/ddd/#3-aggregate-roots-pierwotne-agregaty","text":"Kluczowe jednostki, kt\u00f3re koordynuj\u0105 zmiany: - Announcement - G\u0142\u00f3wny agregat dla og\u0142osze\u0144 - User - G\u0142\u00f3wny agregat dla u\u017cytkownik\u00f3w - Word - G\u0142\u00f3wny agregat dla s\u0142\u00f3w - Quote - G\u0142\u00f3wny agregat dla cytat\u00f3w","title":"3. Aggregate Roots (Pierwotne Agregaty)"},{"location":"architecture/ddd/#warstwy-architektoniczne","text":"","title":"\ud83c\udfd7\ufe0f Warstwy Architektoniczne"},{"location":"architecture/ddd/#warstwa-domain-srcdomain","text":"Odpowiedzialno\u015b\u0107 : Zawiera czyst\u0105 logik\u0119 biznesow\u0105 niezale\u017cn\u0105 od technologii src/Domain/ \u251c\u2500\u2500 Entity/ # Agregaty i Entity \u2502 \u251c\u2500\u2500 Announcement.php \u2502 \u251c\u2500\u2500 User.php \u2502 \u251c\u2500\u2500 Word.php \u2502 \u251c\u2500\u2500 Quote.php \u2502 \u251c\u2500\u2500 Module.php \u2502 \u2514\u2500\u2500 Countdown.php \u251c\u2500\u2500 ValueObject/ # Niezmienne obiekty warto\u015bci \u251c\u2500\u2500 Enum/ # Enumeracje dla typ\u00f3w i status\u00f3w \u2502 \u251c\u2500\u2500 AnnouncementStatus.php \u2502 \u2514\u2500\u2500 ... \u2514\u2500\u2500 Exception/ # Wyj\u0105tki domenowe \u251c\u2500\u2500 AnnouncementException.php \u2514\u2500\u2500 ...","title":"Warstwa Domain (src/Domain)"},{"location":"architecture/ddd/#entities","text":"Entity reprezentuje obiekt z unikaln\u0105 to\u017csamo\u015bci\u0105 (ID), kt\u00f3ry zmienia si\u0119 w czasie. // Przyk\u0142ad: Announcement Entity final class Announcement { public function __construct( public ?int $id, public string $title, public string $text, public DateTimeImmutable $createdAt, public DateTimeImmutable $validUntil, public ?int $userId, public AnnouncementStatus $status = AnnouncementStatus::PENDING, public ?DateTimeImmutable $decidedAt = null, public ?int $decidedBy = null, ){} // Factory methods public static function createNew(...): self { } public static function proposeNew(...): self { } // Business methods public function approve(int $decidedBy): void { } public function reject(int $decidedBy): void { } public function isValid(): bool { } } Cechy Entity: - Ma identyfikator (ID) - Mo\u017ce by\u0107 modyfikowana - Zawiera zachowanie biznesowe (metody) - Definiuje regu\u0142y biznesowe (invariants)","title":"Entities"},{"location":"architecture/ddd/#value-objects","text":"Value Objects reprezentuj\u0105 warto\u015bci, kt\u00f3re nie zmieniaj\u0105 si\u0119 i nie maj\u0105 to\u017csamo\u015bci. // B\u0119d\u0105 w src/Domain/ValueObject/ gdy zostan\u0105 wprowadzone // Przyk\u0142ady: // - Email // - PhoneNumber // - DateRange // - Status Cechy Value Object: - Niezmienno\u015b\u0107 (immutable) - Brak ID - Por\u00f3wnanie po warto\u015bci, nie po referencji - Samodzielna walidacja","title":"Value Objects"},{"location":"architecture/ddd/#enums","text":"Wyliczenia dla typ\u00f3w i status\u00f3w domeny. enum AnnouncementStatus { case PENDING; case APPROVED; case REJECTED; }","title":"Enums"},{"location":"architecture/ddd/#exceptions","text":"Wyj\u0105tki domenowe reprezentuj\u0105ce b\u0142\u0119dy biznesowe. // W src/Domain/Exception/ class AnnouncementException extends DomainException { } class InvalidAnnouncementStatusException extends AnnouncementException { }","title":"Exceptions"},{"location":"architecture/ddd/#warstwa-application-srcapplication","text":"Odpowiedzialno\u015b\u0107 : Orkiestracja logiki biznesowej, przypadki u\u017cycia src/Application/ \u251c\u2500\u2500 UseCase/ # G\u0142\u00f3wne scenariusze u\u017cytkownika \u2502 \u251c\u2500\u2500 Announcement/ \u2502 \u2502 \u251c\u2500\u2500 CreateAnnouncementUseCase.php \u2502 \u2502 \u251c\u2500\u2500 ApproveAnnouncementUseCase.php \u2502 \u2502 \u2514\u2500\u2500 RejectAnnouncementUseCase.php \u2502 \u2514\u2500\u2500 ... \u2514\u2500\u2500 DataTransferObject/ # Obiekty transferu danych \u251c\u2500\u2500 AnnouncementDTO.php \u2514\u2500\u2500 ...","title":"Warstwa Application (src/Application)"},{"location":"architecture/ddd/#use-cases","text":"Use Case opisuje pojedynczy, znacz\u0105cy scenariusz u\u017cytkownika. // Struktura Use Case class CreateAnnouncementUseCase { public function __construct( private AnnouncementRepository $repository, // inne zale\u017cno\u015bci ) {} public function execute(CreateAnnouncementRequest $request): void { // 1. Validate request // 2. Create domain entity // 3. Call repository to save // 4. Trigger domain events (future) } } Charakterystyka Use Case: - Jedna odpowiedzialno\u015b\u0107 - Orkiestracja mi\u0119dzy Domain a Infrastructure - Brak logiki biznesowej (deleguje do Domain) - Obs\u0142uguje zdarzenia i b\u0142\u0119dy","title":"Use Cases"},{"location":"architecture/ddd/#data-transfer-objects-dtos","text":"DTOs transportuj\u0105 dane mi\u0119dzy warstwami bez logiki biznesowej. class AnnouncementDTO { public function __construct( public int $id, public string $title, public string $text, public string $status, // ... inne pola ) {} } Kiedy u\u017cywa\u0107 DTOs: - Transfer danych z HTTP Request/Response - Komunikacja mi\u0119dzy Use Cases - Serializacja/deserializacja","title":"Data Transfer Objects (DTOs)"},{"location":"architecture/ddd/#warstwa-infrastructure-srcinfrastructure","text":"Odpowiedzialno\u015b\u0107 : Implementacja technicznych szczeg\u00f3\u0142\u00f3w src/Infrastructure/ \u251c\u2500\u2500 Repository/ # Implementacja repozytori\u00f3w \u2502 \u251c\u2500\u2500 AnnouncementRepository.php \u2502 \u2514\u2500\u2500 UserRepository.php \u251c\u2500\u2500 Service/ # Serwisy zewn\u0119trzne \u2502 \u251c\u2500\u2500 ExternalApiService.php \u2502 \u2514\u2500\u2500 EmailService.php \u251c\u2500\u2500 Factory/ # Fabryki do tworzenia obiekt\u00f3w \u251c\u2500\u2500 Security/ # Komponenty bezpiecze\u0144stwa \u2502 \u251c\u2500\u2500 AuthenticationService.php \u2502 \u2514\u2500\u2500 PasswordHasher.php \u251c\u2500\u2500 Helper/ # Funkcje pomocnicze \u251c\u2500\u2500 Translation/ # T\u0142umaczenia \u251c\u2500\u2500 Trait/ # Traity wsp\u00f3lne \u251c\u2500\u2500 View/ # View helpers \u2514\u2500\u2500 Container.php # DI Container","title":"Warstwa Infrastructure (src/Infrastructure)"},{"location":"architecture/ddd/#repositories","text":"Repository abstrahuje dost\u0119p do danych (patrz: Repository Pattern). // Interface w Domain (nie istnieje tu, ale powinien) interface AnnouncementRepository { public function save(Announcement $announcement): void; public function findById(int $id): ?Announcement; public function findAll(): array; public function delete(Announcement $announcement): void; } // Implementacja w Infrastructure class DatabaseAnnouncementRepository implements AnnouncementRepository { public function save(Announcement $announcement): void { // SQL INSERT/UPDATE } public function findById(int $id): ?Announcement { // SQL SELECT } } Rola Repository: - Abstrakcja dost\u0119pu do danych - Brak SQL w Domain Layer - \u0141atwa zamiana implementacji (np. mock w testach) - Zgodno\u015b\u0107 z DIP (Dependency Inversion Principle)","title":"Repositories"},{"location":"architecture/ddd/#external-services","text":"Serwisy integruj\u0105ce si\u0119 z zewn\u0119trznymi API. class ExternalWordService { public function fetchDailyWord(): Word { // HTTP call do external API // Transformacja do Domain Entity } } class EmailService { public function send(string $email, string $message): void { // Sending email via SMTP/external service } }","title":"External Services"},{"location":"architecture/ddd/#factories","text":"Fabryki tworz\u0105 kompleksowe obiekty. class AnnouncementFactory { public static function createFromRequest( CreateAnnouncementRequest $request ): Announcement { return Announcement::createNew( title: $request->title, text: $request->text, validUntil: $request->validUntil, userId: $request->userId, ); } }","title":"Factories"},{"location":"architecture/ddd/#warstwa-presentation-srchttp-srcconsole","text":"Odpowiedzialno\u015b\u0107 : Interfejsy u\u017cytkownika (HTTP, CLI) src/Http/ \u251c\u2500\u2500 Controller/ # HTTP Controllers \u2502 \u251c\u2500\u2500 AnnouncementController.php \u2502 \u251c\u2500\u2500 UserController.php \u2502 \u2514\u2500\u2500 ... \u2514\u2500\u2500 Response/ # Response helpers src/Console/ \u2514\u2500\u2500 Command/ # CLI Commands \u251c\u2500\u2500 FetchDailyWordCommand.php \u251c\u2500\u2500 FetchDailyQuoteCommand.php \u2514\u2500\u2500 ... Charakterystyka Controllers: - Parsowanie HTTP Request - Delegowanie do Use Case - Formatowanie Response - Obs\u0142uga HTTP specific logic (routing, auth, validation)","title":"Warstwa Presentation (src/Http, src/Console)"},{"location":"architecture/ddd/#przepyw-danych","text":"","title":"\ud83d\udd04 Przep\u0142yw Danych"},{"location":"architecture/ddd/#typowy-scenariusz-tworzenie-ogoszenia","text":"1. HTTP Request (POST /announcements) \u2193 2. Controller (AnnouncementController) - Parsuje request - Waliduje wej\u015bcie \u2193 3. Use Case (CreateAnnouncementUseCase) - Tworzy DTO - Wywo\u0142a Domain Entity \u2193 4. Domain Entity (Announcement) - Aplikuje regu\u0142y biznesowe - Tworzy nowy agregat \u2193 5. Repository Interface \u2193 6. Repository Implementation (DatabaseAnnouncementRepository) - Wykonuje SQL INSERT - Zwraca entity z ID \u2193 7. Use Case - Zwraca success \u2193 8. Controller - Formatuje response (JSON) \u2193 9. HTTP Response (201 Created) graph TB A[\"HTTP Request<br/>(POST /announcements)\"] -->|Parse & Validate| B[\"Controller\"] B -->|Execute| C[\"Use Case\"] C -->|Create| D[\"Domain Entity\"] D -->|Follow Business Rules| E[\"Entity Created\"] C -->|Save| F[\"Repository Interface\"] F -->|Implement| G[\"Database<br/>Implementation\"] G -->|SQL INSERT| H[\"Database\"] H -->|Return Entity| G G -->|Return to UseCase| F F -->|Return to UseCase| C C -->|Return to Controller| B B -->|Format Response| I[\"HTTP Response<br/>(201 Created)\"]","title":"Typowy Scenariusz: Tworzenie Og\u0142oszenia"},{"location":"architecture/ddd/#invariants-niezminiki-biznesowe","text":"Invariants to regu\u0142y biznesowe, kt\u00f3re musz\u0105 by\u0107 spe\u0142nione.","title":"\ud83d\udee1\ufe0f Invariants (Niezminiki Biznesowe)"},{"location":"architecture/ddd/#announcement-invariants","text":"Announcement musi mie\u0107 unikalny tytu\u0142 (w kontek\u015bcie) Announcement musi mie\u0107 validUntil >= createdAt Zatwierdzenie zmienia status z PENDING na APPROVED Odrzucenie zmienia status z PENDING na REJECTED Og\u0142oszenie jest wa\u017cne tylko je\u015bli status=APPROVED i teraz < validUntil public function isValid(): bool { return $this->status === AnnouncementStatus::APPROVED && new DateTimeImmutable() <= $this->validUntil; }","title":"Announcement Invariants"},{"location":"architecture/ddd/#dependency-injection","text":"Projekt u\u017cywa DIY DI Container ( src/Infrastructure/Container.php ). // Container Registration $container->register( AnnouncementRepository::class, new DatabaseAnnouncementRepository($pdo) ); // Usage in Controller $container->get(AnnouncementRepository::class); Zasady: - Domain nie zale\u017cy od Infrastructure - Application zale\u017cy od Domain interfaces - Infrastructure implementuje Domain interfaces - Presentation zale\u017cy od Application i Domain","title":"\ud83d\udce6 Dependency Injection"},{"location":"architecture/ddd/#best-practices","text":"","title":"\ud83c\udf93 Best Practices"},{"location":"architecture/ddd/#domain-layer","text":"\u2705 DO: - Implementuj regu\u0142y biznesowe - U\u017cywaj Value Objects - Zwracaj Entity z metodami - Definiuj wyj\u0105tki domenowe \u274c DON'T: - Nie importuj Infrastructure - Nie r\u00f3b SQL queries - Nie parsuj JSON/XML - Nie loguj (przynajmniej nie w core)","title":"Domain Layer"},{"location":"architecture/ddd/#application-layer","text":"\u2705 DO: - Orkiestruj przypadki u\u017cycia - Waliduj DTOs - Transformuj mi\u0119dzy Domain a Presentation - Obs\u0142uguj transakcje \u274c DON'T: - Nie implementuj regu\u0142 biznesowych - Nie bezpo\u015brednio korzystaj z bazy - Nie mieszaj logiki r\u00f3\u017cnych Use Cases","title":"Application Layer"},{"location":"architecture/ddd/#infrastructure-layer","text":"\u2705 DO: - Implementuj Repository interfaces - Integruj z zewn\u0119trznymi serwisami - Zarz\u0105dzaj baza danych - Konfiguruj zale\u017cno\u015bci \u274c DON'T: - Nie implementuj regu\u0142 biznesowych - Nie u\u017cywaj Domain bezpo\u015brednio w SQL - Nie tw\u00f3rz Service Locator (u\u017cywaj DI)","title":"Infrastructure Layer"},{"location":"architecture/ddd/#presentation-layer","text":"\u2705 DO: - Parsuj HTTP requests - Waliduj input - Deleguj do Use Cases - Formatuj responses \u274c DON'T: - Nie implementuj logiki biznesowej - Nie dost\u0119puj bezpo\u015brednio do bazy - Nie r\u00f3b \u017cadnych transformacji Entity","title":"Presentation Layer"},{"location":"architecture/ddd/#relacje-miedzy-warstwami","text":"Domain Layer \u2191 \u2502 depends on (implements interface) \u2502 Application Layer \u2191 \u2502 depends on (calls) \u2502 Presentation Layer (Http, Console) Infrastructure Layer \u2502 implements \u2193 Domain Layer (interfaces only) Kluczowa Regu\u0142a : Infrastructure NIGDY nie importuje Application, Application importuje Domain interfaces kt\u00f3re s\u0105 implementowane w Infrastructure.","title":"\ud83d\udd17 Relacje Mi\u0119dzy Warstwami"},{"location":"architecture/ddd/#namespace-mapping","text":"Warstwa Namespace Przyk\u0142ad Domain App\\Domain\\ App\\Domain\\Entity\\Announcement Application App\\Application\\ App\\Application\\UseCase\\CreateAnnouncementUseCase Infrastructure App\\Infrastructure\\ App\\Infrastructure\\Repository\\DatabaseAnnouncementRepository Presentation App\\Http\\ / App\\Console\\ App\\Http\\Controller\\AnnouncementController","title":"\ud83d\udcda Namespace Mapping"},{"location":"architecture/ddd/#rozszerzanie-projektu","text":"Aby doda\u0107 now\u0105 funkcjonalno\u015b\u0107 (np. nowy modu\u0142): Stw\u00f3rz Entity w Domain php // src/Domain/Entity/NewEntity.php final class NewEntity { } Zdefiniuj Enums je\u015bli potrzebne php // src/Domain/Enum/NewEntityStatus.php enum NewEntityStatus { } Stw\u00f3rz Use Cases w Application php // src/Application/UseCase/CreateNewEntityUseCase.php class CreateNewEntityUseCase { } Implementuj Repository w Infrastructure php // src/Infrastructure/Repository/DatabaseNewEntityRepository.php class DatabaseNewEntityRepository { } Stw\u00f3rz Controller w Presentation php // src/Http/Controller/NewEntityController.php class NewEntityController { } Zarejestruj w DI Container php // src/Infrastructure/Container.php $container->register(NewEntityRepository::class, $implementation);","title":"\ud83d\ude80 Rozszerzanie Projektu"},{"location":"examples/practical_examples/","text":"Praktyczne Przyk\u0142ady i Wzorce Rzeczywiste przyk\u0142ady kodu pokazuj\u0105ce jak u\u017cywa\u0107 architektur\u0119 DDD w DoDomuDojad\u0119. \ud83d\udcdd Przyk\u0142ad 1: Tworzenie Og\u0142oszenia Scenariusz: Nowy admin chce stworzy\u0107 og\u0142oszenie HTTP POST /api/announcements { \"title\": \"Nowe godziny otwarcia\", \"text\": \"Od poniedzia\u0142ku b\u0119dziemy otwarci od 8:00 do 18:00\", \"valid_until\": \"2026-02-01T23:59:59Z\" } Krok 1: Controller (Presentation Layer) // src/Http/Controller/AnnouncementController.php class AnnouncementController { public function __construct( private Container $container, private LoggerInterface $logger ) {} public function create(Request $request): Response { try { // Parse JSON body $data = $request->json(); // Create Request object $createRequest = new CreateAnnouncementRequest( title: $data['title'] ?? '', text: $data['text'] ?? '', validUntil: $data['valid_until'] ?? '', userId: $request->userId() // from JWT token ); // Validate request $errors = $createRequest->validate(); if (!empty($errors)) { return Response::unprocessableEntity(['errors' => $errors]); } // Get UseCase from DI Container $useCase = $this->container->get(CreateAnnouncementUseCase::class); // Execute $announcementDTO = $useCase->execute($createRequest); return Response::created([ 'id' => $announcementDTO->id, 'title' => $announcementDTO->title, 'status' => $announcementDTO->status, 'created_at' => $announcementDTO->createdAt ]); } catch (ValidationException $e) { return Response::unprocessableEntity(['errors' => $e->getErrors()]); } catch (AnnouncementException $e) { return Response::badRequest(['error' => $e->getMessage()]); } catch (Exception $e) { $this->logger->error(\"Failed to create announcement\", ['error' => $e]); return Response::internalServerError(); } } } Krok 2: Use Case (Application Layer) // src/Application/UseCase/Announcement/CreateAnnouncementUseCase.php class CreateAnnouncementUseCase { public function __construct( private AnnouncementRepository $announcementRepository, private LoggerInterface $logger ) {} public function execute(CreateAnnouncementRequest $request): AnnouncementDTO { // Step 1: Validate request $errors = $request->validate(); if (!empty($errors)) { throw new ValidationException($errors); } // Step 2: Create Domain Entity using factory $announcement = AnnouncementFactory::createFromRequest( $request, userId: $request->userId ); // Step 3: Save to repository $this->announcementRepository->save($announcement); // Step 4: Log $this->logger->info(\"Announcement created\", [ 'id' => $announcement->id, 'title' => $announcement->title, 'userId' => $request->userId ]); // Step 5: Transform to DTO return AnnouncementDTO::fromEntity($announcement); } } Krok 3: Factory (Infrastructure Layer) // src/Infrastructure/Factory/AnnouncementFactory.php class AnnouncementFactory { public static function createFromRequest( CreateAnnouncementRequest $request, int $userId = null ): Announcement { return Announcement::createNew( title: $request->title, text: $request->text, validUntil: new DateTimeImmutable($request->validUntil), userId: $userId ?? $request->userId, ); } } Krok 4: Domain Entity (Domain Layer) // src/Domain/Entity/Announcement.php final class Announcement { public function __construct( public ?int $id, public string $title, public string $text, public DateTimeImmutable $createdAt, public DateTimeImmutable $validUntil, public ?int $userId, public AnnouncementStatus $status = AnnouncementStatus::PENDING, public ?DateTimeImmutable $decidedAt = null, public ?int $decidedBy = null, ){} // Factory method - tworzy ju\u017c zatwierdzone og\u0142oszenie public static function createNew( string $title, string $text, DateTimeImmutable $validUntil, int $userId, ): self { return new self( id: null, // Still null, will be set by DB title: $title, text: $text, createdAt: new DateTimeImmutable(), validUntil: $validUntil, userId: $userId, status: AnnouncementStatus::APPROVED, decidedAt: new DateTimeImmutable(), decidedBy: $userId // Admin who created it ); } } Krok 5: Repository (Infrastructure Layer) // src/Infrastructure/Repository/DatabaseAnnouncementRepository.php class DatabaseAnnouncementRepository { public function __construct(private PDO $pdo) {} public function save(Announcement $announcement): void { if ($announcement->id === null) { // INSERT $stmt = $this->pdo->prepare( 'INSERT INTO announcements ( title, text, created_at, valid_until, user_id, status, decided_at, decided_by ) VALUES ( :title, :text, :created_at, :valid_until, :user_id, :status, :decided_at, :decided_by )' ); $stmt->execute([ ':title' => $announcement->title, ':text' => $announcement->text, ':created_at' => $announcement->createdAt->format('c'), ':valid_until' => $announcement->validUntil->format('c'), ':user_id' => $announcement->userId, ':status' => $announcement->status->name, ':decided_at' => $announcement->decidedAt?->format('c'), ':decided_by' => $announcement->decidedBy, ]); // Get inserted ID and update entity $announcement->id = (int) $this->pdo->lastInsertId(); } else { // UPDATE $stmt = $this->pdo->prepare( 'UPDATE announcements SET title = :title, text = :text, status = :status, decided_at = :decided_at, decided_by = :decided_by WHERE id = :id' ); $stmt->execute([ ':id' => $announcement->id, ':title' => $announcement->title, ':text' => $announcement->text, ':status' => $announcement->status->name, ':decided_at' => $announcement->decidedAt?->format('c'), ':decided_by' => $announcement->decidedBy, ]); } } } Krok 6: DTO (Application Layer) // src/Application/DataTransferObject/AnnouncementDTO.php final class AnnouncementDTO { public function __construct( public int $id, public string $title, public string $text, public string $createdAt, public string $validUntil, public ?int $userId, public string $status, public ?string $decidedAt, public ?int $decidedBy, ) {} public static function fromEntity(Announcement $entity): self { return new self( id: $entity->id, title: $entity->title, text: $entity->text, createdAt: $entity->createdAt->format('c'), validUntil: $entity->validUntil->format('c'), userId: $entity->userId, status: $entity->status->name, decidedAt: $entity->decidedAt?->format('c'), decidedBy: $entity->decidedBy, ); } } HTTP Response HTTP 201 Created { \"id\": 42, \"title\": \"Nowe godziny otwarcia\", \"status\": \"approved\", \"created_at\": \"2026-01-02T10:42:00Z\" } \ud83d\udd04 Przyk\u0142ad 2: Zatwierdzanie Og\u0142oszenia Scenariusz: Admin zatwierdza oczekuj\u0105ce og\u0142oszenie HTTP POST /api/announcements/{id}/approve Controller public function approve(Request $request, int $id): Response { try { $useCase = $this->container->get(ApproveAnnouncementUseCase::class); $announcementDTO = $useCase->execute( announcementId: $id, adminId: $request->userId() ); return Response::ok([ 'message' => 'Announcement approved', 'announcement' => $announcementDTO ]); } catch (AnnouncementNotFoundException $e) { return Response::notFound(['error' => 'Announcement not found']); } catch (AnnouncementException $e) { return Response::badRequest(['error' => $e->getMessage()]); } } Use Case class ApproveAnnouncementUseCase { public function __construct( private AnnouncementRepository $repository ) {} public function execute(int $announcementId, int $adminId): AnnouncementDTO { // Pobierz z bazy $announcement = $this->repository->findById($announcementId); if (!$announcement) { throw new AnnouncementNotFoundException(); } if ($announcement->status !== AnnouncementStatus::PENDING) { throw new AnnouncementException( \"Cannot approve announcement that is not pending\" ); } // Aplikuj regu\u0142y biznesowe (logika w Domain!) $announcement->approve($adminId); // Zapisz $this->repository->save($announcement); // Zwr\u00f3\u0107 DTO return AnnouncementDTO::fromEntity($announcement); } } Domain Entity (Business Logic!) public function approve(int $decidedBy): void { // Business rule: Only PENDING can be approved // (implicit invariant, enforced by UseCase) $this->status = AnnouncementStatus::APPROVED; $this->decidedAt = new DateTimeImmutable(); $this->decidedBy = $decidedBy; } \ud83d\udd10 Przyk\u0142ad 3: Rejestracja U\u017cytkownika Controller public function register(Request $request): Response { try { $registerRequest = new RegisterUserRequest( email: $request->input('email'), password: $request->input('password'), name: $request->input('name'), phoneNumber: $request->input('phone_number') ); $useCase = $this->container->get(RegisterUserUseCase::class); $userDTO = $useCase->execute($registerRequest); return Response::created(['user' => $userDTO]); } catch (ValidationException $e) { return Response::unprocessableEntity(['errors' => $e->getErrors()]); } catch (UserException $e) { return Response::badRequest(['error' => $e->getMessage()]); } } Use Case class RegisterUserUseCase { public function __construct( private UserRepository $userRepository, private PasswordHasher $passwordHasher ) {} public function execute(RegisterUserRequest $request): UserDTO { // Waliduj $errors = $request->validate(); if (!empty($errors)) { throw new ValidationException($errors); } // Sprawd\u017a czy email ju\u017c istnieje if ($this->userRepository->existsByEmail($request->email)) { throw new UserException(\"Email already registered\"); } // Zahaszuj has\u0142o (Infrastructure concern) $passwordHash = $this->passwordHasher->hash($request->password); // Stw\u00f3rz Entity $user = new User( id: null, email: $request->email, passwordHash: $passwordHash, name: $request->name, phoneNumber: $request->phoneNumber, role: 'user' // Default role ); // Zapisz $this->userRepository->save($user); // Zwr\u00f3\u0107 DTO (bez has\u0142a!) return UserDTO::fromEntity($user); } } Request Object z Walidacj\u0105 class RegisterUserRequest { public function __construct( public string $email, public string $password, public string $name, public ?string $phoneNumber = null ) {} public function validate(): array { $errors = []; if (empty($this->email) || !filter_var($this->email, FILTER_VALIDATE_EMAIL)) { $errors['email'] = 'Valid email is required'; } if (strlen($this->password) < 8) { $errors['password'] = 'Password must be at least 8 characters'; } if (empty($this->name) || strlen($this->name) < 2) { $errors['name'] = 'Name must be at least 2 characters'; } if ($this->phoneNumber && !preg_match('/^\\d{9,}$/', $this->phoneNumber)) { $errors['phone'] = 'Invalid phone number format'; } return $errors; } } \ud83d\udcdd Przyk\u0142ad 4: Integracja z External API Scenariusz: CLI Command pobiera s\u0142owo dnia CLI Command (Presentation Layer) // src/Console/Command/FetchDailyWordCommand.php class FetchDailyWordCommand { public function __construct( private Container $container, private LoggerInterface $logger ) {} public function execute(): void { try { $useCase = $this->container->get(FetchAndSaveWordUseCase::class); $wordDTO = $useCase->execute(); echo \"\u2713 Word of the day saved: {$wordDTO->word}\\n\"; $this->logger->info(\"Daily word fetched\", ['word' => $wordDTO->word]); } catch (ExternalServiceException $e) { echo \"\u2717 Failed to fetch word: {$e->getMessage()}\\n\"; $this->logger->error(\"Failed to fetch daily word\", ['error' => $e]); exit(1); } } } Use Case class FetchAndSaveWordUseCase { public function __construct( private ExternalWordApiService $wordService, private WordRepository $wordRepository ) {} public function execute(): WordDTO { // Get from external API (Infrastructure) $word = $this->wordService->fetchDailyWord(); // Save to DB (Infrastructure) $this->wordRepository->save($word); // Return DTO return WordDTO::fromEntity($word); } } External Service class ExternalWordApiService { public function __construct( private HttpClient $client, private string $apiKey ) {} public function fetchDailyWord(): Word { try { // HTTP Call $response = $this->client->get( 'https://api.wordapi.com/daily', ['Authorization' => \"Bearer {$this->apiKey}\"] ); if ($response->status() !== 200) { throw new ExternalServiceException( \"API returned status {$response->status()}\" ); } $data = json_decode($response->body(), assoc: true); // Validate response structure if (!isset($data['word']) || !isset($data['definition'])) { throw new InvalidResponseException(\"Missing required fields\"); } // Transform to Domain Entity return new Word( id: null, word: $data['word'], definition: $data['definition'], example: $data['example'] ?? '', language: $data['language'] ?? 'en' ); } catch (HttpException $e) { throw new ExternalServiceException(\"Failed to fetch word\", cause: $e); } } } \ud83d\udee1\ufe0f Przyk\u0142ad 5: Error Handling Hierarchia Wyj\u0105tk\u00f3w // Domain Layer namespace App\\Domain\\Exception; abstract class DomainException extends Exception {} class AnnouncementException extends DomainException {} class UserException extends DomainException {} // Application Layer namespace App\\Application\\Exception; class ValidationException extends Exception { public function __construct( private array $errors ) {} public function getErrors(): array { return $this->errors; } } // Infrastructure Layer namespace App\\Infrastructure\\Exception; class DatabaseException extends Exception {} class ExternalServiceException extends Exception {} Controller - Comprehensive Error Handling public function create(Request $request): Response { try { // Happy path $request = new CreateAnnouncementRequest(...); $useCase = $this->container->get(CreateAnnouncementUseCase::class); $dto = $useCase->execute($request); return Response::created(['data' => $dto]); } catch (ValidationException $e) { // Client error - bad input return Response::unprocessableEntity([ 'error' => 'Validation failed', 'errors' => $e->getErrors() ]); } catch (AnnouncementException | UserException $e) { // Business logic error return Response::badRequest([ 'error' => $e->getMessage() ]); } catch (DatabaseException $e) { // Infrastructure error $this->logger->error(\"Database error\", ['error' => $e]); return Response::internalServerError([ 'error' => 'Failed to save announcement' ]); } catch (Exception $e) { // Unexpected error $this->logger->critical(\"Unexpected error\", ['error' => $e]); return Response::internalServerError([ 'error' => 'Internal server error' ]); } } \ud83d\udcca Diagram Flow - Kompletny Scenariusz USER \u2193 HTTP POST /api/announcements \u2193 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 PRESENTATION LAYER \u2502 \u2502 (AnnouncementController) \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 1. Parse JSON \u2502 \u2502 2. Create Request object \u2502 \u2502 3. Validate request \u2502 \u2502 4. Get UseCase from DI \u2502 \u2502 5. Execute UseCase \u2502 \u2502 6. Format Response \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2193 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 APPLICATION LAYER \u2502 \u2502 (CreateAnnouncementUseCase) \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 1. Validate request \u2502 \u2502 2. Call factory to create \u2502 \u2502 domain entity \u2502 \u2502 3. Call repository.save() \u2502 \u2502 4. Call DTO.fromEntity() \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2193 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 DOMAIN LAYER \u2502 \u2502 (Announcement Entity) \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 - Apply business rules \u2502 \u2502 - Ensure invariants \u2502 \u2502 - Return to UseCase \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2193 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 INFRASTRUCTURE LAYER \u2502 \u2502 (DatabaseAnnouncementRepository) \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 1. SQL INSERT \u2502 \u2502 2. Update ID \u2502 \u2502 3. Return to UseCase \u2502 \u2502 \u2502 \u2502 (Database) \u2502 \u2502 announcements table \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2193 HTTP 201 (JSON DTO) \u2193 USER \ud83c\udfaf Szybka Referencja Pattern\u00f3w Tworzenie Entity // Factory method w Entity $entity = Announcement::createNew(...); // Lub Factory pattern $entity = AnnouncementFactory::createFromRequest($request); Zapisanie Entity $repository->save($entity); // INSERT lub UPDATE Pobranie Entity $entity = $repository->findById($id); // Jedno $entities = $repository->findAll(); // Wiele $entities = $repository->findByStatus(); // Filtr Transformacja do DTO $dto = AnnouncementDTO::fromEntity($entity); Obs\u0142uga B\u0142\u0119d\u00f3w if ($errors = $request->validate()) { throw new ValidationException($errors); } if (!$entity) { throw new EntityNotFoundException(); } $entity->businessMethod(); // Rzuca DomainException je\u015bli invariant naruszony","title":"Examples"},{"location":"examples/practical_examples/#praktyczne-przykady-i-wzorce","text":"Rzeczywiste przyk\u0142ady kodu pokazuj\u0105ce jak u\u017cywa\u0107 architektur\u0119 DDD w DoDomuDojad\u0119.","title":"Praktyczne Przyk\u0142ady i Wzorce"},{"location":"examples/practical_examples/#przykad-1-tworzenie-ogoszenia","text":"","title":"\ud83d\udcdd Przyk\u0142ad 1: Tworzenie Og\u0142oszenia"},{"location":"examples/practical_examples/#scenariusz-nowy-admin-chce-stworzyc-ogoszenie","text":"HTTP POST /api/announcements { \"title\": \"Nowe godziny otwarcia\", \"text\": \"Od poniedzia\u0142ku b\u0119dziemy otwarci od 8:00 do 18:00\", \"valid_until\": \"2026-02-01T23:59:59Z\" }","title":"Scenariusz: Nowy admin chce stworzy\u0107 og\u0142oszenie"},{"location":"examples/practical_examples/#krok-1-controller-presentation-layer","text":"// src/Http/Controller/AnnouncementController.php class AnnouncementController { public function __construct( private Container $container, private LoggerInterface $logger ) {} public function create(Request $request): Response { try { // Parse JSON body $data = $request->json(); // Create Request object $createRequest = new CreateAnnouncementRequest( title: $data['title'] ?? '', text: $data['text'] ?? '', validUntil: $data['valid_until'] ?? '', userId: $request->userId() // from JWT token ); // Validate request $errors = $createRequest->validate(); if (!empty($errors)) { return Response::unprocessableEntity(['errors' => $errors]); } // Get UseCase from DI Container $useCase = $this->container->get(CreateAnnouncementUseCase::class); // Execute $announcementDTO = $useCase->execute($createRequest); return Response::created([ 'id' => $announcementDTO->id, 'title' => $announcementDTO->title, 'status' => $announcementDTO->status, 'created_at' => $announcementDTO->createdAt ]); } catch (ValidationException $e) { return Response::unprocessableEntity(['errors' => $e->getErrors()]); } catch (AnnouncementException $e) { return Response::badRequest(['error' => $e->getMessage()]); } catch (Exception $e) { $this->logger->error(\"Failed to create announcement\", ['error' => $e]); return Response::internalServerError(); } } }","title":"Krok 1: Controller (Presentation Layer)"},{"location":"examples/practical_examples/#krok-2-use-case-application-layer","text":"// src/Application/UseCase/Announcement/CreateAnnouncementUseCase.php class CreateAnnouncementUseCase { public function __construct( private AnnouncementRepository $announcementRepository, private LoggerInterface $logger ) {} public function execute(CreateAnnouncementRequest $request): AnnouncementDTO { // Step 1: Validate request $errors = $request->validate(); if (!empty($errors)) { throw new ValidationException($errors); } // Step 2: Create Domain Entity using factory $announcement = AnnouncementFactory::createFromRequest( $request, userId: $request->userId ); // Step 3: Save to repository $this->announcementRepository->save($announcement); // Step 4: Log $this->logger->info(\"Announcement created\", [ 'id' => $announcement->id, 'title' => $announcement->title, 'userId' => $request->userId ]); // Step 5: Transform to DTO return AnnouncementDTO::fromEntity($announcement); } }","title":"Krok 2: Use Case (Application Layer)"},{"location":"examples/practical_examples/#krok-3-factory-infrastructure-layer","text":"// src/Infrastructure/Factory/AnnouncementFactory.php class AnnouncementFactory { public static function createFromRequest( CreateAnnouncementRequest $request, int $userId = null ): Announcement { return Announcement::createNew( title: $request->title, text: $request->text, validUntil: new DateTimeImmutable($request->validUntil), userId: $userId ?? $request->userId, ); } }","title":"Krok 3: Factory (Infrastructure Layer)"},{"location":"examples/practical_examples/#krok-4-domain-entity-domain-layer","text":"// src/Domain/Entity/Announcement.php final class Announcement { public function __construct( public ?int $id, public string $title, public string $text, public DateTimeImmutable $createdAt, public DateTimeImmutable $validUntil, public ?int $userId, public AnnouncementStatus $status = AnnouncementStatus::PENDING, public ?DateTimeImmutable $decidedAt = null, public ?int $decidedBy = null, ){} // Factory method - tworzy ju\u017c zatwierdzone og\u0142oszenie public static function createNew( string $title, string $text, DateTimeImmutable $validUntil, int $userId, ): self { return new self( id: null, // Still null, will be set by DB title: $title, text: $text, createdAt: new DateTimeImmutable(), validUntil: $validUntil, userId: $userId, status: AnnouncementStatus::APPROVED, decidedAt: new DateTimeImmutable(), decidedBy: $userId // Admin who created it ); } }","title":"Krok 4: Domain Entity (Domain Layer)"},{"location":"examples/practical_examples/#krok-5-repository-infrastructure-layer","text":"// src/Infrastructure/Repository/DatabaseAnnouncementRepository.php class DatabaseAnnouncementRepository { public function __construct(private PDO $pdo) {} public function save(Announcement $announcement): void { if ($announcement->id === null) { // INSERT $stmt = $this->pdo->prepare( 'INSERT INTO announcements ( title, text, created_at, valid_until, user_id, status, decided_at, decided_by ) VALUES ( :title, :text, :created_at, :valid_until, :user_id, :status, :decided_at, :decided_by )' ); $stmt->execute([ ':title' => $announcement->title, ':text' => $announcement->text, ':created_at' => $announcement->createdAt->format('c'), ':valid_until' => $announcement->validUntil->format('c'), ':user_id' => $announcement->userId, ':status' => $announcement->status->name, ':decided_at' => $announcement->decidedAt?->format('c'), ':decided_by' => $announcement->decidedBy, ]); // Get inserted ID and update entity $announcement->id = (int) $this->pdo->lastInsertId(); } else { // UPDATE $stmt = $this->pdo->prepare( 'UPDATE announcements SET title = :title, text = :text, status = :status, decided_at = :decided_at, decided_by = :decided_by WHERE id = :id' ); $stmt->execute([ ':id' => $announcement->id, ':title' => $announcement->title, ':text' => $announcement->text, ':status' => $announcement->status->name, ':decided_at' => $announcement->decidedAt?->format('c'), ':decided_by' => $announcement->decidedBy, ]); } } }","title":"Krok 5: Repository (Infrastructure Layer)"},{"location":"examples/practical_examples/#krok-6-dto-application-layer","text":"// src/Application/DataTransferObject/AnnouncementDTO.php final class AnnouncementDTO { public function __construct( public int $id, public string $title, public string $text, public string $createdAt, public string $validUntil, public ?int $userId, public string $status, public ?string $decidedAt, public ?int $decidedBy, ) {} public static function fromEntity(Announcement $entity): self { return new self( id: $entity->id, title: $entity->title, text: $entity->text, createdAt: $entity->createdAt->format('c'), validUntil: $entity->validUntil->format('c'), userId: $entity->userId, status: $entity->status->name, decidedAt: $entity->decidedAt?->format('c'), decidedBy: $entity->decidedBy, ); } }","title":"Krok 6: DTO (Application Layer)"},{"location":"examples/practical_examples/#http-response","text":"HTTP 201 Created { \"id\": 42, \"title\": \"Nowe godziny otwarcia\", \"status\": \"approved\", \"created_at\": \"2026-01-02T10:42:00Z\" }","title":"HTTP Response"},{"location":"examples/practical_examples/#przykad-2-zatwierdzanie-ogoszenia","text":"","title":"\ud83d\udd04 Przyk\u0142ad 2: Zatwierdzanie Og\u0142oszenia"},{"location":"examples/practical_examples/#scenariusz-admin-zatwierdza-oczekujace-ogoszenie","text":"HTTP POST /api/announcements/{id}/approve","title":"Scenariusz: Admin zatwierdza oczekuj\u0105ce og\u0142oszenie"},{"location":"examples/practical_examples/#controller","text":"public function approve(Request $request, int $id): Response { try { $useCase = $this->container->get(ApproveAnnouncementUseCase::class); $announcementDTO = $useCase->execute( announcementId: $id, adminId: $request->userId() ); return Response::ok([ 'message' => 'Announcement approved', 'announcement' => $announcementDTO ]); } catch (AnnouncementNotFoundException $e) { return Response::notFound(['error' => 'Announcement not found']); } catch (AnnouncementException $e) { return Response::badRequest(['error' => $e->getMessage()]); } }","title":"Controller"},{"location":"examples/practical_examples/#use-case","text":"class ApproveAnnouncementUseCase { public function __construct( private AnnouncementRepository $repository ) {} public function execute(int $announcementId, int $adminId): AnnouncementDTO { // Pobierz z bazy $announcement = $this->repository->findById($announcementId); if (!$announcement) { throw new AnnouncementNotFoundException(); } if ($announcement->status !== AnnouncementStatus::PENDING) { throw new AnnouncementException( \"Cannot approve announcement that is not pending\" ); } // Aplikuj regu\u0142y biznesowe (logika w Domain!) $announcement->approve($adminId); // Zapisz $this->repository->save($announcement); // Zwr\u00f3\u0107 DTO return AnnouncementDTO::fromEntity($announcement); } }","title":"Use Case"},{"location":"examples/practical_examples/#domain-entity-business-logic","text":"public function approve(int $decidedBy): void { // Business rule: Only PENDING can be approved // (implicit invariant, enforced by UseCase) $this->status = AnnouncementStatus::APPROVED; $this->decidedAt = new DateTimeImmutable(); $this->decidedBy = $decidedBy; }","title":"Domain Entity (Business Logic!)"},{"location":"examples/practical_examples/#przykad-3-rejestracja-uzytkownika","text":"","title":"\ud83d\udd10 Przyk\u0142ad 3: Rejestracja U\u017cytkownika"},{"location":"examples/practical_examples/#controller_1","text":"public function register(Request $request): Response { try { $registerRequest = new RegisterUserRequest( email: $request->input('email'), password: $request->input('password'), name: $request->input('name'), phoneNumber: $request->input('phone_number') ); $useCase = $this->container->get(RegisterUserUseCase::class); $userDTO = $useCase->execute($registerRequest); return Response::created(['user' => $userDTO]); } catch (ValidationException $e) { return Response::unprocessableEntity(['errors' => $e->getErrors()]); } catch (UserException $e) { return Response::badRequest(['error' => $e->getMessage()]); } }","title":"Controller"},{"location":"examples/practical_examples/#use-case_1","text":"class RegisterUserUseCase { public function __construct( private UserRepository $userRepository, private PasswordHasher $passwordHasher ) {} public function execute(RegisterUserRequest $request): UserDTO { // Waliduj $errors = $request->validate(); if (!empty($errors)) { throw new ValidationException($errors); } // Sprawd\u017a czy email ju\u017c istnieje if ($this->userRepository->existsByEmail($request->email)) { throw new UserException(\"Email already registered\"); } // Zahaszuj has\u0142o (Infrastructure concern) $passwordHash = $this->passwordHasher->hash($request->password); // Stw\u00f3rz Entity $user = new User( id: null, email: $request->email, passwordHash: $passwordHash, name: $request->name, phoneNumber: $request->phoneNumber, role: 'user' // Default role ); // Zapisz $this->userRepository->save($user); // Zwr\u00f3\u0107 DTO (bez has\u0142a!) return UserDTO::fromEntity($user); } }","title":"Use Case"},{"location":"examples/practical_examples/#request-object-z-walidacja","text":"class RegisterUserRequest { public function __construct( public string $email, public string $password, public string $name, public ?string $phoneNumber = null ) {} public function validate(): array { $errors = []; if (empty($this->email) || !filter_var($this->email, FILTER_VALIDATE_EMAIL)) { $errors['email'] = 'Valid email is required'; } if (strlen($this->password) < 8) { $errors['password'] = 'Password must be at least 8 characters'; } if (empty($this->name) || strlen($this->name) < 2) { $errors['name'] = 'Name must be at least 2 characters'; } if ($this->phoneNumber && !preg_match('/^\\d{9,}$/', $this->phoneNumber)) { $errors['phone'] = 'Invalid phone number format'; } return $errors; } }","title":"Request Object z Walidacj\u0105"},{"location":"examples/practical_examples/#przykad-4-integracja-z-external-api","text":"","title":"\ud83d\udcdd Przyk\u0142ad 4: Integracja z External API"},{"location":"examples/practical_examples/#scenariusz-cli-command-pobiera-sowo-dnia","text":"","title":"Scenariusz: CLI Command pobiera s\u0142owo dnia"},{"location":"examples/practical_examples/#cli-command-presentation-layer","text":"// src/Console/Command/FetchDailyWordCommand.php class FetchDailyWordCommand { public function __construct( private Container $container, private LoggerInterface $logger ) {} public function execute(): void { try { $useCase = $this->container->get(FetchAndSaveWordUseCase::class); $wordDTO = $useCase->execute(); echo \"\u2713 Word of the day saved: {$wordDTO->word}\\n\"; $this->logger->info(\"Daily word fetched\", ['word' => $wordDTO->word]); } catch (ExternalServiceException $e) { echo \"\u2717 Failed to fetch word: {$e->getMessage()}\\n\"; $this->logger->error(\"Failed to fetch daily word\", ['error' => $e]); exit(1); } } }","title":"CLI Command (Presentation Layer)"},{"location":"examples/practical_examples/#use-case_2","text":"class FetchAndSaveWordUseCase { public function __construct( private ExternalWordApiService $wordService, private WordRepository $wordRepository ) {} public function execute(): WordDTO { // Get from external API (Infrastructure) $word = $this->wordService->fetchDailyWord(); // Save to DB (Infrastructure) $this->wordRepository->save($word); // Return DTO return WordDTO::fromEntity($word); } }","title":"Use Case"},{"location":"examples/practical_examples/#external-service","text":"class ExternalWordApiService { public function __construct( private HttpClient $client, private string $apiKey ) {} public function fetchDailyWord(): Word { try { // HTTP Call $response = $this->client->get( 'https://api.wordapi.com/daily', ['Authorization' => \"Bearer {$this->apiKey}\"] ); if ($response->status() !== 200) { throw new ExternalServiceException( \"API returned status {$response->status()}\" ); } $data = json_decode($response->body(), assoc: true); // Validate response structure if (!isset($data['word']) || !isset($data['definition'])) { throw new InvalidResponseException(\"Missing required fields\"); } // Transform to Domain Entity return new Word( id: null, word: $data['word'], definition: $data['definition'], example: $data['example'] ?? '', language: $data['language'] ?? 'en' ); } catch (HttpException $e) { throw new ExternalServiceException(\"Failed to fetch word\", cause: $e); } } }","title":"External Service"},{"location":"examples/practical_examples/#przykad-5-error-handling","text":"","title":"\ud83d\udee1\ufe0f Przyk\u0142ad 5: Error Handling"},{"location":"examples/practical_examples/#hierarchia-wyjatkow","text":"// Domain Layer namespace App\\Domain\\Exception; abstract class DomainException extends Exception {} class AnnouncementException extends DomainException {} class UserException extends DomainException {} // Application Layer namespace App\\Application\\Exception; class ValidationException extends Exception { public function __construct( private array $errors ) {} public function getErrors(): array { return $this->errors; } } // Infrastructure Layer namespace App\\Infrastructure\\Exception; class DatabaseException extends Exception {} class ExternalServiceException extends Exception {}","title":"Hierarchia Wyj\u0105tk\u00f3w"},{"location":"examples/practical_examples/#controller-comprehensive-error-handling","text":"public function create(Request $request): Response { try { // Happy path $request = new CreateAnnouncementRequest(...); $useCase = $this->container->get(CreateAnnouncementUseCase::class); $dto = $useCase->execute($request); return Response::created(['data' => $dto]); } catch (ValidationException $e) { // Client error - bad input return Response::unprocessableEntity([ 'error' => 'Validation failed', 'errors' => $e->getErrors() ]); } catch (AnnouncementException | UserException $e) { // Business logic error return Response::badRequest([ 'error' => $e->getMessage() ]); } catch (DatabaseException $e) { // Infrastructure error $this->logger->error(\"Database error\", ['error' => $e]); return Response::internalServerError([ 'error' => 'Failed to save announcement' ]); } catch (Exception $e) { // Unexpected error $this->logger->critical(\"Unexpected error\", ['error' => $e]); return Response::internalServerError([ 'error' => 'Internal server error' ]); } }","title":"Controller - Comprehensive Error Handling"},{"location":"examples/practical_examples/#diagram-flow-kompletny-scenariusz","text":"USER \u2193 HTTP POST /api/announcements \u2193 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 PRESENTATION LAYER \u2502 \u2502 (AnnouncementController) \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 1. Parse JSON \u2502 \u2502 2. Create Request object \u2502 \u2502 3. Validate request \u2502 \u2502 4. Get UseCase from DI \u2502 \u2502 5. Execute UseCase \u2502 \u2502 6. Format Response \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2193 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 APPLICATION LAYER \u2502 \u2502 (CreateAnnouncementUseCase) \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 1. Validate request \u2502 \u2502 2. Call factory to create \u2502 \u2502 domain entity \u2502 \u2502 3. Call repository.save() \u2502 \u2502 4. Call DTO.fromEntity() \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2193 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 DOMAIN LAYER \u2502 \u2502 (Announcement Entity) \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 - Apply business rules \u2502 \u2502 - Ensure invariants \u2502 \u2502 - Return to UseCase \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2193 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 INFRASTRUCTURE LAYER \u2502 \u2502 (DatabaseAnnouncementRepository) \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 1. SQL INSERT \u2502 \u2502 2. Update ID \u2502 \u2502 3. Return to UseCase \u2502 \u2502 \u2502 \u2502 (Database) \u2502 \u2502 announcements table \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2193 HTTP 201 (JSON DTO) \u2193 USER","title":"\ud83d\udcca Diagram Flow - Kompletny Scenariusz"},{"location":"examples/practical_examples/#szybka-referencja-patternow","text":"","title":"\ud83c\udfaf Szybka Referencja Pattern\u00f3w"},{"location":"examples/practical_examples/#tworzenie-entity","text":"// Factory method w Entity $entity = Announcement::createNew(...); // Lub Factory pattern $entity = AnnouncementFactory::createFromRequest($request);","title":"Tworzenie Entity"},{"location":"examples/practical_examples/#zapisanie-entity","text":"$repository->save($entity); // INSERT lub UPDATE","title":"Zapisanie Entity"},{"location":"examples/practical_examples/#pobranie-entity","text":"$entity = $repository->findById($id); // Jedno $entities = $repository->findAll(); // Wiele $entities = $repository->findByStatus(); // Filtr","title":"Pobranie Entity"},{"location":"examples/practical_examples/#transformacja-do-dto","text":"$dto = AnnouncementDTO::fromEntity($entity);","title":"Transformacja do DTO"},{"location":"examples/practical_examples/#obsuga-bedow","text":"if ($errors = $request->validate()) { throw new ValidationException($errors); } if (!$entity) { throw new EntityNotFoundException(); } $entity->businessMethod(); // Rzuca DomainException je\u015bli invariant naruszony","title":"Obs\u0142uga B\u0142\u0119d\u00f3w"},{"location":"layers/application/","text":"Application Layer - API Reference Warstwa Application orkiestruje logik\u0119 biznesow\u0105, koordinuj\u0105c interakcje mi\u0119dzy Presentation a Domain Layer. \ud83d\udccd Struktura Application Layer src/Application/ \u251c\u2500\u2500 UseCase/ # G\u0142\u00f3wne scenariusze u\u017cytkownika \u2502 \u251c\u2500\u2500 Announcement/ \u2502 \u2502 \u251c\u2500\u2500 CreateAnnouncementUseCase.php \u2502 \u2502 \u251c\u2500\u2500 ApproveAnnouncementUseCase.php \u2502 \u2502 \u251c\u2500\u2500 RejectAnnouncementUseCase.php \u2502 \u2502 \u251c\u2500\u2500 DeleteAnnouncementUseCase.php \u2502 \u2502 \u2514\u2500\u2500 ListAnnouncementsUseCase.php \u2502 \u251c\u2500\u2500 Word/ \u2502 \u2502 \u251c\u2500\u2500 CreateWordUseCase.php \u2502 \u2502 \u251c\u2500\u2500 UpdateWordUseCase.php \u2502 \u2502 \u2514\u2500\u2500 ListWordsUseCase.php \u2502 \u251c\u2500\u2500 Quote/ \u2502 \u2502 \u2514\u2500\u2500 ... (similar structure) \u2502 \u251c\u2500\u2500 User/ \u2502 \u2502 \u251c\u2500\u2500 RegisterUserUseCase.php \u2502 \u2502 \u251c\u2500\u2500 LoginUserUseCase.php \u2502 \u2502 \u2514\u2500\u2500 UpdateUserUseCase.php \u2502 \u2514\u2500\u2500 Module/ \u2502 \u2514\u2500\u2500 ... \u2514\u2500\u2500 DataTransferObject/ # Data Transfer Objects \u251c\u2500\u2500 AnnouncementDTO.php \u251c\u2500\u2500 UserDTO.php \u251c\u2500\u2500 WordDTO.php \u251c\u2500\u2500 QuoteDTO.php \u2514\u2500\u2500 ... Namespace : App\\Application\\ \ud83c\udfac Use Cases Use Case reprezentuje pojedynczy, znacz\u0105cy scenariusz u\u017cytkownika. Announcement Use Cases CreateAnnouncementUseCase Lokalizacja : src/Application/UseCase/Announcement/CreateAnnouncementUseCase.php Odpowiedzialno\u015b\u0107 : Obs\u0142uga tworzenia nowego og\u0142oszenia Zale\u017cno\u015bci : public function __construct( private AnnouncementRepository $announcementRepository, private LoggerInterface $logger ) Metoda Execute : public function execute(CreateAnnouncementRequest $request): AnnouncementDTO Parametry : CreateAnnouncementRequest - string $title - Tytu\u0142 og\u0142oszenia - string $text - Tre\u015b\u0107 og\u0142oszenia - string $validUntil - Data wyga\u015bni\u0119cia (ISO 8601) - int $userId - ID tw\u00f3rcy (opcjonalnie) Zwraca : AnnouncementDTO - Nowe og\u0142oszenie Flow : 1. Waliduje request (tytu\u0142, tekst nie puste, validUntil w przysz\u0142o\u015bci) 2. Tworzy Domain Entity (Announcement) 3. Zapisuje w Repository 4. Zwraca DTO dla front-endu Wyj\u0105tki : - AnnouncementException - B\u0142\u0105d biznesowy - ValidationException - B\u0142\u0105d walidacji U\u017cycie w Controller : class AnnouncementController { public function __construct( private CreateAnnouncementUseCase $useCase ) {} public function create(Request $request): Response { try { $dto = new CreateAnnouncementRequest( title: $request->input('title'), text: $request->input('text'), validUntil: $request->input('valid_until'), userId: $request->userId // from auth ); $result = $this->useCase->execute($dto); return Response::created($result); } catch (ValidationException $e) { return Response::badRequest($e->getMessage()); } } } ApproveAnnouncementUseCase Lokalizacja : src/Application/UseCase/Announcement/ApproveAnnouncementUseCase.php Odpowiedzialno\u015b\u0107 : Zatwierdzenie og\u0142oszenia oczekuj\u0105cego Metoda Execute : public function execute(int $announcementId, int $adminId): AnnouncementDTO Parametry : - int $announcementId - ID og\u0142oszenia do zatwierdzenia - int $adminId - ID admina zatwierdzaj\u0105cego Zwraca : AnnouncementDTO - Zatwierdzone og\u0142oszenie Flow : 1. Pobiera Announcement z Repository 2. Sprawdza czy istnieje i ma status PENDING 3. Wywo\u0142a $announcement->approve($adminId) (logika domenowa) 4. Zapisuje w Repository 5. Zwraca DTO Wyj\u0105tki : - AnnouncementNotFoundException - AnnouncementException - Je\u015bli status nie PENDING RejectAnnouncementUseCase Lokalizacja : src/Application/UseCase/Announcement/RejectAnnouncementUseCase.php Odpowiedzialno\u015b\u0107 : Odrzucenie og\u0142oszenia oczekuj\u0105cego Metoda Execute : public function execute(int $announcementId, int $adminId, string $reason): AnnouncementDTO Parametry : - int $announcementId - ID og\u0142oszenia do odrzucenia - int $adminId - ID admina odrzucaj\u0105cego - string $reason - Pow\u00f3d odrzucenia (dla archiwum) Zwraca : AnnouncementDTO - Odrzucone og\u0142oszenie ListAnnouncementsUseCase Lokalizacja : src/Application/UseCase/Announcement/ListAnnouncementsUseCase.php Odpowiedzialno\u015b\u0107 : Pobranie listy aktualnych og\u0142osze\u0144 Metoda Execute : public function execute(ListAnnouncementsRequest $request): array Parametry : ListAnnouncementsRequest - int $page = 1 - Numer strony - int $perPage = 10 - Ilo\u015b\u0107 na stron\u0119 - string $status = 'approved' - Filtr po statusie - bool $validOnly = true - Czy tylko wa\u017cne Zwraca : array<AnnouncementDTO> - Lista og\u0142osze\u0144 Flow : 1. Buduje query z filtrami 2. Stosuje paginacj\u0119 3. Pobiera z Repository 4. Transformuje do DTOs 5. Zwraca wraz z metadanymi User Use Cases RegisterUserUseCase Lokalizacja : src/Application/UseCase/User/RegisterUserUseCase.php Odpowiedzialno\u015b\u0107 : Rejestracja nowego u\u017cytkownika Metoda Execute : public function execute(RegisterUserRequest $request): UserDTO Parametry : RegisterUserRequest - string $email - Email u\u017cytkownika - string $password - Has\u0142o (raw) - string $name - Nazwa u\u017cytkownika - ?string $phoneNumber - Numer telefonu Zwraca : UserDTO - Nowy u\u017cytkownik (bez has\u0142a!) Walidacja : - Email nie mo\u017ce istnie\u0107 - Has\u0142o musi spe\u0142nia\u0107 wymagania - Email musi by\u0107 wa\u017cny Bezpiecze\u0144stwo : - Has\u0142o zahaszowane na level Infra (SecurityService) - Brak has\u0142a w response LoginUserUseCase Lokalizacja : src/Application/UseCase/User/LoginUserUseCase.php Odpowiedzialno\u015b\u0107 : Logowanie u\u017cytkownika Metoda Execute : public function execute(LoginUserRequest $request): LoginResponse Parametry : LoginUserRequest - string $email - Email - string $password - Has\u0142o (raw) Zwraca : LoginResponse - UserDTO $user - string $token - JWT lub session token Word Use Cases CreateWordUseCase Lokalizacja : src/Application/UseCase/Word/CreateWordUseCase.php Tworzy nowe s\u0142owo dnia. ListWordsUseCase Pobiera s\u0142owa z paginacj\u0105. \ud83d\udce6 Data Transfer Objects (DTOs) DTOs transportuj\u0105 dane mi\u0119dzy warstwami bez logiki biznesowej. AnnouncementDTO Lokalizacja : src/Application/DataTransferObject/AnnouncementDTO.php final class AnnouncementDTO { public function __construct( public int $id, public string $title, public string $text, public string $createdAt, // ISO 8601 public string $validUntil, // ISO 8601 public ?int $userId, public string $status, // 'pending', 'approved', 'rejected' public ?string $decidedAt, // ISO 8601 public ?int $decidedBy, ) {} public static function fromEntity(Announcement $entity): self { return new self( id: $entity->id, title: $entity->title, text: $entity->text, createdAt: $entity->createdAt->format('c'), validUntil: $entity->validUntil->format('c'), userId: $entity->userId, status: $entity->status->name, decidedAt: $entity->decidedAt?->format('c'), decidedBy: $entity->decidedBy, ); } } U\u017cycie : Transformacja Entity \u2192 JSON Response return [ 'data' => AnnouncementDTO::fromEntity($announcement) ]; UserDTO Lokalizacja : src/Application/DataTransferObject/UserDTO.php final class UserDTO { public function __construct( public int $id, public string $email, public string $name, public ?string $phoneNumber, public string $role, // UWAGA: Nigdy nie include password! ) {} public static function fromEntity(User $entity): self { return new self( id: $entity->id, email: $entity->email, name: $entity->name, phoneNumber: $entity->phoneNumber, role: $entity->role, ); } } \ud83c\udfd7\ufe0f Request Objects (Request DTOs) Request objects enkapsuluj\u0105 dane wej\u015bciowe. CreateAnnouncementRequest final class CreateAnnouncementRequest { public function __construct( public string $title, public string $text, public string $validUntil, // ISO 8601 public ?int $userId = null, ) {} public function validate(): array { $errors = []; if (empty($this->title)) { $errors[] = \"Title is required\"; } if (strlen($this->title) > 200) { $errors[] = \"Title is too long\"; } if (empty($this->text)) { $errors[] = \"Text is required\"; } if (strlen($this->text) > 5000) { $errors[] = \"Text is too long\"; } try { $date = new DateTimeImmutable($this->validUntil); if ($date <= new DateTimeImmutable()) { $errors[] = \"Valid until must be in the future\"; } } catch (Exception $e) { $errors[] = \"Invalid date format\"; } return $errors; } public function isValid(): bool { return empty($this->validate()); } } U\u017cycie w Use Case : public function execute(CreateAnnouncementRequest $request): AnnouncementDTO { $errors = $request->validate(); if (!empty($errors)) { throw new ValidationException($errors); } // ... proceed } \ud83d\udd04 Typowy Flow Use Case HTTP Request \u2193 Controller \u251c\u2500 1. Parse request \u2192 CreateAnnouncementRequest \u251c\u2500 2. Get UseCase from DI Container \u251c\u2500 3. Call useCase->execute($request) \u2193 UseCase \u251c\u2500 1. Validate request ($request->validate()) \u251c\u2500 2. Create Domain Entity (Announcement::createNew()) \u251c\u2500 3. Save via Repository \u251c\u2500 4. Transform to DTO \u251c\u2500 5. Return DTO \u2193 Controller \u251c\u2500 1. Format DTO to JSON \u251c\u2500 2. Return HTTP Response \u2193 HTTP Response (JSON) graph TB A[\"HTTP Request<br/>(POST /announcements)\"] -->|Parse| B[\"Controller\"] B -->|Extract Data| C[\"Request Object\"] C -->|Pass to| D[\"UseCase\"] D -->|Validate| C D -->|Check Entity| E[\"Domain Entity\"] E -->|Apply Rules| F[\"Valid Entity\"] D -->|Save| G[\"Repository\"] G -->|SQL INSERT| H[\"Database\"] H -->|Return| G G -->|Return to UseCase| D D -->|Transform| I[\"DTO\"] I -->|Return to Controller| B B -->|Format| J[\"JSON Response\"] J -->|Send| K[\"HTTP Response\"] \ud83d\udee1\ufe0f Exception Handling Use Cases powinny zg\u0142asza\u0107 wyj\u0105tki domenowe, kt\u00f3re s\u0105 obs\u0142ugiwane na level Controllera. // UseCase try { $announcement = $this->repository->findById($id); if (!$announcement) { throw new AnnouncementNotFoundException(); } } catch (DatabaseException $e) { throw new AnnouncementException(\"Failed to fetch announcement\"); } // Controller try { $dto = $this->useCase->execute($request); return Response::ok($dto); } catch (AnnouncementNotFoundException $e) { return Response::notFound(\"Announcement not found\"); } catch (AnnouncementException $e) { return Response::badRequest($e->getMessage()); } catch (ValidationException $e) { return Response::unprocessableEntity($e->getErrors()); } catch (Exception $e) { $this->logger->error($e); return Response::internalServerError(); } \ud83d\udcca Request \u2192 UseCase \u2192 Response Pattern Etap Komponenta Format 1 HTTP Body JSON 2 Controller Array 3 Request Object Typed Object 4 UseCase DTO 5 Response JSON \ud83c\udf93 Best Practices \u2705 DO Waliduj ka\u017cdy Request php $errors = $request->validate(); if (!empty($errors)) { throw new ValidationException($errors); } U\u017cyj jednego Use Case na scenariusz ```php // \u2705 GOOD class CreateAnnouncementUseCase { } class ApproveAnnouncementUseCase { } // \u274c BAD class AnnouncementUseCase { // trop wiele odpowiedzialno\u015bci } ``` Transformuj Entity do DTOs php $dto = AnnouncementDTO::fromEntity($entity); return $dto; Deleguj logik\u0119 biznesow\u0105 do Domain php $announcement->approve($adminId); // Domain handles rules Obs\u0142uguj wyj\u0105tki domenowe php } catch (AnnouncementException $e) { return Response::badRequest($e->getMessage()); } \u274c DON'T Nie r\u00f3b SQL w Use Case php // \u274c WRONG $result = $this->pdo->query(\"SELECT...\"); Nie mieszaj logiki z r\u00f3\u017cnych scenariuszy php // \u274c WRONG class AnnouncementUseCase { public function create() { } public function approve() { } public function list() { } } Nie zwracaj Entity bezpo\u015brednio ```php // \u274c WRONG return $entity; // Expose domain model // \u2705 RIGHT return AnnouncementDTO::fromEntity($entity); ``` Nie pomi\u0144 walidacji ```php // \u274c WRONG public function execute($request) { // Assume input is valid } // \u2705 RIGHT public function execute($request) { $errors = $request->validate(); if (!empty($errors)) throw new ValidationException(); } ``` \ud83d\udcda Use Case Checklist Przy tworzeniu nowego Use Case pami\u0119taj aby: [ ] Unikalny scenariusz (jedna odpowiedzialno\u015b\u0107) [ ] Request object z walidacj\u0105 [ ] Walidacja w execute() [ ] Domain Entity creation/manipulation [ ] Repository call (save, find, etc) [ ] Exception handling [ ] DTO transformation [ ] Clear return type [ ] Unit tests [ ] Documentation","title":"Application Layer - API Reference"},{"location":"layers/application/#application-layer-api-reference","text":"Warstwa Application orkiestruje logik\u0119 biznesow\u0105, koordinuj\u0105c interakcje mi\u0119dzy Presentation a Domain Layer.","title":"Application Layer - API Reference"},{"location":"layers/application/#struktura-application-layer","text":"src/Application/ \u251c\u2500\u2500 UseCase/ # G\u0142\u00f3wne scenariusze u\u017cytkownika \u2502 \u251c\u2500\u2500 Announcement/ \u2502 \u2502 \u251c\u2500\u2500 CreateAnnouncementUseCase.php \u2502 \u2502 \u251c\u2500\u2500 ApproveAnnouncementUseCase.php \u2502 \u2502 \u251c\u2500\u2500 RejectAnnouncementUseCase.php \u2502 \u2502 \u251c\u2500\u2500 DeleteAnnouncementUseCase.php \u2502 \u2502 \u2514\u2500\u2500 ListAnnouncementsUseCase.php \u2502 \u251c\u2500\u2500 Word/ \u2502 \u2502 \u251c\u2500\u2500 CreateWordUseCase.php \u2502 \u2502 \u251c\u2500\u2500 UpdateWordUseCase.php \u2502 \u2502 \u2514\u2500\u2500 ListWordsUseCase.php \u2502 \u251c\u2500\u2500 Quote/ \u2502 \u2502 \u2514\u2500\u2500 ... (similar structure) \u2502 \u251c\u2500\u2500 User/ \u2502 \u2502 \u251c\u2500\u2500 RegisterUserUseCase.php \u2502 \u2502 \u251c\u2500\u2500 LoginUserUseCase.php \u2502 \u2502 \u2514\u2500\u2500 UpdateUserUseCase.php \u2502 \u2514\u2500\u2500 Module/ \u2502 \u2514\u2500\u2500 ... \u2514\u2500\u2500 DataTransferObject/ # Data Transfer Objects \u251c\u2500\u2500 AnnouncementDTO.php \u251c\u2500\u2500 UserDTO.php \u251c\u2500\u2500 WordDTO.php \u251c\u2500\u2500 QuoteDTO.php \u2514\u2500\u2500 ... Namespace : App\\Application\\","title":"\ud83d\udccd Struktura Application Layer"},{"location":"layers/application/#use-cases","text":"Use Case reprezentuje pojedynczy, znacz\u0105cy scenariusz u\u017cytkownika.","title":"\ud83c\udfac Use Cases"},{"location":"layers/application/#announcement-use-cases","text":"","title":"Announcement Use Cases"},{"location":"layers/application/#createannouncementusecase","text":"Lokalizacja : src/Application/UseCase/Announcement/CreateAnnouncementUseCase.php Odpowiedzialno\u015b\u0107 : Obs\u0142uga tworzenia nowego og\u0142oszenia Zale\u017cno\u015bci : public function __construct( private AnnouncementRepository $announcementRepository, private LoggerInterface $logger ) Metoda Execute : public function execute(CreateAnnouncementRequest $request): AnnouncementDTO Parametry : CreateAnnouncementRequest - string $title - Tytu\u0142 og\u0142oszenia - string $text - Tre\u015b\u0107 og\u0142oszenia - string $validUntil - Data wyga\u015bni\u0119cia (ISO 8601) - int $userId - ID tw\u00f3rcy (opcjonalnie) Zwraca : AnnouncementDTO - Nowe og\u0142oszenie Flow : 1. Waliduje request (tytu\u0142, tekst nie puste, validUntil w przysz\u0142o\u015bci) 2. Tworzy Domain Entity (Announcement) 3. Zapisuje w Repository 4. Zwraca DTO dla front-endu Wyj\u0105tki : - AnnouncementException - B\u0142\u0105d biznesowy - ValidationException - B\u0142\u0105d walidacji U\u017cycie w Controller : class AnnouncementController { public function __construct( private CreateAnnouncementUseCase $useCase ) {} public function create(Request $request): Response { try { $dto = new CreateAnnouncementRequest( title: $request->input('title'), text: $request->input('text'), validUntil: $request->input('valid_until'), userId: $request->userId // from auth ); $result = $this->useCase->execute($dto); return Response::created($result); } catch (ValidationException $e) { return Response::badRequest($e->getMessage()); } } }","title":"CreateAnnouncementUseCase"},{"location":"layers/application/#approveannouncementusecase","text":"Lokalizacja : src/Application/UseCase/Announcement/ApproveAnnouncementUseCase.php Odpowiedzialno\u015b\u0107 : Zatwierdzenie og\u0142oszenia oczekuj\u0105cego Metoda Execute : public function execute(int $announcementId, int $adminId): AnnouncementDTO Parametry : - int $announcementId - ID og\u0142oszenia do zatwierdzenia - int $adminId - ID admina zatwierdzaj\u0105cego Zwraca : AnnouncementDTO - Zatwierdzone og\u0142oszenie Flow : 1. Pobiera Announcement z Repository 2. Sprawdza czy istnieje i ma status PENDING 3. Wywo\u0142a $announcement->approve($adminId) (logika domenowa) 4. Zapisuje w Repository 5. Zwraca DTO Wyj\u0105tki : - AnnouncementNotFoundException - AnnouncementException - Je\u015bli status nie PENDING","title":"ApproveAnnouncementUseCase"},{"location":"layers/application/#rejectannouncementusecase","text":"Lokalizacja : src/Application/UseCase/Announcement/RejectAnnouncementUseCase.php Odpowiedzialno\u015b\u0107 : Odrzucenie og\u0142oszenia oczekuj\u0105cego Metoda Execute : public function execute(int $announcementId, int $adminId, string $reason): AnnouncementDTO Parametry : - int $announcementId - ID og\u0142oszenia do odrzucenia - int $adminId - ID admina odrzucaj\u0105cego - string $reason - Pow\u00f3d odrzucenia (dla archiwum) Zwraca : AnnouncementDTO - Odrzucone og\u0142oszenie","title":"RejectAnnouncementUseCase"},{"location":"layers/application/#listannouncementsusecase","text":"Lokalizacja : src/Application/UseCase/Announcement/ListAnnouncementsUseCase.php Odpowiedzialno\u015b\u0107 : Pobranie listy aktualnych og\u0142osze\u0144 Metoda Execute : public function execute(ListAnnouncementsRequest $request): array Parametry : ListAnnouncementsRequest - int $page = 1 - Numer strony - int $perPage = 10 - Ilo\u015b\u0107 na stron\u0119 - string $status = 'approved' - Filtr po statusie - bool $validOnly = true - Czy tylko wa\u017cne Zwraca : array<AnnouncementDTO> - Lista og\u0142osze\u0144 Flow : 1. Buduje query z filtrami 2. Stosuje paginacj\u0119 3. Pobiera z Repository 4. Transformuje do DTOs 5. Zwraca wraz z metadanymi","title":"ListAnnouncementsUseCase"},{"location":"layers/application/#user-use-cases","text":"","title":"User Use Cases"},{"location":"layers/application/#registeruserusecase","text":"Lokalizacja : src/Application/UseCase/User/RegisterUserUseCase.php Odpowiedzialno\u015b\u0107 : Rejestracja nowego u\u017cytkownika Metoda Execute : public function execute(RegisterUserRequest $request): UserDTO Parametry : RegisterUserRequest - string $email - Email u\u017cytkownika - string $password - Has\u0142o (raw) - string $name - Nazwa u\u017cytkownika - ?string $phoneNumber - Numer telefonu Zwraca : UserDTO - Nowy u\u017cytkownik (bez has\u0142a!) Walidacja : - Email nie mo\u017ce istnie\u0107 - Has\u0142o musi spe\u0142nia\u0107 wymagania - Email musi by\u0107 wa\u017cny Bezpiecze\u0144stwo : - Has\u0142o zahaszowane na level Infra (SecurityService) - Brak has\u0142a w response","title":"RegisterUserUseCase"},{"location":"layers/application/#loginuserusecase","text":"Lokalizacja : src/Application/UseCase/User/LoginUserUseCase.php Odpowiedzialno\u015b\u0107 : Logowanie u\u017cytkownika Metoda Execute : public function execute(LoginUserRequest $request): LoginResponse Parametry : LoginUserRequest - string $email - Email - string $password - Has\u0142o (raw) Zwraca : LoginResponse - UserDTO $user - string $token - JWT lub session token","title":"LoginUserUseCase"},{"location":"layers/application/#word-use-cases","text":"","title":"Word Use Cases"},{"location":"layers/application/#createwordusecase","text":"Lokalizacja : src/Application/UseCase/Word/CreateWordUseCase.php Tworzy nowe s\u0142owo dnia.","title":"CreateWordUseCase"},{"location":"layers/application/#listwordsusecase","text":"Pobiera s\u0142owa z paginacj\u0105.","title":"ListWordsUseCase"},{"location":"layers/application/#data-transfer-objects-dtos","text":"DTOs transportuj\u0105 dane mi\u0119dzy warstwami bez logiki biznesowej.","title":"\ud83d\udce6 Data Transfer Objects (DTOs)"},{"location":"layers/application/#announcementdto","text":"Lokalizacja : src/Application/DataTransferObject/AnnouncementDTO.php final class AnnouncementDTO { public function __construct( public int $id, public string $title, public string $text, public string $createdAt, // ISO 8601 public string $validUntil, // ISO 8601 public ?int $userId, public string $status, // 'pending', 'approved', 'rejected' public ?string $decidedAt, // ISO 8601 public ?int $decidedBy, ) {} public static function fromEntity(Announcement $entity): self { return new self( id: $entity->id, title: $entity->title, text: $entity->text, createdAt: $entity->createdAt->format('c'), validUntil: $entity->validUntil->format('c'), userId: $entity->userId, status: $entity->status->name, decidedAt: $entity->decidedAt?->format('c'), decidedBy: $entity->decidedBy, ); } } U\u017cycie : Transformacja Entity \u2192 JSON Response return [ 'data' => AnnouncementDTO::fromEntity($announcement) ];","title":"AnnouncementDTO"},{"location":"layers/application/#userdto","text":"Lokalizacja : src/Application/DataTransferObject/UserDTO.php final class UserDTO { public function __construct( public int $id, public string $email, public string $name, public ?string $phoneNumber, public string $role, // UWAGA: Nigdy nie include password! ) {} public static function fromEntity(User $entity): self { return new self( id: $entity->id, email: $entity->email, name: $entity->name, phoneNumber: $entity->phoneNumber, role: $entity->role, ); } }","title":"UserDTO"},{"location":"layers/application/#request-objects-request-dtos","text":"Request objects enkapsuluj\u0105 dane wej\u015bciowe.","title":"\ud83c\udfd7\ufe0f Request Objects (Request DTOs)"},{"location":"layers/application/#createannouncementrequest","text":"final class CreateAnnouncementRequest { public function __construct( public string $title, public string $text, public string $validUntil, // ISO 8601 public ?int $userId = null, ) {} public function validate(): array { $errors = []; if (empty($this->title)) { $errors[] = \"Title is required\"; } if (strlen($this->title) > 200) { $errors[] = \"Title is too long\"; } if (empty($this->text)) { $errors[] = \"Text is required\"; } if (strlen($this->text) > 5000) { $errors[] = \"Text is too long\"; } try { $date = new DateTimeImmutable($this->validUntil); if ($date <= new DateTimeImmutable()) { $errors[] = \"Valid until must be in the future\"; } } catch (Exception $e) { $errors[] = \"Invalid date format\"; } return $errors; } public function isValid(): bool { return empty($this->validate()); } } U\u017cycie w Use Case : public function execute(CreateAnnouncementRequest $request): AnnouncementDTO { $errors = $request->validate(); if (!empty($errors)) { throw new ValidationException($errors); } // ... proceed }","title":"CreateAnnouncementRequest"},{"location":"layers/application/#typowy-flow-use-case","text":"HTTP Request \u2193 Controller \u251c\u2500 1. Parse request \u2192 CreateAnnouncementRequest \u251c\u2500 2. Get UseCase from DI Container \u251c\u2500 3. Call useCase->execute($request) \u2193 UseCase \u251c\u2500 1. Validate request ($request->validate()) \u251c\u2500 2. Create Domain Entity (Announcement::createNew()) \u251c\u2500 3. Save via Repository \u251c\u2500 4. Transform to DTO \u251c\u2500 5. Return DTO \u2193 Controller \u251c\u2500 1. Format DTO to JSON \u251c\u2500 2. Return HTTP Response \u2193 HTTP Response (JSON) graph TB A[\"HTTP Request<br/>(POST /announcements)\"] -->|Parse| B[\"Controller\"] B -->|Extract Data| C[\"Request Object\"] C -->|Pass to| D[\"UseCase\"] D -->|Validate| C D -->|Check Entity| E[\"Domain Entity\"] E -->|Apply Rules| F[\"Valid Entity\"] D -->|Save| G[\"Repository\"] G -->|SQL INSERT| H[\"Database\"] H -->|Return| G G -->|Return to UseCase| D D -->|Transform| I[\"DTO\"] I -->|Return to Controller| B B -->|Format| J[\"JSON Response\"] J -->|Send| K[\"HTTP Response\"]","title":"\ud83d\udd04 Typowy Flow Use Case"},{"location":"layers/application/#exception-handling","text":"Use Cases powinny zg\u0142asza\u0107 wyj\u0105tki domenowe, kt\u00f3re s\u0105 obs\u0142ugiwane na level Controllera. // UseCase try { $announcement = $this->repository->findById($id); if (!$announcement) { throw new AnnouncementNotFoundException(); } } catch (DatabaseException $e) { throw new AnnouncementException(\"Failed to fetch announcement\"); } // Controller try { $dto = $this->useCase->execute($request); return Response::ok($dto); } catch (AnnouncementNotFoundException $e) { return Response::notFound(\"Announcement not found\"); } catch (AnnouncementException $e) { return Response::badRequest($e->getMessage()); } catch (ValidationException $e) { return Response::unprocessableEntity($e->getErrors()); } catch (Exception $e) { $this->logger->error($e); return Response::internalServerError(); }","title":"\ud83d\udee1\ufe0f Exception Handling"},{"location":"layers/application/#request-usecase-response-pattern","text":"Etap Komponenta Format 1 HTTP Body JSON 2 Controller Array 3 Request Object Typed Object 4 UseCase DTO 5 Response JSON","title":"\ud83d\udcca Request \u2192 UseCase \u2192 Response Pattern"},{"location":"layers/application/#best-practices","text":"","title":"\ud83c\udf93 Best Practices"},{"location":"layers/application/#do","text":"Waliduj ka\u017cdy Request php $errors = $request->validate(); if (!empty($errors)) { throw new ValidationException($errors); } U\u017cyj jednego Use Case na scenariusz ```php // \u2705 GOOD class CreateAnnouncementUseCase { } class ApproveAnnouncementUseCase { } // \u274c BAD class AnnouncementUseCase { // trop wiele odpowiedzialno\u015bci } ``` Transformuj Entity do DTOs php $dto = AnnouncementDTO::fromEntity($entity); return $dto; Deleguj logik\u0119 biznesow\u0105 do Domain php $announcement->approve($adminId); // Domain handles rules Obs\u0142uguj wyj\u0105tki domenowe php } catch (AnnouncementException $e) { return Response::badRequest($e->getMessage()); }","title":"\u2705 DO"},{"location":"layers/application/#dont","text":"Nie r\u00f3b SQL w Use Case php // \u274c WRONG $result = $this->pdo->query(\"SELECT...\"); Nie mieszaj logiki z r\u00f3\u017cnych scenariuszy php // \u274c WRONG class AnnouncementUseCase { public function create() { } public function approve() { } public function list() { } } Nie zwracaj Entity bezpo\u015brednio ```php // \u274c WRONG return $entity; // Expose domain model // \u2705 RIGHT return AnnouncementDTO::fromEntity($entity); ``` Nie pomi\u0144 walidacji ```php // \u274c WRONG public function execute($request) { // Assume input is valid } // \u2705 RIGHT public function execute($request) { $errors = $request->validate(); if (!empty($errors)) throw new ValidationException(); } ```","title":"\u274c DON'T"},{"location":"layers/application/#use-case-checklist","text":"Przy tworzeniu nowego Use Case pami\u0119taj aby: [ ] Unikalny scenariusz (jedna odpowiedzialno\u015b\u0107) [ ] Request object z walidacj\u0105 [ ] Walidacja w execute() [ ] Domain Entity creation/manipulation [ ] Repository call (save, find, etc) [ ] Exception handling [ ] DTO transformation [ ] Clear return type [ ] Unit tests [ ] Documentation","title":"\ud83d\udcda Use Case Checklist"},{"location":"layers/domain/","text":"Domain Layer - API Reference Warstwa Domain zawiera czyst\u0105 logik\u0119 biznesow\u0105 projektu DoDomuDojad\u0119, niezale\u017cn\u0105 od technicznych szczeg\u00f3\u0142\u00f3w implementacji. \ud83d\udccd Struktura Domain Layer src/Domain/ \u251c\u2500\u2500 Entity/ # G\u0142\u00f3wne agregaty i entity \u2502 \u251c\u2500\u2500 Announcement.php # Og\u0142oszenia \u2502 \u251c\u2500\u2500 User.php # U\u017cytkownicy \u2502 \u251c\u2500\u2500 Word.php # S\u0142owa dnia \u2502 \u251c\u2500\u2500 Quote.php # Cytaty \u2502 \u251c\u2500\u2500 Module.php # Modu\u0142y \u2502 \u2514\u2500\u2500 Countdown.php # Odliczanie \u251c\u2500\u2500 Enum/ # Enumeracje \u2502 \u251c\u2500\u2500 AnnouncementStatus.php \u2502 \u251c\u2500\u2500 UserRole.php \u2502 \u2514\u2500\u2500 ... \u251c\u2500\u2500 ValueObject/ # Niezmienne obiekty warto\u015bci \u2502 \u2514\u2500\u2500 (b\u0119d\u0105 rozwijane w przysz\u0142o\u015bci) \u2514\u2500\u2500 Exception/ # Wyj\u0105tki domenowe \u251c\u2500\u2500 DomainException.php \u251c\u2500\u2500 AnnouncementException.php \u2514\u2500\u2500 ... Namespace : App\\Domain\\ \ud83c\udfaf Entities (Agregaty) Announcement Entity Lokalizacja : src/Domain/Entity/Announcement.php G\u0142\u00f3wny agregat zarz\u0105dzaj\u0105cy og\u0142oszeniami w aplikacji. Charakterystyka ID : Unikalne w systemie Status : PENDING, APPROVED, REJECTED Workflow : Proposal \u2192 Review \u2192 Approval/Rejection Lifecycle : Od stworzenia do wyga\u015bni\u0119cia Konstruktor public function __construct( public ?int $id, public string $title, public string $text, public DateTimeImmutable $createdAt, public DateTimeImmutable $validUntil, public ?int $userId, public AnnouncementStatus $status = AnnouncementStatus::PENDING, public ?DateTimeImmutable $decidedAt = null, public ?int $decidedBy = null, ) W\u0142a\u015bciwo\u015bci W\u0142a\u015bciwo\u015b\u0107 Typ Opis $id ?int Unikalny identyfikator (null dla nowych) $title string Tytu\u0142 og\u0142oszenia $text string Tre\u015b\u0107 og\u0142oszenia $createdAt DateTimeImmutable Data utworzenia $validUntil DateTimeImmutable Data wyga\u015bni\u0119cia $userId ?int ID tw\u00f3rcy/zatwierdzaj\u0105cego $status AnnouncementStatus Status (PENDING/APPROVED/REJECTED) $decidedAt ?DateTimeImmutable Data zatwierdzenia/odrzucenia $decidedBy ?int ID osoby zatwierdzaj\u0105cej Factory Methods createNew() - Stw\u00f3rz nowe og\u0142oszenie od razu zatwierdzone public static function createNew( string $title, string $text, DateTimeImmutable $validUntil, int $userId, ): self Parametry: - $title : Tytu\u0142 og\u0142oszenia - $text : Tre\u015b\u0107 og\u0142oszenia - $validUntil : Data wyga\u015bni\u0119cia - $userId : ID u\u017cytkownika tworz\u0105cego Zwraca: Nowy agregat z statusem APPROVED U\u017cycie: $announcement = Announcement::createNew( title: \"Nowe godziny otwarcia\", text: \"Od poniedzia\u0142ku zmieniamy godziny...\", validUntil: new DateTimeImmutable('2026-02-01'), userId: 1 ); proposeNew() - Stw\u00f3rz nowe og\u0142oszenie czekaj\u0105ce na zatwierdzenie public static function proposeNew( string $title, string $text, DateTimeImmutable $validUntil ): self Parametry: - $title : Tytu\u0142 og\u0142oszenia - $text : Tre\u015b\u0107 og\u0142oszenia - $validUntil : Data wyga\u015bni\u0119cia Zwraca: Nowy agregat z statusem PENDING U\u017cycie: $announcement = Announcement::proposeNew( title: \"Propozycja nowego og\u0142oszenia\", text: \"To jest propozycja kt\u00f3r\u0105 admin b\u0119dzie recenzowa\u0107\", validUntil: new DateTimeImmutable('+1 month') ); Business Methods approve() - Zatwierd\u017a og\u0142oszenie public function approve(int $decidedBy): void Parametry: - $decidedBy : ID u\u017cytkownika zatwierdzaj\u0105cego (admina) Efekty: - Zmienia status na APPROVED - Ustawia $decidedAt na bie\u017c\u0105cy czas - Ustawia $decidedBy na ID zatwierdzaj\u0105cego Invariants: - Status musi by\u0107 PENDING - $decidedBy musi by\u0107 wa\u017cnym ID u\u017cytkownika U\u017cycie: if ($announcement->status === AnnouncementStatus::PENDING) { $announcement->approve(adminId: 2); } reject() - Odrzu\u0107 og\u0142oszenie public function reject(int $decidedBy): void Parametry: - $decidedBy : ID u\u017cytkownika odrzucaj\u0105cego (admina) Efekty: - Zmienia status na REJECTED - Ustawia $decidedAt na bie\u017c\u0105cy czas - Ustawia $decidedBy na ID odrzucaj\u0105cego Invariants: - Status musi by\u0107 PENDING - $decidedBy musi by\u0107 wa\u017cnym ID u\u017cytkownika U\u017cycie: if ($announcement->status === AnnouncementStatus::PENDING) { $announcement->reject(adminId: 2); } isValid() - Sprawd\u017a czy og\u0142oszenie jest wa\u017cne (aktualnie widoczne) public function isValid(): bool Zwraca: true je\u015bli: - Status = APPROVED - Bie\u017c\u0105cy czas <= validUntil U\u017cycie: if ($announcement->isValid()) { // Wy\u015bwietl og\u0142oszenie u\u017cytkownikowi displayAnnouncement($announcement); } User Entity Lokalizacja : src/Domain/Entity/User.php Entity reprezentuj\u0105ca u\u017cytkownika systemu. final class User { public function __construct( public ?int $id, public string $email, public string $passwordHash, public string $name, public ?string $phoneNumber = null, public string $role = 'user' ) } W\u0142a\u015bciwo\u015bci W\u0142a\u015bciwo\u015b\u0107 Typ Opis $id ?int Unikalny identyfikator $email string Email u\u017cytkownika $passwordHash string Zahaszowane has\u0142o $name string Nazwa u\u017cytkownika $phoneNumber ?string Numer telefonu (opcjonalnie) $role string Rola (user, admin, moderator) Word Entity Lokalizacja : src/Domain/Entity/Word.php Entity reprezentuj\u0105ca s\u0142owo dnia. final class Word { public function __construct( public ?int $id, public string $word, public string $definition, public string $example, public string $language = 'pl' ) } W\u0142a\u015bciwo\u015bci W\u0142a\u015bciwo\u015b\u0107 Typ Opis $id ?int Unikalny identyfikator $word string S\u0142owo $definition string Definicja $example string Przyk\u0142ad u\u017cycia $language string J\u0119zyk (domy\u015blnie polski) Quote Entity Lokalizacja : src/Domain/Entity/Quote.php Entity reprezentuj\u0105ca cytat inspiruj\u0105cy. final class Quote { public function __construct( public ?int $id, public string $text, public string $author, public string $category = 'general' ) } W\u0142a\u015bciwo\u015bci W\u0142a\u015bciwo\u015b\u0107 Typ Opis $id ?int Unikalny identyfikator $text string Tekst cytatu $author string Autor cytatu $category string Kategoria cytatu Module Entity Lokalizacja : src/Domain/Entity/Module.php Entity reprezentuj\u0105ca modu\u0142 funkcjonalny aplikacji. final class Module { public function __construct( public ?int $id, public string $name, public string $description, public bool $enabled = true ) } W\u0142a\u015bciwo\u015bci W\u0142a\u015bciwo\u015b\u0107 Typ Opis $id ?int Unikalny identyfikator $name string Nazwa modu\u0142u $description string Opis modu\u0142u $enabled bool Czy modu\u0142 jest w\u0142\u0105czony Countdown Entity Lokalizacja : src/Domain/Entity/Countdown.php Entity reprezentuj\u0105ca odliczanie do wa\u017cnego zdarzenia. final class Countdown { public function __construct( public ?int $id, public string $title, public DateTimeImmutable $targetDate, public string $description = '' ) } W\u0142a\u015bciwo\u015bci W\u0142a\u015bciwo\u015b\u0107 Typ Opis $id ?int Unikalny identyfikator $title string Tytu\u0142 odliczania $targetDate DateTimeImmutable Data docelowa $description string Opis zdarzenia \ud83c\udff7\ufe0f Enums (Enumeracje) AnnouncementStatus Enum Lokalizacja : src/Domain/Enum/AnnouncementStatus.php Status og\u0142oszenia w workflow. enum AnnouncementStatus { case PENDING; // Oczekuje na zatwierdzenie case APPROVED; // Zatwierdzone i widoczne case REJECTED; // Odrzucone } Stany Transitional \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 PENDING \u2502 \u251c\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2524 \u2502 \u2502 \u2502 \u25bc \u25bc \u2502 APPROVED REJECTED Przej\u015bcia : - PENDING \u2192 APPROVED (approve) - PENDING \u2192 REJECTED (reject) - APPROVED \u219b (terminal state) - REJECTED \u219b (terminal state) U\u017cycie // Sprawdzenie statusu if ($announcement->status === AnnouncementStatus::PENDING) { // Czeka na zatwierdzenie } // Walidacja przej\u015bcia if ($announcement->status === AnnouncementStatus::PENDING) { $announcement->approve($userId); } \u26a0\ufe0f Exceptions (Wyj\u0105tki Domenowe) Lokalizacja : src/Domain/Exception/ DomainException (Abstract Base) abstract class DomainException extends Exception Bazowa klasa dla wszystkich wyj\u0105tk\u00f3w domenowych. Charakterystyka : - Reprezentuje b\u0142\u0119dy biznesowe, nie techniczne - Powinna by\u0107 obs\u0142ugiwana na poziomie Application - Zawiera informacje dla u\u017cytkownika AnnouncementException class AnnouncementException extends DomainException Wyj\u0105tek dla b\u0142\u0119d\u00f3w zwi\u0105zanych z Announcement. Przyk\u0142ady : throw new AnnouncementException( \"Nie mo\u017cna zatwierdzi\u0107 og\u0142oszenia kt\u00f3re nie jest w stanie PENDING\" ); \ud83d\udccb Value Objects (Przysz\u0142o\u015b\u0107) Value Objects b\u0119d\u0105 wprowadzane w przysz\u0142o\u015bci dla: Email Value Object final class Email { private function __construct( public readonly string $value ) { if (!filter_var($value, FILTER_VALIDATE_EMAIL)) { throw new InvalidEmailException(); } } public static function create(string $value): self { return new self($value); } public function equals(Email $other): bool { return $this->value === $other->value; } } PhoneNumber Value Object final class PhoneNumber { private function __construct( public readonly string $value ) { // Walidacja formatu telefonu } } DateRange Value Object final class DateRange { public function __construct( public readonly DateTimeImmutable $startDate, public readonly DateTimeImmutable $endDate ) { if ($startDate > $endDate) { throw new InvalidDateRangeException(); } } public function contains(DateTimeImmutable $date): bool { return $date >= $this->startDate && $date <= $this->endDate; } } \ud83c\udf93 Best Practices w Domain Layer \u2705 DO Umieszczaj logik\u0119 biznesow\u0105 w Entity php public function isValid(): bool { return $this->status === AnnouncementStatus::APPROVED && new DateTimeImmutable() <= $this->validUntil; } U\u017cywaj Value Objects do walidacji php public function __construct( public Email $email, public PhoneNumber $phone ) Definiuj invariants explicite php // Og \u0142oszenie mo\u017ce by\u0107 zatwierdzone tylko je\u015bli by\u0142o w stanie PENDING public function approve(int $decidedBy): void { // implicit invariant check $this->status = AnnouncementStatus::APPROVED; } Zwracaj Entity ze statycznych metod php public static function createNew(...): self { return new self(...); } \u274c DON'T Nie importuj Infrastructure w Domain php // \u274c WRONG use App\\Infrastructure\\Repository\\AnnouncementRepository; Nie r\u00f3b SQL queries w Entity php // \u274c WRONG $result = $this->pdo->query(\"SELECT...\"); Nie parsuj JSON/XML w Entity php // \u274c WRONG $data = json_decode($request->getBody()); Nie u\u017cywaj getters/setters dla wszystkiego ```php // \u274c WRONG public function getStatus() { return $this->status; } public function setStatus($status) { $this->status = $status; } // \u2705 RIGHT public function approve($userId) { // apply business rules $this->status = AnnouncementStatus::APPROVED; } ``` \ud83d\udd17 Relacje Mi\u0119dzy Entities graph TB A[\"Announcement\"] -->|userId| B[\"User\"] B -->|has many| A C[\"Module\"] -->|has many| D[\"Items\"] E[\"Word\"] -->|created by| B F[\"Quote\"] -->|created by| B G[\"Countdown\"] -->|tracked by| B \ud83d\udcca Complete Domain Namespace Reference Klasa Lokalizacja Typ Opis Announcement Entity/ Entity Og\u0142oszenie User Entity/ Entity U\u017cytkownik Word Entity/ Entity S\u0142owo dnia Quote Entity/ Entity Cytat Module Entity/ Entity Modu\u0142 Countdown Entity/ Entity Odliczanie AnnouncementStatus Enum/ Enum Status og\u0142oszenia DomainException Exception/ Abstract Bazowy wyj\u0105tek AnnouncementException Exception/ Exception Wyj\u0105tek dla Announcement","title":"Domain"},{"location":"layers/domain/#domain-layer-api-reference","text":"Warstwa Domain zawiera czyst\u0105 logik\u0119 biznesow\u0105 projektu DoDomuDojad\u0119, niezale\u017cn\u0105 od technicznych szczeg\u00f3\u0142\u00f3w implementacji.","title":"Domain Layer - API Reference"},{"location":"layers/domain/#struktura-domain-layer","text":"src/Domain/ \u251c\u2500\u2500 Entity/ # G\u0142\u00f3wne agregaty i entity \u2502 \u251c\u2500\u2500 Announcement.php # Og\u0142oszenia \u2502 \u251c\u2500\u2500 User.php # U\u017cytkownicy \u2502 \u251c\u2500\u2500 Word.php # S\u0142owa dnia \u2502 \u251c\u2500\u2500 Quote.php # Cytaty \u2502 \u251c\u2500\u2500 Module.php # Modu\u0142y \u2502 \u2514\u2500\u2500 Countdown.php # Odliczanie \u251c\u2500\u2500 Enum/ # Enumeracje \u2502 \u251c\u2500\u2500 AnnouncementStatus.php \u2502 \u251c\u2500\u2500 UserRole.php \u2502 \u2514\u2500\u2500 ... \u251c\u2500\u2500 ValueObject/ # Niezmienne obiekty warto\u015bci \u2502 \u2514\u2500\u2500 (b\u0119d\u0105 rozwijane w przysz\u0142o\u015bci) \u2514\u2500\u2500 Exception/ # Wyj\u0105tki domenowe \u251c\u2500\u2500 DomainException.php \u251c\u2500\u2500 AnnouncementException.php \u2514\u2500\u2500 ... Namespace : App\\Domain\\","title":"\ud83d\udccd Struktura Domain Layer"},{"location":"layers/domain/#entities-agregaty","text":"","title":"\ud83c\udfaf Entities (Agregaty)"},{"location":"layers/domain/#announcement-entity","text":"Lokalizacja : src/Domain/Entity/Announcement.php G\u0142\u00f3wny agregat zarz\u0105dzaj\u0105cy og\u0142oszeniami w aplikacji.","title":"Announcement Entity"},{"location":"layers/domain/#charakterystyka","text":"ID : Unikalne w systemie Status : PENDING, APPROVED, REJECTED Workflow : Proposal \u2192 Review \u2192 Approval/Rejection Lifecycle : Od stworzenia do wyga\u015bni\u0119cia","title":"Charakterystyka"},{"location":"layers/domain/#konstruktor","text":"public function __construct( public ?int $id, public string $title, public string $text, public DateTimeImmutable $createdAt, public DateTimeImmutable $validUntil, public ?int $userId, public AnnouncementStatus $status = AnnouncementStatus::PENDING, public ?DateTimeImmutable $decidedAt = null, public ?int $decidedBy = null, )","title":"Konstruktor"},{"location":"layers/domain/#wasciwosci","text":"W\u0142a\u015bciwo\u015b\u0107 Typ Opis $id ?int Unikalny identyfikator (null dla nowych) $title string Tytu\u0142 og\u0142oszenia $text string Tre\u015b\u0107 og\u0142oszenia $createdAt DateTimeImmutable Data utworzenia $validUntil DateTimeImmutable Data wyga\u015bni\u0119cia $userId ?int ID tw\u00f3rcy/zatwierdzaj\u0105cego $status AnnouncementStatus Status (PENDING/APPROVED/REJECTED) $decidedAt ?DateTimeImmutable Data zatwierdzenia/odrzucenia $decidedBy ?int ID osoby zatwierdzaj\u0105cej","title":"W\u0142a\u015bciwo\u015bci"},{"location":"layers/domain/#factory-methods","text":"createNew() - Stw\u00f3rz nowe og\u0142oszenie od razu zatwierdzone public static function createNew( string $title, string $text, DateTimeImmutable $validUntil, int $userId, ): self Parametry: - $title : Tytu\u0142 og\u0142oszenia - $text : Tre\u015b\u0107 og\u0142oszenia - $validUntil : Data wyga\u015bni\u0119cia - $userId : ID u\u017cytkownika tworz\u0105cego Zwraca: Nowy agregat z statusem APPROVED U\u017cycie: $announcement = Announcement::createNew( title: \"Nowe godziny otwarcia\", text: \"Od poniedzia\u0142ku zmieniamy godziny...\", validUntil: new DateTimeImmutable('2026-02-01'), userId: 1 ); proposeNew() - Stw\u00f3rz nowe og\u0142oszenie czekaj\u0105ce na zatwierdzenie public static function proposeNew( string $title, string $text, DateTimeImmutable $validUntil ): self Parametry: - $title : Tytu\u0142 og\u0142oszenia - $text : Tre\u015b\u0107 og\u0142oszenia - $validUntil : Data wyga\u015bni\u0119cia Zwraca: Nowy agregat z statusem PENDING U\u017cycie: $announcement = Announcement::proposeNew( title: \"Propozycja nowego og\u0142oszenia\", text: \"To jest propozycja kt\u00f3r\u0105 admin b\u0119dzie recenzowa\u0107\", validUntil: new DateTimeImmutable('+1 month') );","title":"Factory Methods"},{"location":"layers/domain/#business-methods","text":"approve() - Zatwierd\u017a og\u0142oszenie public function approve(int $decidedBy): void Parametry: - $decidedBy : ID u\u017cytkownika zatwierdzaj\u0105cego (admina) Efekty: - Zmienia status na APPROVED - Ustawia $decidedAt na bie\u017c\u0105cy czas - Ustawia $decidedBy na ID zatwierdzaj\u0105cego Invariants: - Status musi by\u0107 PENDING - $decidedBy musi by\u0107 wa\u017cnym ID u\u017cytkownika U\u017cycie: if ($announcement->status === AnnouncementStatus::PENDING) { $announcement->approve(adminId: 2); } reject() - Odrzu\u0107 og\u0142oszenie public function reject(int $decidedBy): void Parametry: - $decidedBy : ID u\u017cytkownika odrzucaj\u0105cego (admina) Efekty: - Zmienia status na REJECTED - Ustawia $decidedAt na bie\u017c\u0105cy czas - Ustawia $decidedBy na ID odrzucaj\u0105cego Invariants: - Status musi by\u0107 PENDING - $decidedBy musi by\u0107 wa\u017cnym ID u\u017cytkownika U\u017cycie: if ($announcement->status === AnnouncementStatus::PENDING) { $announcement->reject(adminId: 2); } isValid() - Sprawd\u017a czy og\u0142oszenie jest wa\u017cne (aktualnie widoczne) public function isValid(): bool Zwraca: true je\u015bli: - Status = APPROVED - Bie\u017c\u0105cy czas <= validUntil U\u017cycie: if ($announcement->isValid()) { // Wy\u015bwietl og\u0142oszenie u\u017cytkownikowi displayAnnouncement($announcement); }","title":"Business Methods"},{"location":"layers/domain/#user-entity","text":"Lokalizacja : src/Domain/Entity/User.php Entity reprezentuj\u0105ca u\u017cytkownika systemu. final class User { public function __construct( public ?int $id, public string $email, public string $passwordHash, public string $name, public ?string $phoneNumber = null, public string $role = 'user' ) }","title":"User Entity"},{"location":"layers/domain/#wasciwosci_1","text":"W\u0142a\u015bciwo\u015b\u0107 Typ Opis $id ?int Unikalny identyfikator $email string Email u\u017cytkownika $passwordHash string Zahaszowane has\u0142o $name string Nazwa u\u017cytkownika $phoneNumber ?string Numer telefonu (opcjonalnie) $role string Rola (user, admin, moderator)","title":"W\u0142a\u015bciwo\u015bci"},{"location":"layers/domain/#word-entity","text":"Lokalizacja : src/Domain/Entity/Word.php Entity reprezentuj\u0105ca s\u0142owo dnia. final class Word { public function __construct( public ?int $id, public string $word, public string $definition, public string $example, public string $language = 'pl' ) }","title":"Word Entity"},{"location":"layers/domain/#wasciwosci_2","text":"W\u0142a\u015bciwo\u015b\u0107 Typ Opis $id ?int Unikalny identyfikator $word string S\u0142owo $definition string Definicja $example string Przyk\u0142ad u\u017cycia $language string J\u0119zyk (domy\u015blnie polski)","title":"W\u0142a\u015bciwo\u015bci"},{"location":"layers/domain/#quote-entity","text":"Lokalizacja : src/Domain/Entity/Quote.php Entity reprezentuj\u0105ca cytat inspiruj\u0105cy. final class Quote { public function __construct( public ?int $id, public string $text, public string $author, public string $category = 'general' ) }","title":"Quote Entity"},{"location":"layers/domain/#wasciwosci_3","text":"W\u0142a\u015bciwo\u015b\u0107 Typ Opis $id ?int Unikalny identyfikator $text string Tekst cytatu $author string Autor cytatu $category string Kategoria cytatu","title":"W\u0142a\u015bciwo\u015bci"},{"location":"layers/domain/#module-entity","text":"Lokalizacja : src/Domain/Entity/Module.php Entity reprezentuj\u0105ca modu\u0142 funkcjonalny aplikacji. final class Module { public function __construct( public ?int $id, public string $name, public string $description, public bool $enabled = true ) }","title":"Module Entity"},{"location":"layers/domain/#wasciwosci_4","text":"W\u0142a\u015bciwo\u015b\u0107 Typ Opis $id ?int Unikalny identyfikator $name string Nazwa modu\u0142u $description string Opis modu\u0142u $enabled bool Czy modu\u0142 jest w\u0142\u0105czony","title":"W\u0142a\u015bciwo\u015bci"},{"location":"layers/domain/#countdown-entity","text":"Lokalizacja : src/Domain/Entity/Countdown.php Entity reprezentuj\u0105ca odliczanie do wa\u017cnego zdarzenia. final class Countdown { public function __construct( public ?int $id, public string $title, public DateTimeImmutable $targetDate, public string $description = '' ) }","title":"Countdown Entity"},{"location":"layers/domain/#wasciwosci_5","text":"W\u0142a\u015bciwo\u015b\u0107 Typ Opis $id ?int Unikalny identyfikator $title string Tytu\u0142 odliczania $targetDate DateTimeImmutable Data docelowa $description string Opis zdarzenia","title":"W\u0142a\u015bciwo\u015bci"},{"location":"layers/domain/#enums-enumeracje","text":"","title":"\ud83c\udff7\ufe0f Enums (Enumeracje)"},{"location":"layers/domain/#announcementstatus-enum","text":"Lokalizacja : src/Domain/Enum/AnnouncementStatus.php Status og\u0142oszenia w workflow. enum AnnouncementStatus { case PENDING; // Oczekuje na zatwierdzenie case APPROVED; // Zatwierdzone i widoczne case REJECTED; // Odrzucone }","title":"AnnouncementStatus Enum"},{"location":"layers/domain/#stany-transitional","text":"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 PENDING \u2502 \u251c\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2524 \u2502 \u2502 \u2502 \u25bc \u25bc \u2502 APPROVED REJECTED Przej\u015bcia : - PENDING \u2192 APPROVED (approve) - PENDING \u2192 REJECTED (reject) - APPROVED \u219b (terminal state) - REJECTED \u219b (terminal state)","title":"Stany Transitional"},{"location":"layers/domain/#uzycie","text":"// Sprawdzenie statusu if ($announcement->status === AnnouncementStatus::PENDING) { // Czeka na zatwierdzenie } // Walidacja przej\u015bcia if ($announcement->status === AnnouncementStatus::PENDING) { $announcement->approve($userId); }","title":"U\u017cycie"},{"location":"layers/domain/#exceptions-wyjatki-domenowe","text":"Lokalizacja : src/Domain/Exception/","title":"\u26a0\ufe0f Exceptions (Wyj\u0105tki Domenowe)"},{"location":"layers/domain/#domainexception-abstract-base","text":"abstract class DomainException extends Exception Bazowa klasa dla wszystkich wyj\u0105tk\u00f3w domenowych. Charakterystyka : - Reprezentuje b\u0142\u0119dy biznesowe, nie techniczne - Powinna by\u0107 obs\u0142ugiwana na poziomie Application - Zawiera informacje dla u\u017cytkownika","title":"DomainException (Abstract Base)"},{"location":"layers/domain/#announcementexception","text":"class AnnouncementException extends DomainException Wyj\u0105tek dla b\u0142\u0119d\u00f3w zwi\u0105zanych z Announcement. Przyk\u0142ady : throw new AnnouncementException( \"Nie mo\u017cna zatwierdzi\u0107 og\u0142oszenia kt\u00f3re nie jest w stanie PENDING\" );","title":"AnnouncementException"},{"location":"layers/domain/#value-objects-przyszosc","text":"Value Objects b\u0119d\u0105 wprowadzane w przysz\u0142o\u015bci dla:","title":"\ud83d\udccb Value Objects (Przysz\u0142o\u015b\u0107)"},{"location":"layers/domain/#email-value-object","text":"final class Email { private function __construct( public readonly string $value ) { if (!filter_var($value, FILTER_VALIDATE_EMAIL)) { throw new InvalidEmailException(); } } public static function create(string $value): self { return new self($value); } public function equals(Email $other): bool { return $this->value === $other->value; } }","title":"Email Value Object"},{"location":"layers/domain/#phonenumber-value-object","text":"final class PhoneNumber { private function __construct( public readonly string $value ) { // Walidacja formatu telefonu } }","title":"PhoneNumber Value Object"},{"location":"layers/domain/#daterange-value-object","text":"final class DateRange { public function __construct( public readonly DateTimeImmutable $startDate, public readonly DateTimeImmutable $endDate ) { if ($startDate > $endDate) { throw new InvalidDateRangeException(); } } public function contains(DateTimeImmutable $date): bool { return $date >= $this->startDate && $date <= $this->endDate; } }","title":"DateRange Value Object"},{"location":"layers/domain/#best-practices-w-domain-layer","text":"","title":"\ud83c\udf93 Best Practices w Domain Layer"},{"location":"layers/domain/#do","text":"Umieszczaj logik\u0119 biznesow\u0105 w Entity php public function isValid(): bool { return $this->status === AnnouncementStatus::APPROVED && new DateTimeImmutable() <= $this->validUntil; } U\u017cywaj Value Objects do walidacji php public function __construct( public Email $email, public PhoneNumber $phone ) Definiuj invariants explicite php // Og \u0142oszenie mo\u017ce by\u0107 zatwierdzone tylko je\u015bli by\u0142o w stanie PENDING public function approve(int $decidedBy): void { // implicit invariant check $this->status = AnnouncementStatus::APPROVED; } Zwracaj Entity ze statycznych metod php public static function createNew(...): self { return new self(...); }","title":"\u2705 DO"},{"location":"layers/domain/#dont","text":"Nie importuj Infrastructure w Domain php // \u274c WRONG use App\\Infrastructure\\Repository\\AnnouncementRepository; Nie r\u00f3b SQL queries w Entity php // \u274c WRONG $result = $this->pdo->query(\"SELECT...\"); Nie parsuj JSON/XML w Entity php // \u274c WRONG $data = json_decode($request->getBody()); Nie u\u017cywaj getters/setters dla wszystkiego ```php // \u274c WRONG public function getStatus() { return $this->status; } public function setStatus($status) { $this->status = $status; } // \u2705 RIGHT public function approve($userId) { // apply business rules $this->status = AnnouncementStatus::APPROVED; } ```","title":"\u274c DON'T"},{"location":"layers/domain/#relacje-miedzy-entities","text":"graph TB A[\"Announcement\"] -->|userId| B[\"User\"] B -->|has many| A C[\"Module\"] -->|has many| D[\"Items\"] E[\"Word\"] -->|created by| B F[\"Quote\"] -->|created by| B G[\"Countdown\"] -->|tracked by| B","title":"\ud83d\udd17 Relacje Mi\u0119dzy Entities"},{"location":"layers/domain/#complete-domain-namespace-reference","text":"Klasa Lokalizacja Typ Opis Announcement Entity/ Entity Og\u0142oszenie User Entity/ Entity U\u017cytkownik Word Entity/ Entity S\u0142owo dnia Quote Entity/ Entity Cytat Module Entity/ Entity Modu\u0142 Countdown Entity/ Entity Odliczanie AnnouncementStatus Enum/ Enum Status og\u0142oszenia DomainException Exception/ Abstract Bazowy wyj\u0105tek AnnouncementException Exception/ Exception Wyj\u0105tek dla Announcement","title":"\ud83d\udcca Complete Domain Namespace Reference"},{"location":"layers/infrastructure/","text":"Infrastructure Layer - API Reference Warstwa Infrastructure zawiera implementacj\u0119 technicznych szczeg\u00f3\u0142\u00f3w, integracje z zewn\u0119trznymi serwisami i zarz\u0105dzaniem danymi. \ud83d\udccd Struktura Infrastructure Layer src/Infrastructure/ \u251c\u2500\u2500 Container.php # Dependency Injection Container \u251c\u2500\u2500 Repository/ # Data Access Layer \u2502 \u251c\u2500\u2500 DatabaseAnnouncementRepository.php \u2502 \u251c\u2500\u2500 DatabaseUserRepository.php \u2502 \u251c\u2500\u2500 DatabaseWordRepository.php \u2502 \u251c\u2500\u2500 DatabaseQuoteRepository.php \u2502 \u2514\u2500\u2500 DatabaseCountdownRepository.php \u251c\u2500\u2500 Service/ # External Services \u2502 \u251c\u2500\u2500 ExternalWordApiService.php \u2502 \u251c\u2500\u2500 ExternalQuoteApiService.php \u2502 \u251c\u2500\u2500 EmailService.php \u2502 \u2514\u2500\u2500 LoggerService.php \u251c\u2500\u2500 Factory/ # Object Creation \u2502 \u251c\u2500\u2500 AnnouncementFactory.php \u2502 \u251c\u2500\u2500 UserFactory.php \u2502 \u2514\u2500\u2500 ... \u251c\u2500\u2500 Security/ # Security & Auth \u2502 \u251c\u2500\u2500 PasswordHasher.php \u2502 \u251c\u2500\u2500 TokenGenerator.php \u2502 \u2514\u2500\u2500 AuthenticationService.php \u251c\u2500\u2500 Helper/ # Utility Functions \u2502 \u251c\u2500\u2500 DateHelper.php \u2502 \u251c\u2500\u2500 StringHelper.php \u2502 \u2514\u2500\u2500 ValidationHelper.php \u251c\u2500\u2500 Translation/ # Internationalization \u2502 \u2514\u2500\u2500 TranslationService.php \u251c\u2500\u2500 Trait/ # Shared Traits \u2502 \u2514\u2500\u2500 TimestampableTrait.php \u2514\u2500\u2500 View/ # View Helpers \u2514\u2500\u2500 TemplateRenderer.php Namespace : App\\Infrastructure\\ \ud83d\udd0c Repositories Repositories implementuj\u0105 abstrakcj\u0119 dost\u0119pu do danych (patrz: Repository Pattern). DatabaseAnnouncementRepository Lokalizacja : src/Infrastructure/Repository/DatabaseAnnouncementRepository.php Odpowiedzialno\u015b\u0107 : Persystencja danych Announcement w bazie danych Implementuje : AnnouncementRepositoryInterface (Future) Zale\u017cno\u015bci : public function __construct( private PDO $pdo ) save(Announcement $announcement): void Zapisz (lub zaktualizuj) og\u0142oszenie w bazie. Parametry : - Announcement $announcement - Agregat do zapisania Efekty : - INSERT je\u015bli $announcement->id === null - UPDATE je\u015bli $announcement->id !== null SQL : -- INSERT INSERT INTO announcements ( title, text, created_at, valid_until, user_id, status, decided_at, decided_by ) VALUES (...) -- UPDATE UPDATE announcements SET title = ?, text = ?, status = ?, decided_at = ?, decided_by = ? WHERE id = ? Wyj\u0105tki : - DatabaseException - B\u0142\u0105d SQL - ConstraintViolationException - Naruszenie constraint'a U\u017cycie : $announcement = Announcement::createNew(...); $repository->save($announcement); findById(int $id): ?Announcement Pobierz og\u0142oszenie po ID. Parametry : - int $id - ID og\u0142oszenia Zwraca : - Announcement - Znalezione og\u0142oszenie - null - Je\u015bli nie znalezione SQL : SELECT * FROM announcements WHERE id = ? LIMIT 1 findAll(): array Pobierz wszystkie og\u0142oszenia. Zwraca : array<Announcement> findByStatus(string $status): array Pobierz og\u0142oszenia o okre\u015blonym statusie. Parametry : - string $status - Status (pending/approved/rejected) Zwraca : array<Announcement> findValid(): array Pobierz tylko wa\u017cne og\u0142oszenia (approved i jeszcze nieugas\u0142e). Zwraca : array<Announcement> - Aktualnie widoczne SQL : SELECT * FROM announcements WHERE status = 'approved' AND valid_until >= NOW() ORDER BY created_at DESC delete(int $id): void Usu\u0144 og\u0142oszenie. Parametry : - int $id - ID do usuni\u0119cia DatabaseUserRepository Lokalizacja : src/Infrastructure/Repository/DatabaseUserRepository.php Zarz\u0105dza persystencj\u0105 u\u017cytkownik\u00f3w. save(User $user): void Zapisz u\u017cytkownika. findById(int $id): ?User Pobierz po ID. findByEmail(string $email): ?User Pobierz po email. existsEmail(string $email): bool Sprawd\u017a czy email istnieje. DatabaseWordRepository Zarz\u0105dza s\u0142owami dnia. DatabaseQuoteRepository Zarz\u0105dza cytatami. \ud83d\udd17 External Services Serwisy integruj\u0105ce si\u0119 z zewn\u0119trznymi API. ExternalWordApiService Lokalizacja : src/Infrastructure/Service/ExternalWordApiService.php Odpowiedzialno\u015b\u0107 : Pobieranie s\u0142\u00f3w z zewn\u0119trznego API Zale\u017cno\u015bci : public function __construct( private HttpClient $httpClient, private ConfigService $config ) fetchDailyWord(): Word Pobierz s\u0142owo dnia z zewn\u0119trznego API. Zwraca : Word - Transformowane do Domain Entity Flow : 1. HTTP GET do external API 2. Parse response 3. Walidacja 4. Transformacja do Word Entity 5. Return Wyj\u0105tki : - ExternalServiceException - Problem z API - HttpException - B\u0142\u0105d HTTP - InvalidResponseException - B\u0142\u0119dna struktura danych HTTP : GET https://api.external.com/word/daily Accept: application/json Authorization: Bearer {token} Response : { \"word\": \"ephemeral\", \"definition\": \"Lasting for a very short time\", \"example\": \"The beauty of cherry blossoms is ephemeral\", \"language\": \"en\" } U\u017cycie : // W CLI Command lub UseCase $word = $this->wordService->fetchDailyWord(); $this->wordRepository->save($word); ExternalQuoteApiService Lokalizacja : src/Infrastructure/Service/ExternalQuoteApiService.php Pobieranie cytat\u00f3w z zewn\u0119trznego API. fetchDailyQuote(): Quote EmailService Lokalizacja : src/Infrastructure/Service/EmailService.php Odpowiedzialno\u015b\u0107 : Wysy\u0142anie emaili Zale\u017cno\u015bci : public function __construct( private SmtpClient $smtpClient, private ConfigService $config ) send(string $to, string $subject, string $body): void Wy\u015blij email. Parametry : - string $to - Adres email odbiorcy - string $subject - Temat - string $body - Tre\u015b\u0107 (HTML/Plain) Efekty : Email wys\u0142any via SMTP Wyj\u0105tki : - EmailException - B\u0142\u0105d wysy\u0142ki \ud83c\udfed Factories Fabryki tworz\u0105 kompleksowe obiekty z r\u00f3\u017cnych \u017ar\u00f3de\u0142. AnnouncementFactory Lokalizacja : src/Infrastructure/Factory/AnnouncementFactory.php createFromRequest(CreateAnnouncementRequest $request): Announcement Utw\u00f3rz Announcement Entity z Request. public static function createFromRequest( CreateAnnouncementRequest $request, ?int $userId = null ): Announcement { return Announcement::createNew( title: $request->title, text: $request->text, validUntil: new DateTimeImmutable($request->validUntil), userId: $userId ?? $request->userId, ); } createFromDatabaseRow(array $row): Announcement Utw\u00f3rz Announcement Entity z rekordu bazy. public static function createFromDatabaseRow(array $row): Announcement { return new Announcement( id: (int) $row['id'], title: $row['title'], text: $row['text'], createdAt: new DateTimeImmutable($row['created_at']), validUntil: new DateTimeImmutable($row['valid_until']), userId: $row['user_id'] ? (int) $row['user_id'] : null, status: AnnouncementStatus::from($row['status']), decidedAt: $row['decided_at'] ? new DateTimeImmutable($row['decided_at']) : null, decidedBy: $row['decided_by'] ? (int) $row['decided_by'] : null, ); } \ud83d\udd10 Security Components Komponenty bezpiecze\u0144stwa i autentykacji. PasswordHasher Lokalizacja : src/Infrastructure/Security/PasswordHasher.php hash(string $password): string Zahaszuj has\u0142o. public function hash(string $password): string { return password_hash($password, PASSWORD_BCRYPT, [ 'cost' => 12 ]); } verify(string $password, string $hash): bool Sprawd\u017a has\u0142o. public function verify(string $password, string $hash): bool { return password_verify($password, $hash); } TokenGenerator Lokalizacja : src/Infrastructure/Security/TokenGenerator.php generateJWT(User $user, int $expiresIn = 3600): string Wygeneruj JWT token dla u\u017cytkownika. public function generateJWT(User $user, int $expiresIn = 3600): string { $payload = [ 'user_id' => $user->id, 'email' => $user->email, 'role' => $user->role, 'iat' => time(), 'exp' => time() + $expiresIn ]; return JWT::encode($payload, $this->secret, 'HS256'); } generateRefreshToken(User $user): string Wygeneruj refresh token. AuthenticationService Lokalizacja : src/Infrastructure/Security/AuthenticationService.php authenticate(string $email, string $password): User Uwierzytelnij u\u017cytkownika. public function authenticate(string $email, string $password): User { $user = $this->userRepository->findByEmail($email); if (!$user || !$this->passwordHasher->verify($password, $user->passwordHash)) { throw new InvalidCredentialsException(); } return $user; } \ud83d\udee0\ufe0f Helpers Funkcje pomocnicze. DateHelper Lokalizacja : src/Infrastructure/Helper/DateHelper.php class DateHelper { public static function now(): DateTimeImmutable { return new DateTimeImmutable(); } public static function tomorrow(): DateTimeImmutable { return self::now()->modify('+1 day'); } public static function addDays(DateTimeImmutable $date, int $days): DateTimeImmutable { return $date->modify(\"+{$days} days\"); } public static function isExpired(DateTimeImmutable $date): bool { return $date < self::now(); } } StringHelper class StringHelper { public static function slugify(string $text): string { return strtolower(preg_replace('/[^a-z0-9]+/', '-', trim($text))); } public static function truncate(string $text, int $length = 100): string { if (strlen($text) <= $length) return $text; return substr($text, 0, $length) . '...'; } } ValidationHelper class ValidationHelper { public static function isValidEmail(string $email): bool { return filter_var($email, FILTER_VALIDATE_EMAIL) !== false; } public static function isValidUrl(string $url): bool { return filter_var($url, FILTER_VALIDATE_URL) !== false; } } \ud83c\udf10 Translation Service Obs\u0142uga wieloj\u0119zyczno\u015bci. TranslationService Lokalizacja : src/Infrastructure/Translation/TranslationService.php public function translate(string $key, string $locale = 'pl'): string { $messages = $this->loadMessages($locale); return $messages[$key] ?? $key; } public function t(string $key, array $params = [], string $locale = 'pl'): string { $message = $this->translate($key, $locale); foreach ($params as $key => $value) { $message = str_replace(\":$key\", $value, $message); } return $message; } U\u017cycie : $this->translator->t('announcement.created', ['title' => $announcement->title]); // \"Og\u0142oszenie 'Nowa promocja' zosta\u0142o utworzone\" \ud83d\ude9a Dependency Injection Container Container.php Lokalizacja : src/Infrastructure/Container.php Zarz\u0105dzanie zale\u017cno\u015bciami i lifecycle'em obiekt\u00f3w. class Container { private array $services = []; private array $singletons = []; public function register(string $id, mixed $definition): void { $this->services[$id] = $definition; } public function singleton(string $id, callable $definition): void { $this->singletons[$id] = $definition; } public function get(string $id): mixed { if (isset($this->singletons[$id])) { // Zwr\u00f3\u0107 ten sam instancj\u0119 return $this->singletons[$id]($this); } if (isset($this->services[$id])) { return $this->services[$id]($this); } throw new ServiceNotFoundException($id); } } Rejestracja Serwis\u00f3w // src/bootstrap/services.php $container->singleton(PDO::class, function(Container $c) { return new PDO( 'pgsql:host=localhost;dbname=dodomudojade', 'ddd', $_ENV['DB_PASSWORD'] ); }); $container->singleton(AnnouncementRepository::class, function(Container $c) { return new DatabaseAnnouncementRepository($c->get(PDO::class)); }); $container->singleton(CreateAnnouncementUseCase::class, function(Container $c) { return new CreateAnnouncementUseCase( $c->get(AnnouncementRepository::class), ); }); U\u017cycie w Controller class AnnouncementController { public function __construct( private Container $container ) {} public function create(Request $request): Response { $useCase = $this->container->get(CreateAnnouncementUseCase::class); $dto = $useCase->execute($request); return Response::created($dto); } } \ud83d\udcca Architektura Warstwowa Presentation (Http, Console) \u2193 (uses) \u2193 Application (UseCase, DTO) \u2193 (uses) \u2193 Domain (Entity, ValueObject, Enum) \u2191 \u2191 | | (implements) | | Infrastructure (Repository, Service) \ud83c\udf93 Best Practices \u2705 DO Implementuj Repository interfaces (Future) php interface AnnouncementRepository { public function save(Announcement $announcement): void; public function findById(int $id): ?Announcement; } U\u017cyj Factories dla kompleksowych obiekt\u00f3w php $entity = AnnouncementFactory::createFromDatabaseRow($row); Abstrakcjonuj external API calls php interface WordApiService { public function fetchDailyWord(): Word; } Zarz\u0105dzaj transakcjami php $this->pdo->beginTransaction(); try { $this->repository->save($entity); $this->pdo->commit(); } catch (Exception $e) { $this->pdo->rollBack(); throw $e; } Loguj wa\u017cne operacje php $this->logger->info(\"Announcement approved\", ['id' => $announcement->id]); \u274c DON'T Nie r\u00f3b logiki biznesowej w Repository php // \u274c WRONG public function save(Announcement $announcement): void { if ($announcement->title == '') throw new Exception(); } Nie korzystaj z SQL w Service php // \u274c WRONG - Use Repository $this->pdo->query(\"SELECT...\"); Nie importuj Application w Infrastructure php // \u274c WRONG use App\\Application\\UseCase\\CreateAnnouncementUseCase; Nie cache'uj obiekty bez namys\u0142u php // \u26a0\ufe0f CAREFUL - Use singleton pattern private $announcement; // Will be stale! \ud83d\udcca Mapowanie Warstw Warstwa Komponenty Odpowiedzialno\u015b\u0107 Domain Entity, ValueObject Logika biznesowa Application UseCase, DTO Orkiestracja Infrastructure Repository, Service Techniczne szczeg\u00f3\u0142y Presentation Controller, Command Interfejsy u\u017cytkownika","title":"Infrastructure"},{"location":"layers/infrastructure/#infrastructure-layer-api-reference","text":"Warstwa Infrastructure zawiera implementacj\u0119 technicznych szczeg\u00f3\u0142\u00f3w, integracje z zewn\u0119trznymi serwisami i zarz\u0105dzaniem danymi.","title":"Infrastructure Layer - API Reference"},{"location":"layers/infrastructure/#struktura-infrastructure-layer","text":"src/Infrastructure/ \u251c\u2500\u2500 Container.php # Dependency Injection Container \u251c\u2500\u2500 Repository/ # Data Access Layer \u2502 \u251c\u2500\u2500 DatabaseAnnouncementRepository.php \u2502 \u251c\u2500\u2500 DatabaseUserRepository.php \u2502 \u251c\u2500\u2500 DatabaseWordRepository.php \u2502 \u251c\u2500\u2500 DatabaseQuoteRepository.php \u2502 \u2514\u2500\u2500 DatabaseCountdownRepository.php \u251c\u2500\u2500 Service/ # External Services \u2502 \u251c\u2500\u2500 ExternalWordApiService.php \u2502 \u251c\u2500\u2500 ExternalQuoteApiService.php \u2502 \u251c\u2500\u2500 EmailService.php \u2502 \u2514\u2500\u2500 LoggerService.php \u251c\u2500\u2500 Factory/ # Object Creation \u2502 \u251c\u2500\u2500 AnnouncementFactory.php \u2502 \u251c\u2500\u2500 UserFactory.php \u2502 \u2514\u2500\u2500 ... \u251c\u2500\u2500 Security/ # Security & Auth \u2502 \u251c\u2500\u2500 PasswordHasher.php \u2502 \u251c\u2500\u2500 TokenGenerator.php \u2502 \u2514\u2500\u2500 AuthenticationService.php \u251c\u2500\u2500 Helper/ # Utility Functions \u2502 \u251c\u2500\u2500 DateHelper.php \u2502 \u251c\u2500\u2500 StringHelper.php \u2502 \u2514\u2500\u2500 ValidationHelper.php \u251c\u2500\u2500 Translation/ # Internationalization \u2502 \u2514\u2500\u2500 TranslationService.php \u251c\u2500\u2500 Trait/ # Shared Traits \u2502 \u2514\u2500\u2500 TimestampableTrait.php \u2514\u2500\u2500 View/ # View Helpers \u2514\u2500\u2500 TemplateRenderer.php Namespace : App\\Infrastructure\\","title":"\ud83d\udccd Struktura Infrastructure Layer"},{"location":"layers/infrastructure/#repositories","text":"Repositories implementuj\u0105 abstrakcj\u0119 dost\u0119pu do danych (patrz: Repository Pattern).","title":"\ud83d\udd0c Repositories"},{"location":"layers/infrastructure/#databaseannouncementrepository","text":"Lokalizacja : src/Infrastructure/Repository/DatabaseAnnouncementRepository.php Odpowiedzialno\u015b\u0107 : Persystencja danych Announcement w bazie danych Implementuje : AnnouncementRepositoryInterface (Future) Zale\u017cno\u015bci : public function __construct( private PDO $pdo )","title":"DatabaseAnnouncementRepository"},{"location":"layers/infrastructure/#saveannouncement-announcement-void","text":"Zapisz (lub zaktualizuj) og\u0142oszenie w bazie. Parametry : - Announcement $announcement - Agregat do zapisania Efekty : - INSERT je\u015bli $announcement->id === null - UPDATE je\u015bli $announcement->id !== null SQL : -- INSERT INSERT INTO announcements ( title, text, created_at, valid_until, user_id, status, decided_at, decided_by ) VALUES (...) -- UPDATE UPDATE announcements SET title = ?, text = ?, status = ?, decided_at = ?, decided_by = ? WHERE id = ? Wyj\u0105tki : - DatabaseException - B\u0142\u0105d SQL - ConstraintViolationException - Naruszenie constraint'a U\u017cycie : $announcement = Announcement::createNew(...); $repository->save($announcement);","title":"save(Announcement $announcement): void"},{"location":"layers/infrastructure/#findbyidint-id-announcement","text":"Pobierz og\u0142oszenie po ID. Parametry : - int $id - ID og\u0142oszenia Zwraca : - Announcement - Znalezione og\u0142oszenie - null - Je\u015bli nie znalezione SQL : SELECT * FROM announcements WHERE id = ? LIMIT 1","title":"findById(int $id): ?Announcement"},{"location":"layers/infrastructure/#findall-array","text":"Pobierz wszystkie og\u0142oszenia. Zwraca : array<Announcement>","title":"findAll(): array"},{"location":"layers/infrastructure/#findbystatusstring-status-array","text":"Pobierz og\u0142oszenia o okre\u015blonym statusie. Parametry : - string $status - Status (pending/approved/rejected) Zwraca : array<Announcement>","title":"findByStatus(string $status): array"},{"location":"layers/infrastructure/#findvalid-array","text":"Pobierz tylko wa\u017cne og\u0142oszenia (approved i jeszcze nieugas\u0142e). Zwraca : array<Announcement> - Aktualnie widoczne SQL : SELECT * FROM announcements WHERE status = 'approved' AND valid_until >= NOW() ORDER BY created_at DESC","title":"findValid(): array"},{"location":"layers/infrastructure/#deleteint-id-void","text":"Usu\u0144 og\u0142oszenie. Parametry : - int $id - ID do usuni\u0119cia","title":"delete(int $id): void"},{"location":"layers/infrastructure/#databaseuserrepository","text":"Lokalizacja : src/Infrastructure/Repository/DatabaseUserRepository.php Zarz\u0105dza persystencj\u0105 u\u017cytkownik\u00f3w.","title":"DatabaseUserRepository"},{"location":"layers/infrastructure/#saveuser-user-void","text":"Zapisz u\u017cytkownika.","title":"save(User $user): void"},{"location":"layers/infrastructure/#findbyidint-id-user","text":"Pobierz po ID.","title":"findById(int $id): ?User"},{"location":"layers/infrastructure/#findbyemailstring-email-user","text":"Pobierz po email.","title":"findByEmail(string $email): ?User"},{"location":"layers/infrastructure/#existsemailstring-email-bool","text":"Sprawd\u017a czy email istnieje.","title":"existsEmail(string $email): bool"},{"location":"layers/infrastructure/#databasewordrepository","text":"Zarz\u0105dza s\u0142owami dnia.","title":"DatabaseWordRepository"},{"location":"layers/infrastructure/#databasequoterepository","text":"Zarz\u0105dza cytatami.","title":"DatabaseQuoteRepository"},{"location":"layers/infrastructure/#external-services","text":"Serwisy integruj\u0105ce si\u0119 z zewn\u0119trznymi API.","title":"\ud83d\udd17 External Services"},{"location":"layers/infrastructure/#externalwordapiservice","text":"Lokalizacja : src/Infrastructure/Service/ExternalWordApiService.php Odpowiedzialno\u015b\u0107 : Pobieranie s\u0142\u00f3w z zewn\u0119trznego API Zale\u017cno\u015bci : public function __construct( private HttpClient $httpClient, private ConfigService $config )","title":"ExternalWordApiService"},{"location":"layers/infrastructure/#fetchdailyword-word","text":"Pobierz s\u0142owo dnia z zewn\u0119trznego API. Zwraca : Word - Transformowane do Domain Entity Flow : 1. HTTP GET do external API 2. Parse response 3. Walidacja 4. Transformacja do Word Entity 5. Return Wyj\u0105tki : - ExternalServiceException - Problem z API - HttpException - B\u0142\u0105d HTTP - InvalidResponseException - B\u0142\u0119dna struktura danych HTTP : GET https://api.external.com/word/daily Accept: application/json Authorization: Bearer {token} Response : { \"word\": \"ephemeral\", \"definition\": \"Lasting for a very short time\", \"example\": \"The beauty of cherry blossoms is ephemeral\", \"language\": \"en\" } U\u017cycie : // W CLI Command lub UseCase $word = $this->wordService->fetchDailyWord(); $this->wordRepository->save($word);","title":"fetchDailyWord(): Word"},{"location":"layers/infrastructure/#externalquoteapiservice","text":"Lokalizacja : src/Infrastructure/Service/ExternalQuoteApiService.php Pobieranie cytat\u00f3w z zewn\u0119trznego API.","title":"ExternalQuoteApiService"},{"location":"layers/infrastructure/#fetchdailyquote-quote","text":"","title":"fetchDailyQuote(): Quote"},{"location":"layers/infrastructure/#emailservice","text":"Lokalizacja : src/Infrastructure/Service/EmailService.php Odpowiedzialno\u015b\u0107 : Wysy\u0142anie emaili Zale\u017cno\u015bci : public function __construct( private SmtpClient $smtpClient, private ConfigService $config )","title":"EmailService"},{"location":"layers/infrastructure/#sendstring-to-string-subject-string-body-void","text":"Wy\u015blij email. Parametry : - string $to - Adres email odbiorcy - string $subject - Temat - string $body - Tre\u015b\u0107 (HTML/Plain) Efekty : Email wys\u0142any via SMTP Wyj\u0105tki : - EmailException - B\u0142\u0105d wysy\u0142ki","title":"send(string $to, string $subject, string $body): void"},{"location":"layers/infrastructure/#factories","text":"Fabryki tworz\u0105 kompleksowe obiekty z r\u00f3\u017cnych \u017ar\u00f3de\u0142.","title":"\ud83c\udfed Factories"},{"location":"layers/infrastructure/#announcementfactory","text":"Lokalizacja : src/Infrastructure/Factory/AnnouncementFactory.php","title":"AnnouncementFactory"},{"location":"layers/infrastructure/#createfromrequestcreateannouncementrequest-request-announcement","text":"Utw\u00f3rz Announcement Entity z Request. public static function createFromRequest( CreateAnnouncementRequest $request, ?int $userId = null ): Announcement { return Announcement::createNew( title: $request->title, text: $request->text, validUntil: new DateTimeImmutable($request->validUntil), userId: $userId ?? $request->userId, ); }","title":"createFromRequest(CreateAnnouncementRequest $request): Announcement"},{"location":"layers/infrastructure/#createfromdatabaserowarray-row-announcement","text":"Utw\u00f3rz Announcement Entity z rekordu bazy. public static function createFromDatabaseRow(array $row): Announcement { return new Announcement( id: (int) $row['id'], title: $row['title'], text: $row['text'], createdAt: new DateTimeImmutable($row['created_at']), validUntil: new DateTimeImmutable($row['valid_until']), userId: $row['user_id'] ? (int) $row['user_id'] : null, status: AnnouncementStatus::from($row['status']), decidedAt: $row['decided_at'] ? new DateTimeImmutable($row['decided_at']) : null, decidedBy: $row['decided_by'] ? (int) $row['decided_by'] : null, ); }","title":"createFromDatabaseRow(array $row): Announcement"},{"location":"layers/infrastructure/#security-components","text":"Komponenty bezpiecze\u0144stwa i autentykacji.","title":"\ud83d\udd10 Security Components"},{"location":"layers/infrastructure/#passwordhasher","text":"Lokalizacja : src/Infrastructure/Security/PasswordHasher.php","title":"PasswordHasher"},{"location":"layers/infrastructure/#hashstring-password-string","text":"Zahaszuj has\u0142o. public function hash(string $password): string { return password_hash($password, PASSWORD_BCRYPT, [ 'cost' => 12 ]); }","title":"hash(string $password): string"},{"location":"layers/infrastructure/#verifystring-password-string-hash-bool","text":"Sprawd\u017a has\u0142o. public function verify(string $password, string $hash): bool { return password_verify($password, $hash); }","title":"verify(string $password, string $hash): bool"},{"location":"layers/infrastructure/#tokengenerator","text":"Lokalizacja : src/Infrastructure/Security/TokenGenerator.php","title":"TokenGenerator"},{"location":"layers/infrastructure/#generatejwtuser-user-int-expiresin-3600-string","text":"Wygeneruj JWT token dla u\u017cytkownika. public function generateJWT(User $user, int $expiresIn = 3600): string { $payload = [ 'user_id' => $user->id, 'email' => $user->email, 'role' => $user->role, 'iat' => time(), 'exp' => time() + $expiresIn ]; return JWT::encode($payload, $this->secret, 'HS256'); }","title":"generateJWT(User $user, int $expiresIn = 3600): string"},{"location":"layers/infrastructure/#generaterefreshtokenuser-user-string","text":"Wygeneruj refresh token.","title":"generateRefreshToken(User $user): string"},{"location":"layers/infrastructure/#authenticationservice","text":"Lokalizacja : src/Infrastructure/Security/AuthenticationService.php","title":"AuthenticationService"},{"location":"layers/infrastructure/#authenticatestring-email-string-password-user","text":"Uwierzytelnij u\u017cytkownika. public function authenticate(string $email, string $password): User { $user = $this->userRepository->findByEmail($email); if (!$user || !$this->passwordHasher->verify($password, $user->passwordHash)) { throw new InvalidCredentialsException(); } return $user; }","title":"authenticate(string $email, string $password): User"},{"location":"layers/infrastructure/#helpers","text":"Funkcje pomocnicze.","title":"\ud83d\udee0\ufe0f Helpers"},{"location":"layers/infrastructure/#datehelper","text":"Lokalizacja : src/Infrastructure/Helper/DateHelper.php class DateHelper { public static function now(): DateTimeImmutable { return new DateTimeImmutable(); } public static function tomorrow(): DateTimeImmutable { return self::now()->modify('+1 day'); } public static function addDays(DateTimeImmutable $date, int $days): DateTimeImmutable { return $date->modify(\"+{$days} days\"); } public static function isExpired(DateTimeImmutable $date): bool { return $date < self::now(); } }","title":"DateHelper"},{"location":"layers/infrastructure/#stringhelper","text":"class StringHelper { public static function slugify(string $text): string { return strtolower(preg_replace('/[^a-z0-9]+/', '-', trim($text))); } public static function truncate(string $text, int $length = 100): string { if (strlen($text) <= $length) return $text; return substr($text, 0, $length) . '...'; } }","title":"StringHelper"},{"location":"layers/infrastructure/#validationhelper","text":"class ValidationHelper { public static function isValidEmail(string $email): bool { return filter_var($email, FILTER_VALIDATE_EMAIL) !== false; } public static function isValidUrl(string $url): bool { return filter_var($url, FILTER_VALIDATE_URL) !== false; } }","title":"ValidationHelper"},{"location":"layers/infrastructure/#translation-service","text":"Obs\u0142uga wieloj\u0119zyczno\u015bci.","title":"\ud83c\udf10 Translation Service"},{"location":"layers/infrastructure/#translationservice","text":"Lokalizacja : src/Infrastructure/Translation/TranslationService.php public function translate(string $key, string $locale = 'pl'): string { $messages = $this->loadMessages($locale); return $messages[$key] ?? $key; } public function t(string $key, array $params = [], string $locale = 'pl'): string { $message = $this->translate($key, $locale); foreach ($params as $key => $value) { $message = str_replace(\":$key\", $value, $message); } return $message; } U\u017cycie : $this->translator->t('announcement.created', ['title' => $announcement->title]); // \"Og\u0142oszenie 'Nowa promocja' zosta\u0142o utworzone\"","title":"TranslationService"},{"location":"layers/infrastructure/#dependency-injection-container","text":"","title":"\ud83d\ude9a Dependency Injection Container"},{"location":"layers/infrastructure/#containerphp","text":"Lokalizacja : src/Infrastructure/Container.php Zarz\u0105dzanie zale\u017cno\u015bciami i lifecycle'em obiekt\u00f3w. class Container { private array $services = []; private array $singletons = []; public function register(string $id, mixed $definition): void { $this->services[$id] = $definition; } public function singleton(string $id, callable $definition): void { $this->singletons[$id] = $definition; } public function get(string $id): mixed { if (isset($this->singletons[$id])) { // Zwr\u00f3\u0107 ten sam instancj\u0119 return $this->singletons[$id]($this); } if (isset($this->services[$id])) { return $this->services[$id]($this); } throw new ServiceNotFoundException($id); } }","title":"Container.php"},{"location":"layers/infrastructure/#rejestracja-serwisow","text":"// src/bootstrap/services.php $container->singleton(PDO::class, function(Container $c) { return new PDO( 'pgsql:host=localhost;dbname=dodomudojade', 'ddd', $_ENV['DB_PASSWORD'] ); }); $container->singleton(AnnouncementRepository::class, function(Container $c) { return new DatabaseAnnouncementRepository($c->get(PDO::class)); }); $container->singleton(CreateAnnouncementUseCase::class, function(Container $c) { return new CreateAnnouncementUseCase( $c->get(AnnouncementRepository::class), ); });","title":"Rejestracja Serwis\u00f3w"},{"location":"layers/infrastructure/#uzycie-w-controller","text":"class AnnouncementController { public function __construct( private Container $container ) {} public function create(Request $request): Response { $useCase = $this->container->get(CreateAnnouncementUseCase::class); $dto = $useCase->execute($request); return Response::created($dto); } }","title":"U\u017cycie w Controller"},{"location":"layers/infrastructure/#architektura-warstwowa","text":"Presentation (Http, Console) \u2193 (uses) \u2193 Application (UseCase, DTO) \u2193 (uses) \u2193 Domain (Entity, ValueObject, Enum) \u2191 \u2191 | | (implements) | | Infrastructure (Repository, Service)","title":"\ud83d\udcca Architektura Warstwowa"},{"location":"layers/infrastructure/#best-practices","text":"","title":"\ud83c\udf93 Best Practices"},{"location":"layers/infrastructure/#do","text":"Implementuj Repository interfaces (Future) php interface AnnouncementRepository { public function save(Announcement $announcement): void; public function findById(int $id): ?Announcement; } U\u017cyj Factories dla kompleksowych obiekt\u00f3w php $entity = AnnouncementFactory::createFromDatabaseRow($row); Abstrakcjonuj external API calls php interface WordApiService { public function fetchDailyWord(): Word; } Zarz\u0105dzaj transakcjami php $this->pdo->beginTransaction(); try { $this->repository->save($entity); $this->pdo->commit(); } catch (Exception $e) { $this->pdo->rollBack(); throw $e; } Loguj wa\u017cne operacje php $this->logger->info(\"Announcement approved\", ['id' => $announcement->id]);","title":"\u2705 DO"},{"location":"layers/infrastructure/#dont","text":"Nie r\u00f3b logiki biznesowej w Repository php // \u274c WRONG public function save(Announcement $announcement): void { if ($announcement->title == '') throw new Exception(); } Nie korzystaj z SQL w Service php // \u274c WRONG - Use Repository $this->pdo->query(\"SELECT...\"); Nie importuj Application w Infrastructure php // \u274c WRONG use App\\Application\\UseCase\\CreateAnnouncementUseCase; Nie cache'uj obiekty bez namys\u0142u php // \u26a0\ufe0f CAREFUL - Use singleton pattern private $announcement; // Will be stale!","title":"\u274c DON'T"},{"location":"layers/infrastructure/#mapowanie-warstw","text":"Warstwa Komponenty Odpowiedzialno\u015b\u0107 Domain Entity, ValueObject Logika biznesowa Application UseCase, DTO Orkiestracja Infrastructure Repository, Service Techniczne szczeg\u00f3\u0142y Presentation Controller, Command Interfejsy u\u017cytkownika","title":"\ud83d\udcca Mapowanie Warstw"}]}