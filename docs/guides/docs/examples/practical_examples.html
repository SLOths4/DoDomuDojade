<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
            <title>DoDomuDojade Documentation</title>
    

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="../../../">
    <link rel="icon" href="images/favicon.ico"/>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/base.css">
            <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@100;200;300;400;600;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="css/template.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism-okaidia.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-highlight/prism-line-highlight.css">
                <script src="https://cdn.jsdelivr.net/npm/fuse.js@3.4.6"></script>
        <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
        <script src="js/template.js"></script>
        <script src="js/search.js"></script>
        <script defer src="js/searchIndex.js"></script>
    </head>
<body id="top">
    <header class="phpdocumentor-header phpdocumentor-section">
    <h1 class="phpdocumentor-title"><a href="" class="phpdocumentor-title__link">DoDomuDojade Documentation</a></h1>
    <input class="phpdocumentor-header__menu-button" type="checkbox" id="menu-button" name="menu-button" />
    <label class="phpdocumentor-header__menu-icon" for="menu-button">
        <i class="fas fa-bars"></i>
    </label>
    <section data-search-form class="phpdocumentor-search">
    <label>
        <span class="visually-hidden">Search for</span>
        <svg class="phpdocumentor-search__icon" width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="7.5" cy="7.5" r="6.5" stroke="currentColor" stroke-width="2"/>
            <line x1="12.4892" y1="12.2727" x2="19.1559" y2="18.9393" stroke="currentColor" stroke-width="3"/>
        </svg>
        <input type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading .." disabled />
    </label>
</section>

    <nav class="phpdocumentor-topnav">
    <ul class="phpdocumentor-topnav__menu">
        </ul>
</nav>
</header>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <input class="phpdocumentor-sidebar__menu-button" type="checkbox" id="sidebar-button" name="sidebar-button" />
<label class="phpdocumentor-sidebar__menu-icon" for="sidebar-button">
    Menu
</label>
<aside class="phpdocumentor-column -three phpdocumentor-sidebar">
                    <section class="phpdocumentor-sidebar__category -namespaces">
            <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="namespaces/app.html" class="">App</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="namespaces/app-application.html" class="">Application</a>
                
            </li>
                    <li>
                <a href="namespaces/app-config.html" class="">config</a>
                
            </li>
                    <li>
                <a href="namespaces/app-console.html" class="">Console</a>
                
            </li>
                    <li>
                <a href="namespaces/app-domain.html" class="">Domain</a>
                
            </li>
                    <li>
                <a href="namespaces/app-http.html" class="">Http</a>
                
            </li>
                    <li>
                <a href="namespaces/app-infrastructure.html" class="">Infrastructure</a>
                
            </li>
            </ul>

                        </section>
                <section class="phpdocumentor-sidebar__category -packages">
            <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="packages/Application.html" class="">Application</a>
</h4>

                        </section>
            
    <section class="phpdocumentor-sidebar__category -reports">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category -indices">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="indices/files.html">Files</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -nine phpdocumentor-content">
                                        
<section class="section " id="praktyczne-przyklady-i-wzorce">
            <h1>Praktyczne PrzykÅ‚ady i Wzorce</h1>

            
    <p>Rzeczywiste przykÅ‚ady kodu pokazujÄ…ce jak uÅ¼ywaÄ‡ architekturÄ™ DDD w DoDomuDojadÄ™.</p>

            <section class="section " id="przyklad-1-tworzenie-ogloszenia">
            <h2>ğŸ“ PrzykÅ‚ad 1: Tworzenie OgÅ‚oszenia</h2>

            <section class="section " id="scenariusz-nowy-admin-chce-stworzyc-ogloszenie">
            <h3>Scenariusz: Nowy admin chce stworzyÄ‡ ogÅ‚oszenie</h3>

            <pre><code class="language-">HTTP POST /api/announcements
{
  &quot;title&quot;: &quot;Nowe godziny otwarcia&quot;,
  &quot;text&quot;: &quot;Od poniedziaÅ‚ku bÄ™dziemy otwarci od 8:00 do 18:00&quot;,
  &quot;valid_until&quot;: &quot;2026-02-01T23:59:59Z&quot;
}
</code></pre>

    </section>

            <section class="section " id="krok-1-controller-presentation-layer">
            <h3>Krok 1: Controller (Presentation Layer)</h3>

            <pre><code class="language-">// src/Http/Controller/AnnouncementController.php
class AnnouncementController {
    public function __construct(
        private Container $container,
        private LoggerInterface $logger
    ) {}
    
    public function create(Request $request): Response {
        try {
            // Parse JSON body
            $data = $request-&gt;json();
            
            // Create Request object
            $createRequest = new CreateAnnouncementRequest(
                title: $data[&#039;title&#039;] ?? &#039;&#039;,
                text: $data[&#039;text&#039;] ?? &#039;&#039;,
                validUntil: $data[&#039;valid_until&#039;] ?? &#039;&#039;,
                userId: $request-&gt;userId() // from JWT token
            );
            
            // Validate request
            $errors = $createRequest-&gt;validate();
            if (!empty($errors)) {
                return Response::unprocessableEntity([&#039;errors&#039; =&gt; $errors]);
            }
            
            // Get UseCase from DI Container
            $useCase = $this-&gt;container-&gt;get(CreateAnnouncementUseCase::class);
            
            // Execute
            $announcementDTO = $useCase-&gt;execute($createRequest);
            
            return Response::created([
                &#039;id&#039; =&gt; $announcementDTO-&gt;id,
                &#039;title&#039; =&gt; $announcementDTO-&gt;title,
                &#039;status&#039; =&gt; $announcementDTO-&gt;status,
                &#039;created_at&#039; =&gt; $announcementDTO-&gt;createdAt
            ]);
            
        } catch (ValidationException $e) {
            return Response::unprocessableEntity([&#039;errors&#039; =&gt; $e-&gt;getErrors()]);
        } catch (AnnouncementException $e) {
            return Response::badRequest([&#039;error&#039; =&gt; $e-&gt;getMessage()]);
        } catch (Exception $e) {
            $this-&gt;logger-&gt;error(&quot;Failed to create announcement&quot;, [&#039;error&#039; =&gt; $e]);
            return Response::internalServerError();
        }
    }
}
</code></pre>

    </section>

            <section class="section " id="krok-2-use-case-application-layer">
            <h3>Krok 2: Use Case (Application Layer)</h3>

            <pre><code class="language-">// src/Application/UseCase/Announcement/CreateAnnouncementUseCase.php
class CreateAnnouncementUseCase {
    public function __construct(
        private AnnouncementRepository $announcementRepository,
        private LoggerInterface $logger
    ) {}
    
    public function execute(CreateAnnouncementRequest $request): AnnouncementDTO {
        // Step 1: Validate request
        $errors = $request-&gt;validate();
        if (!empty($errors)) {
            throw new ValidationException($errors);
        }
        
        // Step 2: Create Domain Entity using factory
        $announcement = AnnouncementFactory::createFromRequest(
            $request,
            userId: $request-&gt;userId
        );
        
        // Step 3: Save to repository
        $this-&gt;announcementRepository-&gt;save($announcement);
        
        // Step 4: Log
        $this-&gt;logger-&gt;info(&quot;Announcement created&quot;, [
            &#039;id&#039; =&gt; $announcement-&gt;id,
            &#039;title&#039; =&gt; $announcement-&gt;title,
            &#039;userId&#039; =&gt; $request-&gt;userId
        ]);
        
        // Step 5: Transform to DTO
        return AnnouncementDTO::fromEntity($announcement);
    }
}
</code></pre>

    </section>

            <section class="section " id="krok-3-factory-infrastructure-layer">
            <h3>Krok 3: Factory (Infrastructure Layer)</h3>

            <pre><code class="language-">// src/Infrastructure/Factory/AnnouncementFactory.php
class AnnouncementFactory {
    public static function createFromRequest(
        CreateAnnouncementRequest $request,
        int $userId = null
    ): Announcement {
        return Announcement::createNew(
            title: $request-&gt;title,
            text: $request-&gt;text,
            validUntil: new DateTimeImmutable($request-&gt;validUntil),
            userId: $userId ?? $request-&gt;userId,
        );
    }
}
</code></pre>

    </section>

            <section class="section " id="krok-4-domain-entity-domain-layer">
            <h3>Krok 4: Domain Entity (Domain Layer)</h3>

            <pre><code class="language-">// src/Domain/Entity/Announcement.php
final class Announcement {
    public function __construct(
        public ?int               $id,
        public string             $title,
        public string             $text,
        public DateTimeImmutable  $createdAt,
        public DateTimeImmutable  $validUntil,
        public ?int               $userId,
        public AnnouncementStatus $status = AnnouncementStatus::PENDING,
        public ?DateTimeImmutable $decidedAt = null,
        public ?int               $decidedBy = null,
    ){}
    
    // Factory method - tworzy juÅ¼ zatwierdzone ogÅ‚oszenie
    public static function createNew(
        string            $title,
        string            $text,
        DateTimeImmutable $validUntil,
        int               $userId,
    ): self {
        return new self(
            id: null, // Still null, will be set by DB
            title: $title,
            text: $text,
            createdAt: new DateTimeImmutable(),
            validUntil: $validUntil,
            userId: $userId,
            status: AnnouncementStatus::APPROVED,
            decidedAt: new DateTimeImmutable(),
            decidedBy: $userId // Admin who created it
        );
    }
}
</code></pre>

    </section>

            <section class="section " id="krok-5-repository-infrastructure-layer">
            <h3>Krok 5: Repository (Infrastructure Layer)</h3>

            <pre><code class="language-">// src/Infrastructure/Repository/DatabaseAnnouncementRepository.php
class DatabaseAnnouncementRepository {
    public function __construct(private PDO $pdo) {}
    
    public function save(Announcement $announcement): void {
        if ($announcement-&gt;id === null) {
            // INSERT
            $stmt = $this-&gt;pdo-&gt;prepare(
                &#039;INSERT INTO announcements (
                    title, text, created_at, valid_until, user_id, status, decided_at, decided_by
                ) VALUES (
                    :title, :text, :created_at, :valid_until, :user_id, :status, :decided_at, :decided_by
                )&#039;
            );
            
            $stmt-&gt;execute([
                &#039;:title&#039; =&gt; $announcement-&gt;title,
                &#039;:text&#039; =&gt; $announcement-&gt;text,
                &#039;:created_at&#039; =&gt; $announcement-&gt;createdAt-&gt;format(&#039;c&#039;),
                &#039;:valid_until&#039; =&gt; $announcement-&gt;validUntil-&gt;format(&#039;c&#039;),
                &#039;:user_id&#039; =&gt; $announcement-&gt;userId,
                &#039;:status&#039; =&gt; $announcement-&gt;status-&gt;name,
                &#039;:decided_at&#039; =&gt; $announcement-&gt;decidedAt?-&gt;format(&#039;c&#039;),
                &#039;:decided_by&#039; =&gt; $announcement-&gt;decidedBy,
            ]);
            
            // Get inserted ID and update entity
            $announcement-&gt;id = (int) $this-&gt;pdo-&gt;lastInsertId();
        } else {
            // UPDATE
            $stmt = $this-&gt;pdo-&gt;prepare(
                &#039;UPDATE announcements SET 
                    title = :title, 
                    text = :text, 
                    status = :status, 
                    decided_at = :decided_at, 
                    decided_by = :decided_by 
                WHERE id = :id&#039;
            );
            
            $stmt-&gt;execute([
                &#039;:id&#039; =&gt; $announcement-&gt;id,
                &#039;:title&#039; =&gt; $announcement-&gt;title,
                &#039;:text&#039; =&gt; $announcement-&gt;text,
                &#039;:status&#039; =&gt; $announcement-&gt;status-&gt;name,
                &#039;:decided_at&#039; =&gt; $announcement-&gt;decidedAt?-&gt;format(&#039;c&#039;),
                &#039;:decided_by&#039; =&gt; $announcement-&gt;decidedBy,
            ]);
        }
    }
}
</code></pre>

    </section>

            <section class="section " id="krok-6-dto-application-layer">
            <h3>Krok 6: DTO (Application Layer)</h3>

            <pre><code class="language-">// src/Application/DataTransferObject/AnnouncementDTO.php
final class AnnouncementDTO {
    public function __construct(
        public int     $id,
        public string  $title,
        public string  $text,
        public string  $createdAt,
        public string  $validUntil,
        public ?int    $userId,
        public string  $status,
        public ?string $decidedAt,
        public ?int    $decidedBy,
    ) {}
    
    public static function fromEntity(Announcement $entity): self {
        return new self(
            id: $entity-&gt;id,
            title: $entity-&gt;title,
            text: $entity-&gt;text,
            createdAt: $entity-&gt;createdAt-&gt;format(&#039;c&#039;),
            validUntil: $entity-&gt;validUntil-&gt;format(&#039;c&#039;),
            userId: $entity-&gt;userId,
            status: $entity-&gt;status-&gt;name,
            decidedAt: $entity-&gt;decidedAt?-&gt;format(&#039;c&#039;),
            decidedBy: $entity-&gt;decidedBy,
        );
    }
}
</code></pre>

    </section>

            <section class="section " id="http-response">
            <h3>HTTP Response</h3>

            <pre><code class="language-">HTTP 201 Created

{
  &quot;id&quot;: 42,
  &quot;title&quot;: &quot;Nowe godziny otwarcia&quot;,
  &quot;status&quot;: &quot;approved&quot;,
  &quot;created_at&quot;: &quot;2026-01-02T10:42:00Z&quot;
}
</code></pre>

            <hr />

    </section>

    </section>

            <section class="section " id="przyklad-2-zatwierdzanie-ogloszenia">
            <h2>ğŸ”„ PrzykÅ‚ad 2: Zatwierdzanie OgÅ‚oszenia</h2>

            <section class="section " id="scenariusz-admin-zatwierdza-oczekujace-ogloszenie">
            <h3>Scenariusz: Admin zatwierdza oczekujÄ…ce ogÅ‚oszenie</h3>

            <pre><code class="language-">HTTP POST /api/announcements/{id}/approve
</code></pre>

    </section>

            <section class="section " id="controller">
            <h3>Controller</h3>

            <pre><code class="language-">public function approve(Request $request, int $id): Response {
    try {
        $useCase = $this-&gt;container-&gt;get(ApproveAnnouncementUseCase::class);
        $announcementDTO = $useCase-&gt;execute(
            announcementId: $id,
            adminId: $request-&gt;userId()
        );
        
        return Response::ok([
            &#039;message&#039; =&gt; &#039;Announcement approved&#039;,
            &#039;announcement&#039; =&gt; $announcementDTO
        ]);
    } catch (AnnouncementNotFoundException $e) {
        return Response::notFound([&#039;error&#039; =&gt; &#039;Announcement not found&#039;]);
    } catch (AnnouncementException $e) {
        return Response::badRequest([&#039;error&#039; =&gt; $e-&gt;getMessage()]);
    }
}
</code></pre>

    </section>

            <section class="section " id="use-case">
            <h3>Use Case</h3>

            <pre><code class="language-">class ApproveAnnouncementUseCase {
    public function __construct(
        private AnnouncementRepository $repository
    ) {}
    
    public function execute(int $announcementId, int $adminId): AnnouncementDTO {
        // Pobierz z bazy
        $announcement = $this-&gt;repository-&gt;findById($announcementId);
        
        if (!$announcement) {
            throw new AnnouncementNotFoundException();
        }
        
        if ($announcement-&gt;status !== AnnouncementStatus::PENDING) {
            throw new AnnouncementException(
                &quot;Cannot approve announcement that is not pending&quot;
            );
        }
        
        // Aplikuj reguÅ‚y biznesowe (logika w Domain!)
        $announcement-&gt;approve($adminId);
        
        // Zapisz
        $this-&gt;repository-&gt;save($announcement);
        
        // ZwrÃ³Ä‡ DTO
        return AnnouncementDTO::fromEntity($announcement);
    }
}
</code></pre>

    </section>

            <section class="section " id="domain-entity-business-logic">
            <h3>Domain Entity (Business Logic!)</h3>

            <pre><code class="language-">public function approve(int $decidedBy): void {
    // Business rule: Only PENDING can be approved
    // (implicit invariant, enforced by UseCase)
    
    $this-&gt;status = AnnouncementStatus::APPROVED;
    $this-&gt;decidedAt = new DateTimeImmutable();
    $this-&gt;decidedBy = $decidedBy;
}
</code></pre>

            <hr />

    </section>

    </section>

            <section class="section " id="przyklad-3-rejestracja-uzytkownika">
            <h2>ğŸ” PrzykÅ‚ad 3: Rejestracja UÅ¼ytkownika</h2>

            <section class="section " id="controller">
            <h3>Controller</h3>

            <pre><code class="language-">public function register(Request $request): Response {
    try {
        $registerRequest = new RegisterUserRequest(
            email: $request-&gt;input(&#039;email&#039;),
            password: $request-&gt;input(&#039;password&#039;),
            name: $request-&gt;input(&#039;name&#039;),
            phoneNumber: $request-&gt;input(&#039;phone_number&#039;)
        );
        
        $useCase = $this-&gt;container-&gt;get(RegisterUserUseCase::class);
        $userDTO = $useCase-&gt;execute($registerRequest);
        
        return Response::created([&#039;user&#039; =&gt; $userDTO]);
        
    } catch (ValidationException $e) {
        return Response::unprocessableEntity([&#039;errors&#039; =&gt; $e-&gt;getErrors()]);
    } catch (UserException $e) {
        return Response::badRequest([&#039;error&#039; =&gt; $e-&gt;getMessage()]);
    }
}
</code></pre>

    </section>

            <section class="section " id="use-case">
            <h3>Use Case</h3>

            <pre><code class="language-">class RegisterUserUseCase {
    public function __construct(
        private UserRepository $userRepository,
        private PasswordHasher $passwordHasher
    ) {}
    
    public function execute(RegisterUserRequest $request): UserDTO {
        // Waliduj
        $errors = $request-&gt;validate();
        if (!empty($errors)) {
            throw new ValidationException($errors);
        }
        
        // SprawdÅº czy email juÅ¼ istnieje
        if ($this-&gt;userRepository-&gt;existsByEmail($request-&gt;email)) {
            throw new UserException(&quot;Email already registered&quot;);
        }
        
        // Zahaszuj hasÅ‚o (Infrastructure concern)
        $passwordHash = $this-&gt;passwordHasher-&gt;hash($request-&gt;password);
        
        // StwÃ³rz Entity
        $user = new User(
            id: null,
            email: $request-&gt;email,
            passwordHash: $passwordHash,
            name: $request-&gt;name,
            phoneNumber: $request-&gt;phoneNumber,
            role: &#039;user&#039; // Default role
        );
        
        // Zapisz
        $this-&gt;userRepository-&gt;save($user);
        
        // ZwrÃ³Ä‡ DTO (bez hasÅ‚a!)
        return UserDTO::fromEntity($user);
    }
}
</code></pre>

    </section>

            <section class="section " id="request-object-z-walidacja">
            <h3>Request Object z WalidacjÄ…</h3>

            <pre><code class="language-">class RegisterUserRequest {
    public function __construct(
        public string  $email,
        public string  $password,
        public string  $name,
        public ?string $phoneNumber = null
    ) {}
    
    public function validate(): array {
        $errors = [];
        
        if (empty($this-&gt;email) || !filter_var($this-&gt;email, FILTER_VALIDATE_EMAIL)) {
            $errors[&#039;email&#039;] = &#039;Valid email is required&#039;;
        }
        
        if (strlen($this-&gt;password) &lt; 8) {
            $errors[&#039;password&#039;] = &#039;Password must be at least 8 characters&#039;;
        }
        
        if (empty($this-&gt;name) || strlen($this-&gt;name) &lt; 2) {
            $errors[&#039;name&#039;] = &#039;Name must be at least 2 characters&#039;;
        }
        
        if ($this-&gt;phoneNumber &amp;&amp; !preg_match(&#039;/^\d{9,}$/&#039;, $this-&gt;phoneNumber)) {
            $errors[&#039;phone&#039;] = &#039;Invalid phone number format&#039;;
        }
        
        return $errors;
    }
}
</code></pre>

            <hr />

    </section>

    </section>

            <section class="section " id="przyklad-4-integracja-z-external-api">
            <h2>ğŸ“ PrzykÅ‚ad 4: Integracja z External API</h2>

            <section class="section " id="scenariusz-cli-command-pobiera-slowo-dnia">
            <h3>Scenariusz: CLI Command pobiera sÅ‚owo dnia</h3>

    </section>

            <section class="section " id="cli-command-presentation-layer">
            <h3>CLI Command (Presentation Layer)</h3>

            <pre><code class="language-">// src/Console/Command/FetchDailyWordCommand.php
class FetchDailyWordCommand {
    public function __construct(
        private Container $container,
        private LoggerInterface $logger
    ) {}
    
    public function execute(): void {
        try {
            $useCase = $this-&gt;container-&gt;get(FetchAndSaveWordUseCase::class);
            $wordDTO = $useCase-&gt;execute();
            
            echo &quot;âœ“ Word of the day saved: {$wordDTO-&gt;word}\n&quot;;
            $this-&gt;logger-&gt;info(&quot;Daily word fetched&quot;, [&#039;word&#039; =&gt; $wordDTO-&gt;word]);
            
        } catch (ExternalServiceException $e) {
            echo &quot;âœ— Failed to fetch word: {$e-&gt;getMessage()}\n&quot;;
            $this-&gt;logger-&gt;error(&quot;Failed to fetch daily word&quot;, [&#039;error&#039; =&gt; $e]);
            exit(1);
        }
    }
}
</code></pre>

    </section>

            <section class="section " id="use-case">
            <h3>Use Case</h3>

            <pre><code class="language-">class FetchAndSaveWordUseCase {
    public function __construct(
        private ExternalWordApiService $wordService,
        private WordRepository $wordRepository
    ) {}
    
    public function execute(): WordDTO {
        // Get from external API (Infrastructure)
        $word = $this-&gt;wordService-&gt;fetchDailyWord();
        
        // Save to DB (Infrastructure)
        $this-&gt;wordRepository-&gt;save($word);
        
        // Return DTO
        return WordDTO::fromEntity($word);
    }
}
</code></pre>

    </section>

            <section class="section " id="external-service">
            <h3>External Service</h3>

            <pre><code class="language-">class ExternalWordApiService {
    public function __construct(
        private HttpClient $client,
        private string $apiKey
    ) {}
    
    public function fetchDailyWord(): Word {
        try {
            // HTTP Call
            $response = $this-&gt;client-&gt;get(
                &#039;https://api.wordapi.com/daily&#039;,
                [&#039;Authorization&#039; =&gt; &quot;Bearer {$this-&gt;apiKey}&quot;]
            );
            
            if ($response-&gt;status() !== 200) {
                throw new ExternalServiceException(
                    &quot;API returned status {$response-&gt;status()}&quot;
                );
            }
            
            $data = json_decode($response-&gt;body(), assoc: true);
            
            // Validate response structure
            if (!isset($data[&#039;word&#039;]) || !isset($data[&#039;definition&#039;])) {
                throw new InvalidResponseException(&quot;Missing required fields&quot;);
            }
            
            // Transform to Domain Entity
            return new Word(
                id: null,
                word: $data[&#039;word&#039;],
                definition: $data[&#039;definition&#039;],
                example: $data[&#039;example&#039;] ?? &#039;&#039;,
                language: $data[&#039;language&#039;] ?? &#039;en&#039;
            );
            
        } catch (HttpException $e) {
            throw new ExternalServiceException(&quot;Failed to fetch word&quot;, cause: $e);
        }
    }
}
</code></pre>

            <hr />

    </section>

    </section>

            <section class="section " id="przyklad-5-error-handling">
            <h2>ğŸ›¡ï¸ PrzykÅ‚ad 5: Error Handling</h2>

            <section class="section " id="hierarchia-wyjatkow">
            <h3>Hierarchia WyjÄ…tkÃ³w</h3>

            <pre><code class="language-">// Domain Layer
namespace App\Domain\Exception;

abstract class DomainException extends Exception {}
class AnnouncementException extends DomainException {}
class UserException extends DomainException {}

// Application Layer
namespace App\Application\Exception;

class ValidationException extends Exception {
    public function __construct(
        private array $errors
    ) {}
    
    public function getErrors(): array {
        return $this-&gt;errors;
    }
}

// Infrastructure Layer
namespace App\Infrastructure\Exception;

class DatabaseException extends Exception {}
class ExternalServiceException extends Exception {}
</code></pre>

    </section>

            <section class="section " id="controller-comprehensive-error-handling">
            <h3>Controller - Comprehensive Error Handling</h3>

            <pre><code class="language-">public function create(Request $request): Response {
    try {
        // Happy path
        $request = new CreateAnnouncementRequest(...);
        $useCase = $this-&gt;container-&gt;get(CreateAnnouncementUseCase::class);
        $dto = $useCase-&gt;execute($request);
        
        return Response::created([&#039;data&#039; =&gt; $dto]);
        
    } catch (ValidationException $e) {
        // Client error - bad input
        return Response::unprocessableEntity([
            &#039;error&#039; =&gt; &#039;Validation failed&#039;,
            &#039;errors&#039; =&gt; $e-&gt;getErrors()
        ]);
        
    } catch (AnnouncementException | UserException $e) {
        // Business logic error
        return Response::badRequest([
            &#039;error&#039; =&gt; $e-&gt;getMessage()
        ]);
        
    } catch (DatabaseException $e) {
        // Infrastructure error
        $this-&gt;logger-&gt;error(&quot;Database error&quot;, [&#039;error&#039; =&gt; $e]);
        return Response::internalServerError([
            &#039;error&#039; =&gt; &#039;Failed to save announcement&#039;
        ]);
        
    } catch (Exception $e) {
        // Unexpected error
        $this-&gt;logger-&gt;critical(&quot;Unexpected error&quot;, [&#039;error&#039; =&gt; $e]);
        return Response::internalServerError([
            &#039;error&#039; =&gt; &#039;Internal server error&#039;
        ]);
    }
}
</code></pre>

            <hr />

    </section>

    </section>

            <section class="section " id="diagram-flow-kompletny-scenariusz">
            <h2>ğŸ“Š Diagram Flow - Kompletny Scenariusz</h2>

            <pre><code class="language-">USER
  â†“
HTTP POST /api/announcements
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PRESENTATION LAYER         â”‚
â”‚  (AnnouncementController)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Parse JSON                â”‚
â”‚ 2. Create Request object     â”‚
â”‚ 3. Validate request          â”‚
â”‚ 4. Get UseCase from DI       â”‚
â”‚ 5. Execute UseCase           â”‚
â”‚ 6. Format Response           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   APPLICATION LAYER          â”‚
â”‚ (CreateAnnouncementUseCase)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Validate request          â”‚
â”‚ 2. Call factory to create    â”‚
â”‚    domain entity             â”‚
â”‚ 3. Call repository.save()    â”‚
â”‚ 4. Call DTO.fromEntity()     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DOMAIN LAYER               â”‚
â”‚   (Announcement Entity)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - Apply business rules       â”‚
â”‚ - Ensure invariants          â”‚
â”‚ - Return to UseCase          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INFRASTRUCTURE LAYER         â”‚
â”‚ (DatabaseAnnouncementRepository)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. SQL INSERT                â”‚
â”‚ 2. Update ID                 â”‚
â”‚ 3. Return to UseCase         â”‚
â”‚                              â”‚
â”‚ (Database)                   â”‚
â”‚ announcements table          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
           HTTP 201
         (JSON DTO)
             â†“
           USER
</code></pre>

            <hr />

    </section>

            <section class="section " id="szybka-referencja-patternow">
            <h2>ğŸ¯ Szybka Referencja PatternÃ³w</h2>

            <section class="section " id="tworzenie-entity">
            <h3>Tworzenie Entity</h3>

            <pre><code class="language-">// Factory method w Entity
$entity = Announcement::createNew(...);

// Lub Factory pattern
$entity = AnnouncementFactory::createFromRequest($request);
</code></pre>

    </section>

            <section class="section " id="zapisanie-entity">
            <h3>Zapisanie Entity</h3>

            <pre><code class="language-">$repository-&gt;save($entity); // INSERT lub UPDATE
</code></pre>

    </section>

            <section class="section " id="pobranie-entity">
            <h3>Pobranie Entity</h3>

            <pre><code class="language-">$entity = $repository-&gt;findById($id);     // Jedno
$entities = $repository-&gt;findAll();       // Wiele
$entities = $repository-&gt;findByStatus(); // Filtr
</code></pre>

    </section>

            <section class="section " id="transformacja-do-dto">
            <h3>Transformacja do DTO</h3>

            <pre><code class="language-">$dto = AnnouncementDTO::fromEntity($entity);
</code></pre>

    </section>

            <section class="section " id="obsluga-bledow">
            <h3>ObsÅ‚uga BÅ‚Ä™dÃ³w</h3>

            <pre><code class="language-">if ($errors = $request-&gt;validate()) {
    throw new ValidationException($errors);
}

if (!$entity) {
    throw new EntityNotFoundException();
}

$entity-&gt;businessMethod(); // Rzuca DomainException jeÅ›li invariant naruszony
</code></pre>

    </section>

    </section>

    </section>

                            </div>
            <section data-search-results class="phpdocumentor-search-results phpdocumentor-search-results--hidden">
    <section class="phpdocumentor-search-results__dialog">
        <header class="phpdocumentor-search-results__header">
            <h2 class="phpdocumentor-search-results__title">Search results</h2>
            <button class="phpdocumentor-search-results__close"><i class="fas fa-times"></i></button>
        </header>
        <section class="phpdocumentor-search-results__body">
            <ul class="phpdocumentor-search-results__entries"></ul>
        </section>
    </section>
</section>
        </div>
        <a href="#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <script>
        cssVars({});
    </script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-highlight/prism-line-highlight.min.js"></script>
</body>
</html>
